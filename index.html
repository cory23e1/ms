<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî• –ú–° Adaptive APP</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ */
        .attachment-preview {
            background: rgba(67, 97, 238, 0.1);
            border: 2px solid var(--primary);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
            display: none;
        }
        
        .attachment-preview.visible {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .attachment-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        
        .attachment-icon {
            width: 40px;
            height: 40px;
            background: rgba(67, 97, 238, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .attachment-details {
            flex: 1;
        }
        
        .attachment-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .attachment-size {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .remove-attachment {
            background: rgba(230, 57, 70, 0.2);
            color: var(--danger);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .chat-input-wrapper {
            display: flex;
            flex-direction: column;
        }
        
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #e63946;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --gray: #6c757d;
            --online: #4CAF50;
            --offline: #757575;
            --mentor: #4361ee;
            --specialist: #f72585;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .navbar {
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #4361ee, #f72585);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-links {
            display: flex;
            gap: 25px;
            list-style: none;
        }

        .nav-link {
            color: var(--light);
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 25px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(67, 97, 238, 0.2);
            color: #fff;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 3px solid var(--primary);
            cursor: pointer;
            object-fit: cover;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .user-name {
            font-weight: 600;
            font-size: 16px;
        }

        .user-status {
            font-size: 12px;
            margin-top: 2px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ */
        .user-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        
        .status-online { background: #4CAF50; box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.3); }
        .status-offline { background: #757575; box-shadow: 0 0 0 2px rgba(117, 117, 117, 0.3); }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–æ–ª–µ–π */
        .role-mentor {
            background: rgba(67, 97, 238, 0.2);
            color: #4361ee;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .role-specialist {
            background: rgba(247, 37, 133, 0.2);
            color: #f72585;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .container {
            margin-top: 80px;
            padding: 20px;
            min-height: calc(100vh - 80px);
        }

        /* –í–∫–ª–∞–¥–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* –ß–∞—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .chat-container {
            display: flex;
            gap: 20px;
            height: 75vh;
        }

        /* ========== –°–¢–ò–õ–ò –î–õ–Ø –í–ö–õ–ê–î–ö–ò –ß–ê–¢–ê ========== */
        .users-sidebar {
            width: 300px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .users-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-wrap:wrap;
        }

        .users-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .users-count {
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ —Ä–æ–ª–µ–π */
        .users-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            padding: 8px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
            min-width: 70px;
        }
        
        .tab-btn.active {
            background: rgba(67, 97, 238, 0.3);
            color: white;
            border-color: var(--primary);
        }

        .users-list {
            flex: 1;
            overflow-y: auto;
        }

        .user-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .user-card:hover {
            background: rgba(67, 97, 238, 0.1);
        }

        .user-avatar-sm {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            position: relative;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–∞—Ä—Ç–æ—á–∫–µ */
        .status-badge {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid var(--dark);
        }

        .status-badge.online { background: var(--online); }
        .status-badge.offline { background: var(--offline); }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ */
        .loading-status {
            text-align: center;
            padding: 20px;
            color: rgba(255, 255, 255, 0.5);
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ */
        .last-seen {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 2px;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .status-pulse {
            animation: pulse 2s infinite;
        }

        .user-details {
            flex: 1;
        }

        .user-details-name {
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .user-details-role {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ */
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
        }

        .chat-header {
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* ========== –°–¢–ò–õ–ò –î–õ–Ø –≠–ú–û–î–ó–ò –ü–ò–ö–ï–†–ê ========== */
        .emoji-picker {
            background: rgba(26, 26, 46, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .emoji-categories {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .emoji-category-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .emoji-category-btn:hover {
            background: rgba(67, 97, 238, 0.2);
            transform: translateY(-2px);
        }
        
        .emoji-category-btn.active {
            background: rgba(67, 97, 238, 0.4);
            border-color: var(--primary);
        }
        
        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
        }
        
        .emoji-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .emoji-btn:hover {
            background: rgba(67, 97, 238, 0.2);
            transform: scale(1.1);
        }

        .message {
            display: flex;
            gap: 12px;
            max-width: 70%;
            animation: slideIn 0.2s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.sent {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
        }

        .message-content {
            background: rgba(67, 97, 238, 0.2);
            padding: 12px 16px;
            border-radius: 18px;
            border-top-left-radius: 4px;
        }

        .message.sent .message-content {
            background: rgba(76, 201, 240, 0.3);
            border-top-left-radius: 18px;
            border-top-right-radius: 4px;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .message-sender {
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .message-role {
            font-size: 11px;
            color: var(--success);
            background: rgba(76, 201, 240, 0.2);
            padding: 2px 6px;
            border-radius: 8px;
        }

        .message-time {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
        }

        .message-text {
            font-size: 14px;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .message-attachment {
            margin-top: 8px;
            max-width: 300px;
        }

        .attachment-image {
            max-width: 100%;
            border-radius: 10px;
            cursor: pointer;
        }

        .chat-input {
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 10px;
        }

        .message-input {
            flex: 1;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: var(--light);
            font-size: 15px;
            resize: none;
            min-height: 50px;
        }

        .chat-buttons {
            display: flex;
            gap: 5px;
        }

        .chat-btn {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s;
        }

        .chat-btn:active {
            transform: scale(0.95);
        }

        /* ========== –°–¢–ò–õ–ò –î–õ–Ø –í–ö–õ–ê–î–ö–ò –ó–ê–î–ê–ù–ò–ô ========== */
        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .task-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .task-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .task-card.completed {
            border-left: 4px solid var(--success);
        }

        .task-card.active {
            border-left: 4px solid var(--primary);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .task-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .task-reward {
            background: linear-gradient(135deg, var(--warning), #f8961e);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .task-description {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .task-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        /* –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è */
        .create-task-form {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid rgba(67, 97, 238, 0.3);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
        }

        /* –°—Ç–∏–ª—å –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ –ø—Ä–æ—Ñ–∏–ª–µ */
        .form-control {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        .file-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .preview-item {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
        }

        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .remove-preview {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* ========== –°–¢–ò–õ–ò –î–õ–Ø –í–ö–õ–ê–î–ö–ò –ú–ï–†–û–ü–†–ò–Ø–¢–ò–ô ========== */
        .event-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 0;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }
        
        .event-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .event-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .event-content {
            padding: 20px;
        }
        
        .event-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .event-description {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 15px;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .event-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--gray);
            margin-top: 15px;
        }
        
        .event-date {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--success);
        }
        
        .event-location {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .event-participants {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .participant-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid var(--dark);
            object-fit: cover;
        }
        
        .participant-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 60px;
        }
        
        .participant-name {
            font-size: 11px;
            margin-top: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }
        
        .participant-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
            margin-bottom: 5px;
            cursor: pointer;
        }
        
        .participant-checkbox:hover {
            background: rgba(67, 97, 238, 0.1);
        }
        
        .participant-checkbox input[type="checkbox"] {
            cursor: pointer;
        }
        
        .status-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .status-upcoming { background: var(--primary); color: white; }
        .status-ongoing { background: var(--success); color: white; }
        .status-completed { background: var(--gray); color: white; }
        .status-cancelled { background: var(--danger); color: white; }

        /* ========== –°–¢–ò–õ–ò –î–õ–Ø –í–ö–õ–ê–î–ö–ò –ê–î–ê–ü–¢–ê–¶–ò–ò ========== */
        .materials-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .material-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .material-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--success), #2a9d8f);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .material-content {
            flex: 1;
        }

        .material-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .material-description {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--dark);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å */
        .admin-panel {
            background: rgba(229, 57, 70, 0.1);
            border: 1px solid var(--danger);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .auth-box {
            background: rgba(26, 26, 46, 0.95);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .auth-tab {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
        }
        
        .auth-tab.active {
            color: white;
            border-bottom: 2px solid var(--primary);
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .auth-title {
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
            font-weight: 600;
            background: linear-gradient(135deg, #4361ee, #f72585);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .role-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .role-option {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .role-option.active {
            background: rgba(67, 97, 238, 0.2);
            border-color: var(--primary);
            color: white;
        }
        
        .role-option.specialist.active {
            background: rgba(247, 37, 133, 0.2);
            border-color: var(--accent);
        }
        
        .auth-footer {
            text-align: center;
            margin-top: 20px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 14px;
        }
        
        .auth-link {
            color: var(--primary);
            cursor: pointer;
            text-decoration: none;
        }
        
        .auth-link:hover {
            text-decoration: underline;
        }
        
        .logout-btn {
            background: rgba(230, 57, 70, 0.2);
            color: var(--danger);
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        /* ========== –ú–û–ë–ò–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø ========== */

/* –î–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å —à–∏—Ä–∏–Ω–æ–π –¥–æ 1024px (–ø–ª–∞–Ω—à–µ—Ç—ã –∏ —Ç–µ–ª–µ—Ñ–æ–Ω—ã) */
@media (max-width: 1024px) {
    .container {
        margin-top: 70px;
        padding: 15px;
    }
    
    .navbar {
        padding: 12px 15px;
    }
    
    .logo span {
        font-size: 18px;
    }
    
    .nav-links {
        gap: 15px;
    }
    
    .nav-link {
        padding: 8px 15px;
        font-size: 14px;
    }
    
    .user-avatar {
        width: 40px;
        height: 40px;
    }
    
    .user-name {
        font-size: 14px;
    }
}

/* –î–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å —à–∏—Ä–∏–Ω–æ–π –¥–æ 768px (–ø–ª–∞–Ω—à–µ—Ç—ã –≤ –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –∏ —Ç–µ–ª–µ—Ñ–æ–Ω—ã) */
@media (max-width: 768px) {
    body {
        font-size: 14px;
    }
    
    .navbar {
        padding: 10px 12px;
        flex-wrap: wrap;
    }
    
    .logo {
        font-size: 18px;
        order: 1;
        flex: 1;
    }
    
    .logo span {
        display: none;
    }
    
    /* –ë—É—Ä–≥–µ—Ä-–º–µ–Ω—é */
    .menu-toggle {
        display: flex !important;
        order: 2;
        background: transparent;
        border: none;
        color: white;
        font-size: 20px;
        cursor: pointer;
        padding: 5px;
        margin-left: 10px;
    }
    
    .nav-links {
        display: none;
        position: fixed;
        top: 60px;
        left: 0;
        right: 0;
        background: rgba(26, 26, 46, 0.98);
        backdrop-filter: blur(20px);
        flex-direction: column;
        padding: 20px;
        gap: 10px;
        z-index: 999;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    
    .nav-links.active {
        display: flex;
    }
    
    .nav-link {
        padding: 12px 15px;
        border-radius: 10px;
        justify-content: flex-start;
        font-size: 15px;
    }
    
    .user-menu {
        order: 3;
    }
    
    .user-info {
        display: none;
    }
    
    .user-avatar {
        width: 36px;
        height: 36px;
        border-width: 2px;
    }
    
    .container {
        margin-top: 60px;
        padding: 12px;
    }
    
    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è —á–∞—Ç–∞ */
    .chat-container {
        flex-direction: column;
        height: calc(100vh - 120px);
    }
    
    .users-sidebar {
        width: 100%;
        height: 200px;
        border-radius: 10px;
        margin-bottom: 15px;
        order: 2;
    }
    
    .users-sidebar.hidden-mobile {
        display: none;
    }
    
    .users-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .users-tabs {
        overflow-x: auto;
        flex-wrap: nowrap;
        padding-bottom: 5px;
    }
    
    .tab-btn {
        min-width: 60px;
        font-size: 11px;
        white-space: nowrap;
    }
    
    .chat-main {
        order: 1;
        flex: 1;
        min-height: 300px;
    }
    
    .chat-header {
        padding: 15px;
        position: relative;
    }
    
    .mobile-chat-actions {
        display: flex !important;
        position: absolute;
        top: 10px;
        right: 10px;
        gap: 5px;
    }
    
    .mobile-chat-btn {
        width: 30px;
        height: 30px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: white;
        font-size: 14px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .chat-messages {
        padding: 15px;
        gap: 10px;
    }
    
    .message {
        max-width: 85%;
    }
    
    .message-content {
        padding: 10px 12px;
    }
    
    .message-header {
        flex-wrap: wrap;
        gap: 5px;
    }
    
    .message-sender {
        font-size: 13px;
    }
    
    .message-time {
        font-size: 10px;
    }
    
    .message-text {
        font-size: 13px;
    }
    
    .chat-input {
        padding: 15px;
        flex-wrap: wrap;
    }
    
    .message-input {
        font-size: 14px;
        min-height: 45px;
        padding: 10px 12px;
    }
    
    .chat-buttons {
        gap: 5px;
    }
    
    .chat-btn {
        width: 45px;
        height: 45px;
        font-size: 16px;
    }
    
    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è —ç–º–æ–¥–∑–∏-–ø–∏–∫–µ—Ä–∞ */
    .emoji-picker {
        position: fixed;
        bottom: 70px;
        left: 10px;
        right: 10px;
        max-height: 200px;
        z-index: 1000;
    }
    
    .emoji-grid {
        grid-template-columns: repeat(6, 1fr);
    }
    
    .emoji-btn {
        width: 36px;
        height: 36px;
        font-size: 20px;
    }
    
    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏–π */
    .tasks-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .task-card {
        padding: 15px;
    }
    
    .task-title {
        font-size: 16px;
    }
    
    .task-description {
        font-size: 13px;
    }
    
    .task-actions {
        flex-direction: column;
        gap: 8px;
    }
    
    .task-actions .btn {
        width: 100%;
        text-align: center;
    }
    
    .create-task-form {
        padding: 20px;
    }
    
    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π */
    .events-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .event-card-simple {
        margin-bottom: 15px;
    }
    
    .event-card-simple > div:first-child {
        height: 120px;
    }
    
    .event-card-simple > div:last-child {
        padding: 15px;
    }
    
    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
    .modal-content {
        width: 95%;
        padding: 20px;
        border-radius: 15px;
        max-height: 85vh;
    }
    
    /* –§–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
    .auth-box {
        padding: 25px;
        margin: 15px;
    }
    
    .role-selector {
        flex-direction: column;
    }
    
    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –æ—Ç–≤–µ—Ç–∞ */
    .reply-indicator {
        padding: 8px 10px;
        margin: 0 10px 10px;
    }
    
    .reply-text {
        font-size: 11px;
    }
}

/* –î–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å —à–∏—Ä–∏–Ω–æ–π –¥–æ 480px (–º–æ–±–∏–ª—å–Ω—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã) */
@media (max-width: 480px) {
    .navbar {
        padding: 8px 10px;
    }
    
    .logo {
        font-size: 16px;
    }
    
    .menu-toggle {
        font-size: 18px;
    }
    
    .user-avatar {
        width: 32px;
        height: 32px;
    }
    
    .container {
        margin-top: 55px;
        padding: 10px;
    }
    
    .users-sidebar {
        height: 180px;
        padding: 15px;
    }
    
    .users-tabs .tab-btn {
        min-width: 50px;
        font-size: 10px;
        padding: 6px;
    }
    
    .chat-header {
        padding: 12px;
    }
    
    .chat-title {
        font-size: 16px;
    }
    
    .chat-subtitle {
        font-size: 12px;
    }
    
    .chat-messages {
        padding: 12px;
    }
    
    .message {
        max-width: 90%;
    }
    
    .message-avatar {
        width: 32px;
        height: 32px;
    }
    
    .message-content {
        padding: 8px 10px;
    }
    
    .chat-input {
        padding: 12px;
    }
    
    .message-input {
        min-height: 40px;
        padding: 8px 10px;
        font-size: 13px;
    }
    
    .chat-btn {
        width: 40px;
        height: 40px;
        font-size: 14px;
    }
    
    /* –£–±–∏—Ä–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ */
    .message {
        animation-duration: 0.1s;
    }
    
    .task-card, .event-card-simple {
        transition: none;
    }
    
    .task-card:hover, .event-card-simple:hover {
        transform: none;
    }
    
    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ */
    h1 { font-size: 24px; }
    h2 { font-size: 20px; }
    h3 { font-size: 18px; }
    
    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ */
    .btn {
        padding: 8px 12px;
        font-size: 13px;
    }
    
    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ñ–æ—Ä–º */
    .form-control {
        padding: 10px 12px;
        font-size: 14px;
    }
    
    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ */
    .event-tabs {
        overflow-x: auto;
        flex-wrap: nowrap;
    }
    
    .event-tab-btn {
        padding: 6px 10px;
        font-size: 12px;
        white-space: nowrap;
    }
    
    /* –°–∫—Ä—ã–≤–∞–µ–º –Ω–µ–≤–∞–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
    .user-details-role,
    .last-seen {
        display: none;
    }
}

/* –î–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–æ–π –≤—ã—Å–æ—Ç–æ–π */
@media (max-height: 600px) {
    .chat-container {
        height: calc(100vh - 100px);
    }
    
    .users-sidebar {
        height: 150px;
    }
    
    .chat-messages {
        max-height: 40vh;
    }
}

/* –î–ª—è –ª–∞–Ω–¥—à–∞—Ñ—Ç–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 768px) and (orientation: landscape) {
    .chat-container {
        flex-direction: row;
        height: calc(100vh - 70px);
    }
    
    .users-sidebar {
        width: 250px;
        height: 100%;
        margin-bottom: 0;
        margin-right: 15px;
    }
    
    .users-sidebar.hidden-mobile {
        display: none;
    }
    
    .chat-main {
        flex: 1;
    }
    
    .nav-links.active {
        max-height: 80vh;
        overflow-y: auto;
    }
}

/* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
.menu-toggle {
    display: none;
}

.mobile-chat-actions {
    display: none;
}

.toggle-users-btn {
    display: none;
}

/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 768px) {
    .toggle-users-btn {
        display: flex;
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(67, 97, 238, 0.3);
        border: 1px solid var(--primary);
        color: white;
        width: 32px;
        height: 32px;
        border-radius: 8px;
        cursor: pointer;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        z-index: 10;
    }
    
    .mobile-chat-actions {
        display: none;
        position: absolute;
        top: 10px;
        right: 10px;
        gap: 5px;
    }
}

/* –£–ª—É—á—à–∞–µ–º —Å–∫—Ä–æ–ª–ª–±–∞—Ä –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 768px) {
    ::-webkit-scrollbar {
        width: 4px;
    }
    
    ::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
    }
    
    ::-webkit-scrollbar-thumb {
        background: rgba(67, 97, 238, 0.5);
        border-radius: 2px;
    }
}

/* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 768px) {
    .attachment-preview {
        padding: 8px;
        margin: 0 10px 10px;
    }
    
    .attachment-icon {
        width: 32px;
        height: 32px;
        font-size: 16px;
    }
    
    .attachment-name {
        font-size: 12px;
    }
    
    .attachment-size {
        font-size: 11px;
    }
    
    .remove-attachment {
        width: 26px;
        height: 26px;
        font-size: 12px;
    }
}

/* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —Å —É—á–µ—Ç–æ–º OLED —ç–∫—Ä–∞–Ω–æ–≤ */
@media (max-width: 768px) {
    body {
        background: #0a0a1a;
    }
    
    .navbar {
        background: rgba(10, 10, 26, 0.98);
    }
    
    .users-sidebar,
    .chat-main,
    .task-card,
    .event-card-simple,
    .material-item {
        background: rgba(255, 255, 255, 0.03);
    }
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é */
@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.nav-links.active {
    animation: slideDown 0.3s ease;
}

/* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 768px) {
    * {
        -webkit-tap-highlight-color: transparent;
    }
    
    input, textarea, button {
        font-size: 16px !important; /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∑—É–º –≤ iOS */
    }
    
    .message-input {
        max-height: 120px;
    }
}

        /* –£—Ç–∏–ª–∏—Ç—ã */
        .mb-10 { margin-bottom: 10px; }
        .mb-15 { margin-bottom: 15px; }
        .mb-20 { margin-bottom: 20px; }
        .mt-10 { margin-top: 10px; }
        .mt-15 { margin-top: 15px; }
        .mt-20 { margin-top: 20px; }
        .d-flex { display: flex; }
        .align-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-10 { gap: 10px; }
        .w-100 { width: 100%; }

        .event-card-simple {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 0;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
            margin-bottom: 20px;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .event-card-simple:hover {
            transform: translateY(-5px);
            border-color: #4361ee;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        #events-list {
            display: block !important;
            visibility: visible !important;
        }
        
        #events-tab {
            display: none;
        }
        
        #events-tab.active {
            display: block !important;
        }

        /* –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Å—Ç–∏–ª–∏ - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≤–∫–ª–∞–¥–æ–∫ */
        .debug {
            border: 3px solid red !important;
            background: rgba(255, 0, 0, 0.1) !important;
        }
        
        /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏ */
        .tab-content {
            display: none;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }
        
        .tab-content.active {
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π */
        #events-list {
            display: grid !important;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)) !important;
            gap: 20px !important;
        }
        
        /* –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∏–¥–∏–º */
        .container {
            display: block !important;
            visibility: visible !important;
        }

        .event-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
        }
        
        .event-tab-btn {
            padding: 8px 15px;
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.7);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .event-tab-btn:hover {
            background: rgba(67, 97, 238, 0.1);
            color: white;
        }
        
        .event-tab-btn.active {
            background: rgba(67, 97, 238, 0.3);
            color: white;
            border-bottom: 2px solid var(--primary);
        }
        
        .event-tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .event-tab-content.active {
            display: block;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —á–∞—Ç–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è */
        .event-chat-message {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            border-left: 3px solid var(--primary);
        }
        
        .event-chat-message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }
        
        .event-chat-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .event-chat-sender {
            font-weight: 600;
            font-size: 14px;
        }
        
        .event-chat-time {
            font-size: 11px;
            color: rgba(255,255,255,0.5);
            margin-left: auto;
        }
        
        .event-chat-text {
            font-size: 14px;
            line-height: 1.5;
            word-wrap: break-word;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è */
        .reply-indicator {
            background: rgba(67, 97, 238, 0.2);
            border-left: 3px solid var(--primary);
            padding: 8px 12px;
            margin-bottom: 8px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .reply-info {
            flex: 1;
            overflow: hidden;
        }
        
        .reply-sender {
            font-size: 12px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 2px;
        }
        
        .reply-text {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .cancel-reply {
            background: transparent;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 16px;
            margin-left: 10px;
        }
        
        .message-reply {
            background: rgba(67, 97, 238, 0.1);
            border-left: 2px solid var(--primary);
            padding: 6px 10px;
            margin-bottom: 8px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .message-reply-sender {
            font-size: 11px;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .message-reply-text {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .reply-btn {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 5px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .reply-btn:hover {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }
        
        .message-actions {
            display: none;
            margin-top: 8px;
            gap: 5px;
        }
        
        .message:hover .message-actions {
            display: flex;
        }
        
    </style>
</head>
<body>
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω) -->
    <div id="auth-container" class="auth-container" style="display: none;">
        <div class="auth-box">
            <div class="auth-title">
                <i class="fas fa-fire"></i> –ú–° Adaptive APP
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">–í—Ö–æ–¥</button>
                <button class="auth-tab" onclick="switchAuthTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>
            
            <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
            <div id="login-form" class="auth-form active">
                <div class="form-group">
                    <label class="form-label">–õ–æ–≥–∏–Ω</label>
                    <input type="text" class="form-control" id="login-username" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ª–æ–≥–∏–Ω">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" class="form-control" id="login-password" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø–∞—Ä–æ–ª—å">
                </div>
                
                <button class="btn btn-primary w-100" onclick="login()">
                    <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏
                </button>
                
                <div class="auth-footer">
                    –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <span class="auth-link" onclick="switchAuthTab('register')">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</span>
                </div>
            </div>
            
            <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
            <div id="register-form" class="auth-form">
                <div class="form-group">
                    <label class="form-label">–õ–æ–≥–∏–Ω *</label>
                    <input type="text" class="form-control" id="register-username" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å *</label>
                    <input type="password" class="form-control" id="register-password" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è *</label>
                    <input type="password" class="form-control" id="register-password-confirm" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>

                <div class="form-group">
                    <label class="form-label">–ö–æ–¥–æ–≤–∞—è —Ñ—Ä–∞–∑–∞ *</label>
                    <input type="password" class="form-control" id="register-secret" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥–æ–≤—É—é —Ñ—Ä–∞–∑—É –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏">
                    <small style="color: rgba(255,255,255,0.5);">–§—Ä–∞–∑–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *</label>
                    <input type="text" class="form-control" id="register-display-name" placeholder="–í–∞—à–µ –∏–º—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–†–æ–ª—å *</label>
                    <div class="role-selector">
                        <div class="role-option active" data-role="mentor" onclick="selectRole('mentor')">
                            <i class="fas fa-user-tie"></i><br>
                            –ù–∞—Å—Ç–∞–≤–Ω–∏–∫
                        </div>
                        <div class="role-option" data-role="specialist" onclick="selectRole('specialist')">
                            <i class="fas fa-user-graduate"></i><br>
                            –ú–æ–ª–æ–¥–æ–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                    <input type="text" class="form-control" id="register-position" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Frontend Developer">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</label>
                    <input type="text" class="form-control" id="register-organization" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: IT Company Inc.">
                </div>
                
                <button class="btn btn-primary w-100" onclick="register()">
                    <i class="fas fa-user-plus"></i> –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                </button>
                
                <div class="auth-footer">
                    –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <span class="auth-link" onclick="switchAuthTab('login')">–í–æ–π–¥–∏—Ç–µ</span>
                </div>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) -->
    <div id="main-app" style="display: none;">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
        <nav class="navbar">
            <div class="logo">
                <i class="fas fa-fire"></i>
                <span>–ú–° Adaptive APP</span>
            </div>
            
            <button class="menu-toggle" id="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
            
            <ul class="nav-links">
                <li><a href="#" class="nav-link active" data-tab="chat" onclick="showTab('chat')">
                    <i class="fas fa-comments"></i> –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä
                </a></li>
                <li><a href="#" class="nav-link" data-tab="events" onclick="showTab('events')">
                    <i class="fas fa-calendar-alt"></i> –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
                </a></li>
                <li><a href="#" class="nav-link" data-tab="tasks" onclick="showTab('tasks')">
                    <i class="fas fa-tasks"></i> –ó–∞–¥–∞–Ω–∏—è
                </a></li>
                <li><a href="#" class="nav-link" data-tab="adaptation" onclick="showTab('adaptation')">
                    <i class="fas fa-graduation-cap"></i> –ê–¥–∞–ø—Ç–∞—Ü–∏—è
                </a></li>
            </ul>
            
            <div class="user-menu">
                <div class="user-info">
                    <div class="user-name" id="current-username">–ì–æ—Å—Ç—å</div>
                    <div class="user-status">
                        <span class="user-status-dot" id="current-status-indicator"></span>
                        <span id="status-text">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                </div>
                <img src="https://ui-avatars.com/api/?name=–ì–æ—Å—Ç—å&background=4361ee&color=fff" 
                     alt="–ê–≤–∞—Ç–∞—Ä" 
                     class="user-avatar"
                     id="current-avatar"
                     onclick="openProfileModal()">
                <button class="logout-btn" onclick="logout()" title="–í—ã–π—Ç–∏">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </nav>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
        <div class="container">
            <!-- ========== –í–ö–õ–ê–î–ö–ê –ß–ê–¢–ê ========== -->
            <div class="tab-content active" id="chat-tab">
                <div class="chat-container">
                    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ -->
                    <div class="users-sidebar">
                        <div class="users-header">
                            <div class="users-title">
                                <i class="fas fa-users"></i>
                                –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                                <span class="users-count" id="online-count">0</span>
                            </div>
                        </div>
                        
                        <div class="users-tabs">
                            <button class="tab-btn active" onclick="showUsersTab('all')">
                                <i class="fas fa-users"></i>
                                –í—Å–µ (<span id="all-tab-count">0</span>)
                            </button>
                            <button class="tab-btn" onclick="showUsersTab('mentors')">
                                <i class="fas fa-user-tie"></i>
                                –ù–∞—Å—Ç–∞–≤–Ω–∏–∫–∏
                            </button>
                            <button class="tab-btn" onclick="showUsersTab('specialists')">
                                <i class="fas fa-user-graduate"></i>
                                –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã
                            </button>
                            <button class="tab-btn" onclick="showUsersTab('online')">
                                <i class="fas fa-circle status-online"></i>
                                –û–Ω–ª–∞–π–Ω (<span id="online-tab-count">0</span>)
                            </button>
                        </div>
                        
                        <div class="users-list" id="users-list">
                           <div class="loading-status">
                                <i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...
                            </div>
                        </div>
                    </div>
                    
                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ -->
                    <div class="chat-main">
                        <div class="chat-header">
                            <div class="mobile-chat-actions">
                                <button class="toggle-users-btn" id="toggle-users-btn" onclick="toggleUsersSidebar()">
                                    <i class="fas fa-users"></i>
                                </button>
                            </div>
                            <div class="chat-title">–ü–µ—Ä–µ–ø–∏—Å–∫–∞</div>
                            <div class="chat-subtitle" id="chat-subtitle">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>
                        
                        <div class="chat-messages" id="chat-messages">
                            <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
                        </div>
                        <div class="chat-input-wrapper">
                            <div class="attachment-preview" id="attachment-preview">
                                <div class="attachment-info">
                                    <div class="attachment-icon" id="attachment-icon">
                                        <i class="fas fa-file"></i>
                                    </div>
                                    <div class="attachment-details">
                                        <div class="attachment-name" id="attachment-filename">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</div>
                                        <div class="attachment-size" id="attachment-filesize">0 KB</div>
                                    </div>
                                </div>
                                <button class="remove-attachment" onclick="removeAttachment()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            
                            <div class="emoji-picker" id="emoji-picker" style="display: none;">
                                <div class="emoji-categories">
                                    <button class="emoji-category-btn active" onclick="showEmojiCategory('smileys', event)">üòÄ</button>
                                    <button class="emoji-category-btn" onclick="showEmojiCategory('people', event)">üëã</button>
                                    <button class="emoji-category-btn" onclick="showEmojiCategory('animals', event)">üê∂</button>
                                    <button class="emoji-category-btn" onclick="showEmojiCategory('food', event)">üçé</button>
                                    <button class="emoji-category-btn" onclick="showEmojiCategory('activities', event)">‚öΩ</button>
                                    <button class="emoji-category-btn" onclick="showEmojiCategory('objects', event)">üí°</button>
                                    <button class="emoji-category-btn" onclick="showEmojiCategory('symbols', event)">‚ù§Ô∏è</button>
                                    <button class="emoji-category-btn" onclick="showEmojiCategory('flags', event)">üèÅ</button>
                                </div>
                                
                                <div class="emoji-grid" id="emoji-grid">
                                    <!-- –≠–º–æ–¥–∑–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                                </div>
                            </div>

                            <div class="reply-indicator" id="reply-indicator" style="display: none;">
                                <div class="reply-info">
                                    <div class="reply-sender" id="reply-sender">–û—Ç–≤–µ—á–∞–µ—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ</div>
                                    <div class="reply-text" id="reply-text"></div>
                                </div>
                                <button class="cancel-reply" onclick="cancelReply()">√ó</button>
                            </div>
                            
                            <div class="chat-input">
                                <textarea class="message-input" 
                                          id="message-input" 
                                          placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." 
                                          rows="1"></textarea>
                                
                                <div class="chat-buttons">
                                    <button class="chat-btn" onclick="openAttachmentModal()">
                                        <i class="fas fa-paperclip"></i>
                                    </button>
                                    <button class="chat-btn" onclick="toggleEmojiPicker()" type="button">
                                        <i class="fas fa-smile"></i>
                                    </button>
                                    <button class="chat-btn" onclick="sendMessage()">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –≤ —á–∞—Ç–µ -->
                <div class="admin-panel" id="admin-panel" style="display: none;">
                    <h3><i class="fas fa-shield-alt"></i> –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å —á–∞—Ç–∞</h3>
                    <div class="d-flex gap-10 mt-15">
                        <button class="btn btn-danger" onclick="deleteAllMessages()">
                            <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                        </button>
                        <button class="btn btn-danger" onclick="clearDatabase()">
                            <i class="fas fa-database"></i> –û—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É
                        </button>
                    </div>
                </div>
            </div>
        

            <!-- ========== –í–ö–õ–ê–î–ö–ê –ú–ï–†–û–ü–†–ò–Ø–¢–ò–ô ========== -->
        <div class="tab-content" id="events-tab">
            <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞) -->
            <div class="create-task-form" id="create-event-form" style="display: none;">
                <h2 class="mb-20"><i class="fas fa-calendar-plus"></i> –°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</h2>
                
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è *</label>
                    <input type="text" class="form-control" id="event-title" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è">
                </div>

                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ *</label>
                    <textarea class="form-control" id="event-description" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è..." rows="4"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è *</label>
                    <input type="datetime-local" class="form-control" id="event-datetime">
                </div>

                <div class="form-group">
                    <label class="form-label">–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è</label>
                    <input type="text" class="form-control" id="event-location" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û–Ω–ª–∞–π–Ω, –æ—Ñ–∏—Å, –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü-–∑–∞–ª">
                </div>

                <div class="form-group">
                    <label class="form-label">–û–±–ª–æ–∂–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</label>
                    <input type="file" class="form-control" id="event-image" accept="image/*">
                    <small style="color: rgba(255,255,255,0.5);">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 1200x600px</small>
                </div>

                <div class="form-group">
                    <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</label>
                    <div class="participants-select" id="event-participants" style="max-height: 200px; overflow-y: auto; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ–±–ª–æ–∂–∫–∏:</label>
                    <div id="event-image-preview" style="margin-top: 10px;">
                        <img id="event-image-preview-img" style="max-width: 300px; border-radius: 10px; display: none;">
                    </div>
                </div>

                <div class="d-flex gap-10">
                    <button class="btn btn-primary" onclick="createNewEvent()">
                        <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
                    </button>
                    <button class="btn" onclick="clearEventForm()" style="background: rgba(255,255,255,0.1); color: white;">
                        <i class="fas fa-times"></i> –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                </div>
            </div>

            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è -->
            <div class="d-flex justify-between align-center mb-20">
                <h2><i class="fas fa-calendar-alt"></i> –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h2>
                <button class="btn btn-primary" id="show-create-event-btn" onclick="toggleCreateEventForm()">
                    <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
                </button>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π -->
            <div class="events-grid" id="events-list">
                <!-- –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

    <!-- ========== –í–ö–õ–ê–î–ö–ê –ó–ê–î–ê–ù–ò–ô ========== -->
    <div class="tab-content" id="tasks-tab">
        <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞) -->
        <div class="create-task-form" id="create-task-form" style="display: none;">
            <h2 class="mb-20"><i class="fas fa-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ</h2>
            
            <div class="form-group">
                <label class="form-label">–¢–µ–º–∞ –∑–∞–¥–∞–Ω–∏—è *</label>
                <input type="text" class="form-control" id="task-title" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –∑–∞–¥–∞–Ω–∏—è">
            </div>

            <div class="form-group">
                <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è *</label>
                <textarea class="form-control" id="task-description" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è..." rows="4"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">–ù–∞–≥—Ä–∞–¥–∞ *</label>
                <input type="text" class="form-control" id="task-reward" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 100 –æ—á–∫–æ–≤, –ë–æ–Ω—É—Å, –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç">
            </div>

            <div class="form-group">
                <label class="form-label">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª—ã (–º–∞–∫—Å–∏–º—É–º 3 —Ñ–∞–π–ª–∞, –¥–æ 5MB –∫–∞–∂–¥—ã–π)</label>
                <input type="file" class="form-control" id="task-files" multiple accept="image/*,video/*,.gif,.pdf,.doc,.docx,.txt">
            </div>

            <div class="form-group">
                <label class="form-label">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–æ–≤:</label>
                <div class="file-preview" id="task-file-preview"></div>
            </div>

            <div class="d-flex gap-10">
                <button class="btn btn-primary" onclick="createTask()">
                    <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
                </button>
                <button class="btn" onclick="clearTaskForm()" style="background: rgba(255,255,255,0.1); color: white;">
                    <i class="fas fa-times"></i> –û—á–∏—Å—Ç–∏—Ç—å
                </button>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞) -->
        <div class="d-flex justify-between align-center mb-20">
            <h2><i class="fas fa-tasks"></i> –ó–∞–¥–∞–Ω–∏—è</h2>
            <button class="btn btn-primary" id="show-create-form-btn" onclick="toggleCreateTaskForm()">
                <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
            </button>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π -->
        <div class="tasks-grid" id="tasks-list">
            <!-- –ó–∞–¥–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
    </div>

    <!-- ========== –í–ö–õ–ê–î–ö–ê –ê–î–ê–ü–¢–ê–¶–ò–ò ========== -->
    <div class="tab-content" id="adaptation-tab">
        <h2 class="mb-20"><i class="fas fa-graduation-cap"></i> –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏</h2>
        
        <div class="materials-list" id="materials-list">
            <!-- –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            <div class="material-item">
                <div class="material-icon">
                    <i class="fas fa-book"></i>
                </div>
                <div class="material-content">
                    <div class="material-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</div>
                    <div class="material-description">–ó–¥–µ—Å—å –±—É–¥—É—Ç —Ä–∞–∑–º–µ—â–µ–Ω—ã –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>
                </div>
            </div>
        </div>
    </div>
</div>

        <!-- ========== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ========== -->
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="modal" id="profile-modal">
            <div class="modal-content">
                <h2 class="mb-20"><i class="fas fa-user-edit"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h2>
                
                <div class="mb-20">
                    <div class="d-flex align-center gap-15">
                        <img src="https://ui-avatars.com/api/?name=–ì–æ—Å—Ç—å&background=4361ee&color=fff" 
                             alt="–ê–≤–∞—Ç–∞—Ä" 
                             class="user-avatar"
                             id="avatar-preview">
                        <button class="btn" onclick="document.getElementById('avatar-input').click()" style="background: rgba(255,255,255,0.1); color: white;">
                            <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å
                        </button>
                        <input type="file" 
                               id="avatar-input" 
                               accept="image/*" 
                               style="display: none;"
                               onchange="uploadAvatar(this.files[0])">
                    </div>
                </div>
                
                <div class="mb-15">
                    <label class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *</label>
                    <input type="text" 
                           class="form-control" 
                           id="profile-username" 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è"
                           required>
                </div>
                
                <div class="mb-15">
                    <label class="form-label">–†–æ–ª—å</label>
                    <input type="text" 
                           class="form-control" 
                           id="profile-role" 
                           disabled
                           style="background: rgba(255,255,255,0.05);">
                </div>
                
                <div class="mb-15">
                    <label class="form-label">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                    <input type="text" 
                           class="form-control" 
                           id="profile-position" 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Frontend Developer">
                </div>
                
                <div class="mb-20">
                    <label class="form-label">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</label>
                    <input type="text" 
                           class="form-control" 
                           id="profile-organization" 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: IT Company Inc.">
                </div>
                
                <div class="d-flex justify-between">
                    <button class="btn" onclick="closeProfileModal()" style="background: rgba(255,255,255,0.1); color: white;">
                        <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
                    </button>
                    <button class="btn btn-primary" onclick="saveProfile()">
                        <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–ª–æ–∂–µ–Ω–∏–π -->
        <div class="modal" id="attachment-modal">
            <div class="modal-content">
                <h2 class="mb-20"><i class="fas fa-paperclip"></i> –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª</h2>
                
                <div class="mb-15">
                    <div class="d-flex gap-10 mb-15">
                        <button class="btn" onclick="selectAttachmentType('image')" style="background: rgba(255,255,255,0.1); color: white;">
                            <i class="fas fa-image"></i> –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        </button>
                        <button class="btn" onclick="selectAttachmentType('gif')" style="background: rgba(255,255,255,0.1); color: white;">
                            <i class="fas fa-photo-video"></i> GIF
                        </button>
                        <button class="btn" onclick="selectAttachmentType('video')" style="background: rgba(255,255,255,0.1); color: white;">
                            <i class="fas fa-video"></i> –í–∏–¥–µ–æ
                        </button>
                        <button class="btn" onclick="selectAttachmentType('file')" style="background: rgba(255,255,255,0.1); color: white;">
                            <i class="fas fa-file"></i> –§–∞–π–ª
                        </button>
                    </div>
                </div>
                
                <div class="mb-15" id="attachment-preview" style="display: none;">
                    <label class="form-label">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</label>
                    <div id="preview-container" class="mb-10"></div>
                </div>
                
                <div class="mb-20">
                    <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</label>
                    <input type="file" 
                           class="form-control" 
                           id="file-input"
                           onchange="previewAttachment(this.files[0])">
                </div>
                
                <div class="d-flex justify-between">
                    <button class="btn" onclick="closeAttachmentModal()" style="background: rgba(255,255,255,0.1); color: white;">
                        <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
                    </button>
                    <button class="btn btn-primary" onclick="attachFile()">
                        <i class="fas fa-check"></i> –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–¥–∞–Ω–∏—è -->
        <div class="modal" id="task-modal">
            <div class="modal-content">
                <h2 id="task-modal-title" class="mb-10"></h2>
                <div class="mb-15">
                    <span id="task-modal-reward" style="background: var(--warning); color: white; padding: 5px 10px; border-radius: 5px;"></span>
                </div>
                <p id="task-modal-description" style="line-height: 1.6; margin-bottom: 20px;"></p>
                
                <div id="task-modal-attachments" style="margin: 20px 0;"></div>
                
                <div id="task-modal-actions" class="d-flex gap-10"></div>
                
                <button class="btn w-100 mt-20" onclick="closeTaskModal()" style="background: rgba(255,255,255,0.1); color: white;">
                    <i class="fas fa-times"></i> –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
        <div class="modal" id="event-modal">
            <div class="modal-content" style="max-width: 800px; max-height: 90vh;">
                <!-- –í–∫–ª–∞–¥–∫–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
                <div class="event-tabs" style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <button class="event-tab-btn active" data-tab="info" onclick="switchEventTab('info')">
                        <i class="fas fa-info-circle"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                    </button>
                    <button class="event-tab-btn" data-tab="chat" onclick="switchEventTab('chat')">
                        <i class="fas fa-comments"></i> –û–±—Å—É–∂–¥–µ–Ω–∏–µ
                        <span class="event-chat-counter" id="event-chat-counter" style="margin-left: 5px; background: var(--primary); color: white; padding: 1px 6px; border-radius: 10px; font-size: 11px;">0</span>
                    </button>
                    <button class="event-tab-btn" data-tab="participants" onclick="switchEventTab('participants')">
                        <i class="fas fa-users"></i> –£—á–∞—Å—Ç–Ω–∏–∫–∏
                    </button>
                </div>
                
                <!-- –í–∫–ª–∞–¥–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
                <div class="event-tab-content active" id="event-tab-info">
                    <div style="position: relative;">
                        <img id="event-modal-image" src="" alt="–û–±–ª–æ–∂–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è" 
                             style="width: 100%; height: 200px; object-fit: cover; border-radius: 10px; margin-bottom: 15px;">
                        <div style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 5px 10px; border-radius: 5px;"
                             id="event-modal-status"></div>
                    </div>
                    
                    <h2 id="event-modal-title" class="mb-10"></h2>
                    
                    <div class="mb-15" style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-calendar" style="color: var(--primary);"></i>
                            <span id="event-modal-date"></span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-map-marker-alt" style="color: var(--warning);"></i>
                            <span id="event-modal-location"></span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-users" style="color: var(--success);"></i>
                            <span id="event-modal-participants-count"></span>
                        </div>
                    </div>
                    
                    <div class="mb-20">
                        <h4><i class="fas fa-align-left"></i> –û–ø–∏—Å–∞–Ω–∏–µ</h4>
                        <p id="event-modal-description" style="line-height: 1.6; margin-top: 10px; white-space: pre-wrap;"></p>
                    </div>
                </div>
                
                <!-- –í–∫–ª–∞–¥–∫–∞ —á–∞—Ç–∞ -->
                <div class="event-tab-content" id="event-tab-chat" style="display: none; height: 400px; flex-direction: column;">
                    <div id="event-chat-messages" style="flex: 1; overflow-y: auto; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 10px; margin-bottom: 10px;">
                        <!-- –°–æ–æ–±—â–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <textarea id="event-chat-input" 
                                 placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è..." 
                                 style="flex: 1; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: white; resize: none; min-height: 50px;"></textarea>
                        <button class="btn btn-primary" onclick="sendEventMessage()" style="align-self: flex-end; height: 50px;">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
                
                <!-- –í–∫–ª–∞–¥–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ -->
                <div class="event-tab-content" id="event-tab-participants" style="display: none;">
                    <h4><i class="fas fa-user-friends"></i> –£—á–∞—Å—Ç–Ω–∏–∫–∏ (<span id="event-modal-participants-count-2"></span>)</h4>
                    <div id="event-modal-participants" style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 15px;"></div>
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                <div id="event-modal-actions" class="d-flex gap-10" style="margin-top: 20px;"></div>
                
                <button class="btn w-100 mt-20" onclick="closeEventModal()" style="background: rgba(255,255,255,0.1); color: white;">
                    <i class="fas fa-times"></i> –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>
        </div>
    </div>
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE ==========
        const firebaseConfig = {
            apiKey: "AIzaSyB5eIngl-CnWkSuKcNtywID7kdOKKCatXY",
            authDomain: "ms-adaptive-chat.firebaseapp.com",
            databaseURL: "https://ms-adaptive-chat-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "ms-adaptive-chat",
            storageBucket: "ms-adaptive-chat.firebasestorage.app",
            messagingSenderId: "571640671300",
            appId: "1:571640671300:web:e1e0f4369b93a3ef8f2011"
        };

        const DEBUG = true;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        let currentUser = null;
        let users = {};
        let tasks = {};
        let isAdmin = false;
        let currentAttachment = null;
        let attachmentType = 'image';
        let taskFiles = [];
        let currentUsersTab = 'all';
        let statusUpdateInterval = null;
        let userStatusListeners = [];
        let events = {};
        let eventImage = null;
        let currentReply = null;
        
        let currentEventId = null;
        let eventMessagesListener = null;
        let emojiPickerVisible = false;
        let selectedRole = 'mentor'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫
        
        const emojiCategories = {
            smileys: ['üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'üòÖ', 'üòÇ', 'ü§£', 'üòä', 'üòá', 'üôÇ', 'üôÉ', 'üòâ', 'üòå', 'üòç', 'ü•∞', 'üòò', 'üòó', 'üòô', 'üòö', 'üòã', 'üòõ', 'üòù', 'üòú', 'ü§™', 'ü§®', 'üßê', 'ü§ì', 'üòé', 'ü•∏', 'ü§©', 'ü•≥', 'üòè', 'üòí', 'üòû', 'üòî', 'üòü', 'üòï', 'üôÅ', '‚òπÔ∏è', 'üò£', 'üòñ', 'üò´', 'üò©', 'ü•∫', 'üò¢', 'üò≠', 'üò§', 'üò†', 'üò°', 'ü§¨', 'ü§Ø', 'üò≥', 'ü•µ', 'ü•∂', 'üò±', 'üò®', 'üò∞', 'üò•', 'üòì', 'ü§ó', 'ü§î', 'ü§≠', 'ü§´', 'ü§•', 'üò∂', 'üòê', 'üòë', 'üò¨', 'üôÑ', 'üòØ', 'üò¶', 'üòß', 'üòÆ', 'üò≤', 'ü•±', 'üò¥', 'ü§§', 'üò™', 'üòµ', 'ü§ê', 'ü•¥', 'ü§¢', 'ü§Æ', 'ü§ß', 'üò∑', 'ü§í', 'ü§ï'],
            people: ['üëã', 'ü§ö', 'üñê', '‚úã', 'üññ', 'üëå', 'ü§å', 'ü§è', '‚úåÔ∏è', 'ü§û', 'ü§ü', 'ü§ò', 'ü§ô', 'üëà', 'üëâ', 'üëÜ', 'üñï', 'üëá', '‚òùÔ∏è', 'üëç', 'üëé', '‚úä', 'üëä', 'ü§õ', 'ü§ú', 'üëè', 'üôå', 'üëê', 'ü§≤', 'ü§ù', 'üôè', '‚úçÔ∏è', 'üíÖ', 'ü§≥', 'üí™', 'ü¶æ', 'ü¶ø', 'ü¶µ', 'ü¶∂', 'üëÇ', 'ü¶ª', 'üëÉ', 'üß†', 'ü¶∑', 'ü¶¥', 'üëÄ', 'üëÅÔ∏è', 'üëÖ', 'üëÑ', 'üë∂', 'üßí', 'üë¶', 'üëß', 'üßë', 'üë±', 'üë®', 'üßî', 'üë©', 'üßì', 'üë¥', 'üëµ'],
            animals: ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'üêØ', 'ü¶Å', 'üêÆ', 'üê∑', 'üêΩ', 'üê∏', 'üêµ', 'üôà', 'üôâ', 'üôä', 'üêí', 'üêî', 'üêß', 'üê¶', 'üê§', 'üê£', 'üê•', 'ü¶Ü', 'ü¶Ö', 'ü¶â', 'ü¶á', 'üê∫', 'üêó', 'üê¥', 'ü¶Ñ', 'üêù', 'üêõ', 'ü¶ã', 'üêå', 'üêû', 'üêú', 'ü¶ü', 'ü¶ó', 'üï∑Ô∏è', 'ü¶Ç', 'üê¢', 'üêç', 'ü¶é', 'ü¶ñ', 'ü¶ï', 'üêô', 'ü¶ë', 'ü¶ê', 'ü¶û', 'ü¶Ä', 'üê°', 'üê†', 'üêü', 'üê¨', 'üê≥', 'üêã', 'ü¶à', 'üêä', 'üêÖ', 'üêÜ', 'ü¶ì', 'ü¶ç', 'ü¶ß', 'üêò', 'ü¶õ', 'ü¶è', 'üê™', 'üê´', 'ü¶í', 'ü¶ò', 'üêÉ', 'üêÇ', 'üêÑ', 'üêé', 'üêñ', 'üêè', 'üêë', 'ü¶ô', 'üêê', 'ü¶å', 'üêï', 'üê©', 'ü¶Æ', 'üêï‚Äçü¶∫', 'üêà', 'üêà‚Äç‚¨õ'],
            food: ['üçé', 'üçê', 'üçä', 'üçã', 'üçå', 'üçâ', 'üçá', 'üçì', 'ü´ê', 'üçà', 'üçí', 'üçë', 'ü•≠', 'üçç', 'ü••', 'ü•ù', 'üçÖ', 'üçÜ', 'ü•ë', 'ü•¶', 'ü•¨', 'ü•í', 'üå∂Ô∏è', 'ü´ë', 'üåΩ', 'ü•ï', 'ü´í', 'üßÑ', 'üßÖ', 'ü•î', 'üç†', 'ü•ê', 'ü•Ø', 'üçû', 'ü•ñ', 'ü•®', 'üßÄ', 'ü•ö', 'üç≥', 'üßà', 'ü•û', 'üßá', 'ü•ì', 'ü•©', 'üçó', 'üçñ', 'ü¶¥', 'üå≠', 'üçî', 'üçü', 'üçï', 'ü´ì', 'ü•™', 'ü•ô', 'üßÜ', 'üåÆ', 'üåØ', 'ü´î', 'ü•ó', 'ü•ò', 'ü´ï', 'ü•´', 'üçù', 'üçú', 'üç≤', 'üçõ', 'üç£', 'üç±', 'ü•ü', 'ü¶™', 'üç§', 'üçô', 'üçö', 'üçò', 'üç•', 'ü•†', 'ü•Æ', 'üç¢', 'üç°', 'üçß', 'üç®', 'üç¶', 'ü•ß', 'üßÅ', 'üç∞', 'üéÇ', 'üçÆ', 'üç≠', 'üç¨', 'üç´', 'üçø', 'üç©', 'üç™', 'üå∞', 'ü•ú', 'üçØ', 'ü•õ', 'üçº', 'ü´ñ', '‚òï', 'üçµ', 'üßÉ', 'ü•§', 'üßã', 'üç∂', 'üç∫', 'üçª', 'ü•Ç', 'üç∑', 'ü•É', 'üç∏', 'üçπ', 'üßâ', 'üçæ'],
            activities: ['‚öΩ', 'üèÄ', 'üèà', '‚öæ', 'ü•é', 'üéæ', 'üèê', 'üèâ', 'ü•è', 'üé±', 'ü™Ä', 'üèì', 'üè∏', 'üèí', 'üèë', 'ü•ç', 'üèè', 'ü™É', 'ü•Ö', '‚õ≥', 'ü™Å', 'üèπ', 'üé£', 'ü§ø', 'ü•ä', 'ü•ã', 'üéΩ', 'üõπ', 'üõº', 'üõ∑', '‚õ∏Ô∏è', 'ü•å', 'üéø', '‚õ∑Ô∏è', 'üèÇ', 'ü™Ç', 'üèãÔ∏è', 'ü§º', 'ü§∏', '‚õπÔ∏è', 'ü§∫', 'ü§æ', 'üèåÔ∏è', 'üèá', 'üßò', 'üèÑ', 'üèä', 'ü§Ω', 'üö£', 'üßó', 'üöµ', 'üö¥', 'üèÜ', 'ü•á', 'ü•à', 'ü•â', 'üèÖ', 'üéñÔ∏è', 'üèµÔ∏è', 'üéóÔ∏è', 'üé´', 'üéüÔ∏è', 'üé™', 'ü§π', 'üé≠', 'ü©∞', 'üé®', 'üé¨', 'üé§', 'üéß', 'üéº', 'üéπ', 'ü•Å', 'üé∑', 'üé∫', 'üé∏', 'ü™ï', 'üéª', 'üé≤', '‚ôüÔ∏è', 'üéØ', 'üé≥', 'üéÆ', 'üé∞'],
            objects: ['‚åö', 'üì±', 'üì≤', 'üíª', '‚å®Ô∏è', 'üñ•Ô∏è', 'üñ®Ô∏è', 'üñ±Ô∏è', 'üñ≤Ô∏è', 'üïπÔ∏è', 'üóúÔ∏è', 'üíΩ', 'üíæ', 'üíø', 'üìÄ', 'üìº', 'üì∑', 'üì∏', 'üìπ', 'üé•', 'üìΩÔ∏è', 'üéûÔ∏è', 'üìû', '‚òéÔ∏è', 'üìü', 'üì†', 'üì∫', 'üìª', 'üéôÔ∏è', 'üéöÔ∏è', 'üéõÔ∏è', 'üß≠', '‚è±Ô∏è', '‚è≤Ô∏è', '‚è∞', 'üï∞Ô∏è', 'üå°Ô∏è', '‚õ±Ô∏è', 'üß®', 'üéà', 'üéâ', 'üéä', 'üéé', 'üéè', 'üéê', 'üßß', 'üéÄ', 'üéÅ', 'ü§ø', 'ü™Ä', 'üß©', 'ü™Ö', 'ü™Ü', 'üß∏', 'ü™Ü', 'ü™î', 'üßµ', 'ü™°', 'üß∂', 'ü™¢', 'üëì', 'üï∂Ô∏è', 'ü•Ω', 'ü•º', 'ü¶∫', 'üëî', 'üëï', 'üëñ', 'üß£', 'üß§', 'üß•', 'üß¶', 'üëó', 'üëò', 'ü•ª', 'ü©±', 'ü©≤', 'ü©≥', 'üëô', 'üëö', 'üëõ', 'üëú', 'üëù', 'üéí', 'ü©¥', 'üëû', 'üëü', 'ü•æ', 'ü•ø', 'üë†', 'üë°', 'ü©∞', 'üë¢', 'üëë', 'üëí', 'üé©', 'üéì', 'üß¢', 'ü™ñ', 'üíÑ', 'üíç', 'üíº'],
            symbols: ['‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'üñ§', 'ü§ç', 'ü§é', 'üíî', '‚ù§Ô∏è‚Äçüî•', '‚ù§Ô∏è‚Äçü©π', '‚ù£Ô∏è', 'üíï', 'üíû', 'üíì', 'üíó', 'üíñ', 'üíò', 'üíù', 'üíü', '‚òÆÔ∏è', '‚úùÔ∏è', '‚ò™Ô∏è', 'üïâÔ∏è', '‚ò∏Ô∏è', '‚ú°Ô∏è', 'üîØ', 'üïé', '‚òØÔ∏è', '‚ò¶Ô∏è', 'üõê', '‚õé', '‚ôà', '‚ôâ', '‚ôä', '‚ôã', '‚ôå', '‚ôç', '‚ôé', '‚ôè', '‚ôê', '‚ôë', '‚ôí', '‚ôì', 'üÜî', '‚öõÔ∏è', 'üâë', '‚ò¢Ô∏è', '‚ò£Ô∏è', 'üì¥', 'üì≥', 'üà∂', 'üàö', 'üà∏', 'üà∫', 'üà∑Ô∏è', '‚ú¥Ô∏è', 'üÜö', 'üíÆ', 'üâê', '„äôÔ∏è', '„äóÔ∏è', 'üà¥', 'üàµ', 'üàπ', 'üà≤', 'üÖ∞Ô∏è', 'üÖ±Ô∏è', 'üÜé', 'üÜë', 'üÖæÔ∏è', 'üÜò', '‚ùå', '‚≠ï', 'üõë', '‚õî', 'üìõ', 'üö´', 'üíØ', 'üí¢', '‚ô®Ô∏è', 'üö∑', 'üöØ', 'üö≥', 'üö±', 'üîû', 'üìµ', 'üö≠'],
            flags: ['üèÅ', 'üö©', 'üéå', 'üè¥', 'üè≥Ô∏è', 'üè≥Ô∏è‚Äçüåà', 'üè≥Ô∏è‚Äç‚ößÔ∏è', 'üè¥‚Äç‚ò†Ô∏è', 'üá¶üá®', 'üá¶üá©', 'üá¶üá™', 'üá¶üá´', 'üá¶üá¨', 'üá¶üáÆ', 'üá¶üá±', 'üá¶üá≤', 'üá¶üá¥', 'üá¶üá∂', 'üá¶üá∑', 'üá¶üá∏', 'üá¶üáπ', 'üá¶üá∫', 'üá¶üáº', 'üá¶üáΩ', 'üá¶üáø', 'üáßüá¶', 'üáßüáß', 'üáßüá©', 'üáßüá™', 'üáßüá´', 'üáßüá¨', 'üáßüá≠', 'üáßüáÆ', 'üáßüáØ', 'üáßüá±', 'üáßüá≤', 'üáßüá≥', 'üáßüá¥', 'üáßüá∂', 'üáßüá∑', 'üáßüá∏', 'üáßüáπ', 'üáßüáª', 'üáßüáº', 'üáßüáæ', 'üáßüáø', 'üá®üá¶', 'üá®üá®', 'üá®üá©', 'üá®üá´', 'üá®üá¨', 'üá®üá≠', 'üá®üáÆ', 'üá®üá∞', 'üá®üá±', 'üá®üá≤', 'üá®üá≥', 'üá®üá¥', 'üá®üá∑', 'üá®üá∫', 'üá®üáª', 'üá®üáº', 'üá®üáΩ', 'üá®üáæ', 'üá®üáø', 'üá©üá™', 'üá©üá¨', 'üá©üáØ', 'üá©üá∞', 'üá©üá≤', 'üá©üá¥', 'üá©üáø', 'üá™üá¶', 'üá™üá®', 'üá™üá™', 'üá™üá¨', 'üá™üá≠', 'üá™üá∑', 'üá™üá∏', 'üá™üáπ', 'üá™üá∫', 'üá´üáÆ', 'üá´üáØ', 'üá´üá∞', 'üá´üá≤', 'üá´üá¥', 'üá´üá∑', 'üá¨üá¶', 'üá¨üáß', 'üá¨üá©', 'üá¨üá™', 'üá¨üá´', 'üá¨üá¨', 'üá¨üá≠', 'üá¨üáÆ', 'üá¨üá±', 'üá¨üá≤', 'üá¨üá≥', 'üá¨üáµ', 'üá¨üá∂', 'üá¨üá∑', 'üá¨üá∏', 'üá¨üáπ', 'üá¨üá∫', 'üá¨üáº', 'üá¨üáæ']
        };

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Firebase
            if (firebaseConfig.apiKey.includes("–í–ê–®")) {
                showAlert('–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Firebase!', 'warning', '–ó–∞–º–µ–Ω–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Firebase –≤ –∫–æ–¥–µ.');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            checkAuth();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            setupNavigation();

            setupReplySystem();

            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É —á–∞—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            showTab('chat');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞
            initChat();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏–π
            initTasks();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
            initEventsSystem();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
            setupEventListeners();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            checkAdminStatus();

            // –ü–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É
            setTimeout(() => {
                checkTabsStructure();
                console.log('–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', currentUser);
            }, 1000);

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–∞–Ω–µ–ª—å —ç–º–æ–¥–∑–∏
            setTimeout(() => {
                showEmojiCategory('smileys');
            }, 1000);
        });

        function setupReplySystem() {
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
            document.addEventListener('click', function(event) {
                if (event.target.closest('.reply-btn')) {
                    const messageElement = event.target.closest('.message');
                    if (messageElement) {
                        const messageId = messageElement.dataset.messageId;
                        const messageText = messageElement.querySelector('.message-text').textContent;
                        const senderName = messageElement.querySelector('.message-sender').textContent.split('\n')[0];
                        
                        setReplyTo(messageId, senderName, messageText);
                    }
                }
            });
        }
        
        function setReplyTo(messageId, senderName, messageText) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞–Ω—ã
            console.log('setReplyTo –≤—ã–∑–≤–∞–Ω–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:', { messageId, senderName, messageText });
            
            currentReply = {
                id: messageId,
                sender: senderName,
                text: messageText
            };
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—Ç–≤–µ—Ç–∞
            const indicator = document.getElementById('reply-indicator');
            const senderElement = document.getElementById('reply-sender');
            const textElement = document.getElementById('reply-text');
            
            if (indicator && senderElement && textElement) {
                senderElement.textContent = `–û—Ç–≤–µ—á–∞–µ—Ç–µ ${senderName}`;
                textElement.textContent = messageText.length > 100 ? messageText.substring(0, 100) + '...' : messageText;
                indicator.style.display = 'flex';
                
                // –§–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                const input = document.getElementById('message-input');
                input.focus();
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–æ–ª—é –≤–≤–æ–¥–∞
                input.scrollIntoView({ behavior: 'smooth' });
            } else {
                console.error('–≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –æ—Ç–≤–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
            }
        }
        
        function cancelReply() {
            currentReply = null;
            document.getElementById('reply-indicator').style.display = 'none';
        }

        // ========== –°–ò–°–¢–ï–ú–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò –ò –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò ==========
        function checkAuth() {
            const savedUser = localStorage.getItem('current_user');
            const authContainer = document.getElementById('auth-container');
            const mainApp = document.getElementById('main-app');
            
            if (savedUser) {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
                currentUser = JSON.parse(savedUser);
                updateProfileUI();
                setUserStatus('online');
                
                authContainer.style.display = 'none';
                mainApp.style.display = 'block';
                
                // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                setupUsersListener();
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                authContainer.style.display = 'flex';
                mainApp.style.display = 'none';
            }
        }

        function switchAuthTab(tab) {
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏ –≤—Ö–æ–¥–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            document.querySelector(`.auth-tab[onclick*="${tab}"]`).classList.add('active');
            document.getElementById(`${tab}-form`).classList.add('active');
        }

        function selectRole(role) {
            selectedRole = role;
            document.querySelectorAll('.role-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.role === role) {
                    opt.classList.add('active');
                }
            });
        }

        function register() {
            const username = document.getElementById('register-username').value.trim();
            const password = document.getElementById('register-password').value.trim();
            const passwordConfirm = document.getElementById('register-password-confirm').value.trim();
            const displayName = document.getElementById('register-display-name').value.trim();
            const position = document.getElementById('register-position').value.trim();
            const organization = document.getElementById('register-organization').value.trim();
            const secret = document.getElementById('register-secret').value.trim();
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!username || !password || !passwordConfirm || !displayName || !secret) {
                showAlert('–û—à–∏–±–∫–∞', 'warning', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }
        
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–æ–≤–æ–π —Ñ—Ä–∞–∑—ã
            if (secret !== "sexing") {
                showAlert('–û—à–∏–±–∫–∞', 'error', '–ù–µ–≤–µ—Ä–Ω–∞—è –∫–æ–¥–æ–≤–∞—è —Ñ—Ä–∞–∑–µ!');
                return;
            }
            
            if (password !== passwordConfirm) {
                showAlert('–û—à–∏–±–∫–∞', 'warning', '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!');
                return;
            }
            
            if (password.length < 6) {
                showAlert('–û—à–∏–±–∫–∞', 'warning', '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–≤–æ–±–æ–¥–µ–Ω –ª–∏ –ª–æ–≥–∏–Ω
            database.ref('auth/' + username).once('value').then(snapshot => {
                if (snapshot.exists()) {
                    showAlert('–û—à–∏–±–∫–∞', 'warning', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
                    return;
                }
                
                // –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userId = generateId();
                const roleText = selectedRole === 'mentor' ? '–ù–∞—Å—Ç–∞–≤–Ω–∏–∫' : '–ú–æ–ª–æ–¥–æ–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç';
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                database.ref('auth/' + username).set({
                    password: password, // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—å –Ω—É–∂–Ω–æ —Ö—ç—à–∏—Ä–æ–≤–∞—Ç—å!
                    userId: userId
                }).then(() => {
                    // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const userData = {
                        id: userId,
                        username: displayName,
                        login: username,
                        role: selectedRole,
                        roleText: roleText,
                        position: position || '',
                        organization: organization || '',
                        avatar: getDefaultAvatar(displayName),
                        points: 0,
                        completedTasks: [],
                        status: 'online',
                        lastSeen: Date.now(),
                        createdAt: Date.now()
                    };
                    
                    return database.ref('users/' + userId).set(userData);
                }).then(() => {
                    // –ê–≤—Ç–æ—Ä–∏–∑—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    currentUser = {
                        id: userId,
                        username: displayName,
                        login: username,
                        role: selectedRole,
                        roleText: roleText,
                        position: position || '',
                        organization: organization || '',
                        avatar: getDefaultAvatar(displayName),
                        points: 0,
                        completedTasks: [],
                        status: 'online',
                        lastSeen: Date.now(),
                        createdAt: Date.now()
                    };
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                    localStorage.setItem('current_user', JSON.stringify(currentUser));
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                    document.getElementById('auth-container').style.display = 'none';
                    document.getElementById('main-app').style.display = 'block';
                    
                    updateProfileUI();
                    setUserStatus('online');
                    
                    showAlert('–£—Å–ø–µ—Ö!', 'success', '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!');
                    setupUsersListener();
                }).catch(error => {
                    console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', error);
                    showAlert('–û—à–∏–±–∫–∞', 'error', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è');
                });
            });
        }

        function login() {
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value.trim();
            
            if (!username || !password) {
                showAlert('–û—à–∏–±–∫–∞', 'warning', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            database.ref('auth/' + username).once('value').then(snapshot => {
                if (!snapshot.exists()) {
                    showAlert('–û—à–∏–±–∫–∞', 'warning', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                    return;
                }
                
                const authData = snapshot.val();
                
                if (authData.password !== password) {
                    showAlert('–û—à–∏–±–∫–∞', 'warning', '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
                    return;
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                return database.ref('users/' + authData.userId).once('value');
            }).then(snapshot => {
                if (!snapshot.exists()) {
                    showAlert('–û—à–∏–±–∫–∞', 'error', '–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                    return;
                }
                
                currentUser = snapshot.val();
                currentUser.status = 'online';
                currentUser.lastSeen = Date.now();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                localStorage.setItem('current_user', JSON.stringify(currentUser));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
                database.ref('users/' + currentUser.id).update({
                    status: 'online',
                    lastSeen: Date.now()
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                document.getElementById('auth-container').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                
                updateProfileUI();
                
                showAlert('–£—Å–ø–µ—Ö!', 'success', '–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
                setupUsersListener();
            }).catch(error => {
                console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);
                showAlert('–û—à–∏–±–∫–∞', 'error', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Å–∏—Å—Ç–µ–º—É');
            });
        }

        function logout() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å "–Ω–µ –≤ —Å–µ—Ç–∏"
            if (currentUser && currentUser.id) {
                database.ref('users/' + currentUser.id).update({
                    status: 'offline',
                    lastSeen: Date.now()
                });
            }
            
            // –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            localStorage.removeItem('current_user');
            currentUser = null;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            document.getElementById('auth-container').style.display = 'flex';
            document.getElementById('main-app').style.display = 'none';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã
            document.getElementById('login-username').value = '';
            document.getElementById('login-password').value = '';
            
            showAlert('–í—ã—Ö–æ–¥', 'info', '–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
        }

        // ========== –°–ò–°–¢–ï–ú–ê –°–¢–ê–¢–£–°–û–í ==========
        function setUserStatus(status) {
            if (!currentUser || !currentUser.id) return;
            
            currentUser.status = status;
            currentUser.lastSeen = Date.now();
            
            updateCurrentUserStatus();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤ Firebase
            if (currentUser.id) {
                database.ref('users/' + currentUser.id).update({
                    status: status,
                    lastSeen: Date.now()
                }).catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', error);
                });
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
            saveUserProfile();
        }

        function updateCurrentUserStatus() {
            const statusIndicator = document.getElementById('current-status-indicator');
            const statusText = document.getElementById('status-text');
            
            if (statusIndicator) {
                statusIndicator.className = `user-status-dot status-${currentUser.status}`;
                if (currentUser.status === 'online') {
                    statusIndicator.classList.add('status-pulse');
                } else {
                    statusIndicator.classList.remove('status-pulse');
                }
            }
            
            if (statusText) {
                statusText.textContent = getStatusText(currentUser.status);
            }
        }

        function getStatusText(status) {
            const statusMap = {
                'online': '–í —Å–µ—Ç–∏',
                'offline': '–ù–µ –≤ —Å–µ—Ç–∏'
            };
            return statusMap[status] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        }

        function formatLastSeen(timestamp) {
            if (!timestamp) return '';
            
            const now = Date.now();
            const diff = now - timestamp;
            
            if (diff < 60000) { // –ú–µ–Ω–µ–µ –º–∏–Ω—É—Ç—ã
                return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
            } else if (diff < 3600000) { // –ú–µ–Ω–µ–µ —á–∞—Å–∞
                const minutes = Math.floor(diff / 60000);
                return `${minutes} ${pluralize(minutes, ['–º–∏–Ω—É—Ç—É', '–º–∏–Ω—É—Ç—ã', '–º–∏–Ω—É—Ç'])} –Ω–∞–∑–∞–¥`;
            } else if (diff < 86400000) { // –ú–µ–Ω–µ–µ —Å—É—Ç–æ–∫
                const hours = Math.floor(diff / 3600000);
                return `${hours} ${pluralize(hours, ['—á–∞—Å', '—á–∞—Å–∞', '—á–∞—Å–æ–≤'])} –Ω–∞–∑–∞–¥`;
            } else {
                const date = new Date(timestamp);
                return date.toLocaleDateString('ru-RU');
            }
        }

        function pluralize(number, words) {
            const cases = [2, 0, 1, 1, 1, 2];
            return words[(number % 100 > 4 && number % 100 < 20) ? 2 : cases[Math.min(number % 10, 5)]];
        }

        // ========== –ü–†–û–§–ò–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ==========
        function saveUserProfile() {
            localStorage.setItem('current_user', JSON.stringify(currentUser));
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase
            saveUserToFirebase();
        }

        function saveUserToFirebase() {
            if (!currentUser || !currentUser.id) return;
            
            const userData = {
                ...currentUser,
                lastSeen: Date.now(),
                status: currentUser.status || 'online'
            };
            
            database.ref('users/' + currentUser.id).set(userData)
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
            });
        }

        function updateProfileUI() {
            document.getElementById('current-username').textContent = currentUser.username;
            const avatar = document.getElementById('current-avatar');
            const preview = document.getElementById('avatar-preview');
            
            const avatarUrl = currentUser.avatar || getDefaultAvatar(currentUser.username);
            avatar.src = avatarUrl;
            preview.src = avatarUrl;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
            document.getElementById('profile-username').value = currentUser.username;
            document.getElementById('profile-role').value = currentUser.roleText || 
                (currentUser.role === 'mentor' ? '–ù–∞—Å—Ç–∞–≤–Ω–∏–∫' : '–ú–æ–ª–æ–¥–æ–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç');
            document.getElementById('profile-position').value = currentUser.position || '';
            document.getElementById('profile-organization').value = currentUser.organization || '';
            
            updateCurrentUserStatus();
            checkAdminStatus();
        }

        function getDefaultAvatar(username) {
            const colors = ['4361ee', '3a0ca3', 'f72585', '4cc9f0', 'f8961e'];
            const color = colors[username.length % colors.length];
            return `https://ui-avatars.com/api/?name=${encodeURIComponent(username)}&background=${color}&color=fff`;
        }

        // ========== –ù–ê–í–ò–ì–ê–¶–ò–Ø ==========
        function setupNavigation() {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tab = this.getAttribute('data-tab');
                    if (tab) {
                        showTab(tab);
                    }
                });
            });
        }
        
        function showTab(tabName) {
            console.log('======= –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –í–ö–õ–ê–î–ö–ò =======');
            console.log('–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É:', tabName);

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –æ—Ç–≤–µ—Ç –ø—Ä–∏ —Å–º–µ–Ω–µ –≤–∫–ª–∞–¥–∫–∏
            if (currentReply && tabName !== 'chat') {
                cancelReply();
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏
            const tabs = document.querySelectorAll('.tab-content');
            const navLinks = document.querySelectorAll('.nav-link');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            tabs.forEach(tab => {
                tab.classList.remove('active');
                tab.style.display = 'none';
                tab.style.opacity = '0';
                tab.style.visibility = 'hidden';
                console.log('–°–∫—Ä—ã—Ç–∞ –≤–∫–ª–∞–¥–∫–∞:', tab.id);
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            navLinks.forEach(link => {
                link.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            const targetTab = document.getElementById(tabName + '-tab');
            if (targetTab) {
                targetTab.classList.add('active');
                targetTab.style.display = 'block';
                targetTab.style.opacity = '1';
                targetTab.style.visibility = 'visible';
                console.log('–ü–æ–∫–∞–∑–∞–Ω–∞ –≤–∫–ª–∞–¥–∫–∞:', targetTab.id);
                console.log('–°—Ç–∏–ª—å display:', targetTab.style.display);
                console.log('–°—Ç–∏–ª—å visibility:', targetTab.style.visibility);
            } else {
                console.error('–í–∫–ª–∞–¥–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:', tabName + '-tab');
            }
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            navLinks.forEach(link => {
                if (link.getAttribute('onclick') && link.getAttribute('onclick').includes(tabName)) {
                    link.classList.add('active');
                    console.log('–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞:', link.textContent);
                }
            });
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏
            setTimeout(() => {
                switch(tabName) {
                    case 'chat':
                        console.log('–ó–∞–≥—Ä—É–∂–∞—é —á–∞—Ç...');
                        loadUsers();
                        loadMessages();
                        break;
                    case 'tasks':
                        console.log('–ó–∞–≥—Ä—É–∂–∞—é –∑–∞–¥–∞–Ω–∏—è...');
                        loadTasksData();
                        break;
                    case 'events':
                        console.log('–ó–∞–≥—Ä—É–∂–∞—é –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è...');
                        loadEvents();
                        break;
                    case 'adaptation':
                        console.log('–ó–∞–≥—Ä—É–∂–∞—é –∞–¥–∞–ø—Ç–∞—Ü–∏—é...');
                        loadMaterials();
                        break;
                }
            }, 100);
        }

        function checkTabsStructure() {
            console.log('======= –ü–†–û–í–ï–†–ö–ê –°–¢–†–£–ö–¢–£–†–´ =======');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            const container = document.querySelector('.container');
            console.log('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞–π–¥–µ–Ω:', !!container);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            const tabs = ['chat', 'events', 'tasks', 'adaptation'];
            tabs.forEach(tab => {
                const element = document.getElementById(tab + '-tab');
                console.log(`–í–∫–ª–∞–¥–∫–∞ ${tab}:`, element ? '–Ω–∞–π–¥–µ–Ω–∞' : '–ù–ï –ù–ê–ô–î–ï–ù–ê');
                if (element) {
                    console.log(`  - display: ${window.getComputedStyle(element).display}`);
                    console.log(`  - visibility: ${window.getComputedStyle(element).visibility}`);
                    console.log(`  - opacity: ${window.getComputedStyle(element).opacity}`);
                    console.log(`  - –∫–ª–∞—Å—Å—ã: ${element.className}`);
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
            const navLinks = document.querySelectorAll('.nav-link');
            console.log('–ù–∞–π–¥–µ–Ω–æ —Å—Å—ã–ª–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:', navLinks.length);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            const activeTab = document.querySelector('.tab-content.active');
            console.log('–ê–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞:', activeTab ? activeTab.id : '–Ω–µ—Ç');
        }
        
        // ========== –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ ==========
        function checkAdminStatus() {
            isAdmin = currentUser.username === 'admin' || currentUser.role === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
            
            const adminPanel = document.getElementById('admin-panel');
            const createFormBtn = document.getElementById('show-create-form-btn');
            
            if (isAdmin) {
                adminPanel.style.display = 'block';
                createFormBtn.style.display = 'block';
            } else {
                adminPanel.style.display = 'none';
                createFormBtn.style.display = 'none';
            }
        }

        // ========== –ß–ê–¢ ==========
        function initChat() {
            loadUsers();
            loadMessages();
        }

        function loadUsers() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            database.ref('users').once('value').then(snapshot => {
                users = snapshot.val() || {};
                updateUsersList();
                updateOnlineCount();
                
                // –ó–∞—Ç–µ–º –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —á–∞—Å—Ç–æ—Ç—ã
                setupUsersListener();
            }).catch(error => {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
            });
        }

        function setupUsersListener() {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º throttle –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
            let lastUpdate = 0;
            const UPDATE_DELAY = 2000; // 2 —Å–µ–∫—É–Ω–¥—ã
            
            database.ref('users').on('value', (snapshot) => {
                const now = Date.now();
                if (now - lastUpdate > UPDATE_DELAY) {
                    users = snapshot.val() || {};
                    updateUsersList();
                    updateOnlineCount();
                    lastUpdate = now;
                }
            });
        }

        function updateUsersList() {
            const usersList = document.getElementById('users-list');
                if (!usersList) return;
                
                usersList.innerHTML = '';
                
                let filteredUsers = Object.values(users);
                
                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–æ–ª—è–º –∏ —Å—Ç–∞—Ç—É—Å—É
                if (currentUsersTab === 'online') {
                    filteredUsers = filteredUsers.filter(user => user.status === 'online');
                } else if (currentUsersTab === 'mentors') {
                    filteredUsers = filteredUsers.filter(user => user.role === 'mentor');
                } else if (currentUsersTab === 'specialists') {
                    filteredUsers = filteredUsers.filter(user => user.role === 'specialist');
                }
                // 'all' - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ—Ö
                
                if (filteredUsers.length === 0) {
                    usersList.innerHTML = `
                        <div class="loading-status">
                            <i class="fas fa-user-slash"></i> –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                        </div>
                    `;
                    return;
                }
                
                // –°–æ–∑–¥–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                const fragment = document.createDocumentFragment();
                const maxUsers = 50; // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                
                filteredUsers.slice(0, maxUsers).forEach(user => {
                    const userCard = createUserCardElement(user);
                    fragment.appendChild(userCard);
                });
                
                usersList.appendChild(fragment);
                
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–æ–ª—å—à–µ –º–∞–∫—Å–∏–º—É–º–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                if (filteredUsers.length > maxUsers) {
                    const moreCard = document.createElement('div');
                    moreCard.className = 'user-card';
                    moreCard.style.textAlign = 'center';
                    moreCard.style.color = 'rgba(255,255,255,0.5)';
                    moreCard.innerHTML = `<i class="fas fa-ellipsis-h"></i> –ï—â–µ ${filteredUsers.length - maxUsers} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`;
                    usersList.appendChild(moreCard);
                }
        }

        function createUserCardElement(user) {
            const userCard = document.createElement('div');
            userCard.className = 'user-card';
            
            const roleBadge = user.role === 'mentor' ? 
                '<span class="role-mentor"><i class="fas fa-user-tie"></i> –ù–∞—Å—Ç–∞–≤–Ω–∏–∫</span>' : 
                '<span class="role-specialist"><i class="fas fa-user-graduate"></i> –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç</span>';
            
            const position = user.position || '';
            const organization = user.organization ? ` ‚Ä¢ ${user.organization}` : '';
            const lastSeen = user.status !== 'online' ? formatLastSeen(user.lastSeen) : '';
            
            userCard.innerHTML = `
                <div style="position: relative;">
                    <img src="${user.avatar || getDefaultAvatar(user.username)}" 
                         alt="${user.username}" 
                         class="user-avatar-sm">
                    <span class="status-badge ${user.status || 'offline'}"></span>
                </div>
                <div class="user-details">
                    <div class="user-details-name">
                        ${user.username}
                        ${user.id === currentUser?.id ? ' (–í—ã)' : ''}
                        ${roleBadge}
                    </div>
                    <div class="user-details-role">${position}${organization}</div>
                    ${lastSeen ? `<div class="last-seen">–ë—ã–ª(–∞) ${lastSeen}</div>` : ''}
                </div>
            `;
            
            return userCard;
        }

        function updateOnlineCount() {
            if (!users || Object.keys(users).length === 0) return;
            
            const onlineUsers = Object.values(users).filter(user => user.status === 'online');
            const allUsers = Object.keys(users).length;
            
            const onlineCountElement = document.getElementById('online-count');
            const onlineTabCountElement = document.getElementById('online-tab-count');
            const allTabCountElement = document.getElementById('all-tab-count');
            const chatSubtitleElement = document.getElementById('chat-subtitle');
            
            if (onlineCountElement) onlineCountElement.textContent = onlineUsers.length;
            if (onlineTabCountElement) onlineTabCountElement.textContent = onlineUsers.length;
            if (allTabCountElement) allTabCountElement.textContent = allUsers;
            if (chatSubtitleElement) {
                chatSubtitleElement.textContent = `${onlineUsers.length} –∏–∑ ${allUsers} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –æ–Ω–ª–∞–π–Ω`;
            }
        }

        function showUsersTab(tab) {
            currentUsersTab = tab;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.users-tabs .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            updateUsersList();
        }

        function startPrivateChat(userId) {
            const user = users[userId];
            if (!user) return;
            
            showAlert(`–ù–∞—á–∞–ª–æ —á–∞—Ç–∞ —Å ${user.username}`, 'info', '–§—É–Ω–∫—Ü–∏—è –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }

        // ========== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –ü–†–ò–ö–†–ï–ü–õ–ï–ù–ù–û–ì–û –§–ê–ô–õ–ê ==========
        function updateAttachmentPreview() {
            const preview = document.getElementById('attachment-preview');
            const icon = document.getElementById('attachment-icon');
            const filename = document.getElementById('attachment-filename');
            const filesize = document.getElementById('attachment-filesize');
            
            if (currentAttachment) {
                preview.classList.add('visible');
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
                let iconClass = 'fas fa-file';
                if (currentAttachment.type === 'image') {
                    iconClass = 'fas fa-image';
                } else if (currentAttachment.type === 'gif') {
                    iconClass = 'fas fa-photo-video';
                } else if (currentAttachment.type === 'video') {
                    iconClass = 'fas fa-video';
                } else if (currentAttachment.name && currentAttachment.name.toLowerCase().includes('.pdf')) {
                    iconClass = 'fas fa-file-pdf';
                } else if (currentAttachment.name && (
                    currentAttachment.name.toLowerCase().includes('.doc') || 
                    currentAttachment.name.toLowerCase().includes('.docx')
                )) {
                    iconClass = 'fas fa-file-word';
                }
                
                icon.innerHTML = `<i class="${iconClass}"></i>`;
                filename.textContent = currentAttachment.name;
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
                const size = currentAttachment.size;
                if (size < 1024) {
                    filesize.textContent = size + ' B';
                } else if (size < 1024 * 1024) {
                    filesize.textContent = (size / 1024).toFixed(1) + ' KB';
                } else {
                    filesize.textContent = (size / (1024 * 1024)).toFixed(1) + ' MB';
                }
            } else {
                preview.classList.remove('visible');
            }
        }

        function removeAttachment() {
            currentAttachment = null;
            updateAttachmentPreview();
            showAlert('–í–ª–æ–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'info');
        }

        function loadMessages() {
            database.ref('messages').limitToLast(50).on('value', snapshot => {
                const messages = snapshot.val() || {};
                displayMessages(messages);
            });
        }

        function displayMessages(messages) {
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.innerHTML = '';
            
            const messagesArray = Object.values(messages).sort((a, b) => a.timestamp - b.timestamp);
            
            messagesArray.forEach(message => {
                const isCurrentUser = message.userId === currentUser.id;
                const messageElement = createMessageElement(message, isCurrentUser);
                messagesContainer.appendChild(messageElement);
            });
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // ========== –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –°–û–ó–î–ê–ù–ò–Ø –≠–õ–ï–ú–ï–ù–¢–ê –°–û–û–ë–©–ï–ù–ò–Ø ==========
        function createMessageElement(message, isCurrentUser) {
            const div = document.createElement('div');
            div.className = `message ${isCurrentUser ? 'sent' : ''}`;
            div.dataset.messageId = message.id;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º timestamp
            const timestamp = message.firebaseTimestamp || message.timestamp || message.localTimestamp || Date.now();
            const displayTime = getSamaraTime(timestamp);
            
            let attachmentHtml = '';
            if (message.attachment) {
                if (message.attachment.type === 'image' || message.attachment.type === 'gif') {
                    attachmentHtml = `
                        <div class="message-attachment">
                            <img src="${message.attachment.data}" 
                                 alt="${message.attachment.name}" 
                                 class="attachment-image"
                                 onclick="viewImage('${message.attachment.data}')">
                        </div>
                    `;
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é –æ—Ç–≤–µ—Ç–∞, –µ—Å–ª–∏ –µ—Å—Ç—å
            let replyPreviewHtml = '';
            if (message.replyTo) {
                const reply = message.replyPreview || {};
                replyPreviewHtml = `
                    <div class="message-reply" onclick="scrollToMessage('${message.replyTo}')">
                        <div class="message-reply-sender">
                            <i class="fas fa-reply fa-rotate-180"></i>
                            ${reply.sender || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}
                        </div>
                        <div class="message-reply-text">${reply.text || '–°–æ–æ–±—â–µ–Ω–∏–µ'}</div>
                    </div>
                `;
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–æ–ª—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            let roleBadge = '';
            const user = users[message.userId];
            if (user) {
                if (user.role === 'mentor') {
                    roleBadge = '<span class="role-mentor"><i class="fas fa-user-tie"></i> –ù–∞—Å—Ç–∞–≤–Ω–∏–∫</span>';
                } else if (user.role === 'specialist') {
                    roleBadge = '<span class="role-specialist"><i class="fas fa-user-graduate"></i> –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç</span>';
                }
            }
            
            div.innerHTML = `
                <img src="${message.userAvatar || getDefaultAvatar(message.username)}" 
                     alt="${message.username}" 
                     class="message-avatar">
                <div class="message-content">
                    <div class="message-header">
                        <div class="message-sender">
                            ${message.username}
                            ${roleBadge}
                        </div>
                        <div class="message-time">${displayTime}</div>
                    </div>
                    ${replyPreviewHtml}
                    <div class="message-text">${message.text}</div>
                    ${attachmentHtml}
                    <div class="message-actions">
                        <button class="reply-btn" onclick="handleReplyClick(event, '${message.id}', '${escapeHtml(message.username)}', '${escapeHtml(message.text.substring(0, 100))}')">
                            <i class="fas fa-reply"></i> –û—Ç–≤–µ—Ç–∏—Ç—å
                        </button>
                        ${isAdmin ? `
                            <button class="btn btn-danger btn-sm" onclick="deleteMessage('${message.id}')">
                                <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
            
            return div;
        }

        // –î–æ–±–∞–≤—å—Ç–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // –î–æ–±–∞–≤—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É "–û—Ç–≤–µ—Ç–∏—Ç—å"
        function handleReplyClick(event, messageId, senderName, messageText) {
            event.stopPropagation(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ —Å–æ–±—ã—Ç–∏—è
            setReplyTo(messageId, senderName, messageText);
        }

        function scrollToMessage(messageId) {
            const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
            if (messageElement) {
                messageElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥
                messageElement.style.backgroundColor = 'rgba(67, 97, 238, 0.2)';
                messageElement.style.transition = 'background-color 0.3s';
                
                setTimeout(() => {
                    messageElement.style.backgroundColor = '';
                }, 3000);
            }
        }

        function sendMessage() {
            const input = document.getElementById('message-input');
            const text = input.value.trim();
            
            if (!text && !currentAttachment) {
                showAlert('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–∞–π–ª!', 'warning');
                return;
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —ç–º–æ–¥–∑–∏ –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞
            if (emojiPickerVisible) {
                document.getElementById('emoji-picker').style.display = 'none';
                emojiPickerVisible = false;
            }
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–µ—Ä–≤–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è Firebase
            const serverTimestamp = firebase.database.ServerValue.TIMESTAMP;
            
            const message = {
                id: generateId(),
                text: text,
                userId: currentUser.id,
                username: currentUser.username,
                userRole: currentUser.roleText || (currentUser.role === 'mentor' ? '–ù–∞—Å—Ç–∞–≤–Ω–∏–∫' : '–ú–æ–ª–æ–¥–æ–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç'),
                userOrganization: currentUser.organization || '',
                userAvatar: currentUser.avatar || getDefaultAvatar(currentUser.username),
                timestamp: serverTimestamp,
                firebaseTimestamp: serverTimestamp,
                localTimestamp: Date.now(),
                attachment: currentAttachment,
                timezone: 'UTC+4'
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ç–≤–µ—Ç–µ, –µ—Å–ª–∏ –µ—Å—Ç—å
            if (currentReply) {
                message.replyTo = currentReply.id;
                message.replyPreview = {
                    sender: currentReply.sender,
                    text: currentReply.text
                };
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –æ—Ç–≤–µ—Ç –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
                setTimeout(() => {
                    cancelReply();
                }, 100);
            }
            
            // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç
            const originalText = text;
            input.value = '';
            currentAttachment = null;
            updateAttachmentPreview();
            cancelReply(); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç
            
            // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: —É–º–µ–Ω—å—à–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ
            input.style.transition = 'none';
            input.style.height = 'auto';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
            const sendBtn = event.target;
            const originalHTML = sendBtn.innerHTML;
            sendBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            sendBtn.disabled = true;
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            database.ref('messages/' + message.id).set(message)
                .then(() => {
                    input.focus();
                    
                    // –ë—ã—Å—Ç—Ä–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    setTimeout(() => {
                        Swal.fire({
                            title: '‚úì',
                            text: '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ',
                            icon: 'success',
                            toast: true,
                            position: 'top-end',
                            showConfirmButton: false,
                            timer: 1500,
                            timerProgressBar: true
                        });
                    }, 50);
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
                    input.value = originalText;
                    currentAttachment = message.attachment;
                    updateAttachmentPreview();
                    
                    showAlert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏', 'error', '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑');
                })
                .finally(() => {
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                    setTimeout(() => {
                        sendBtn.innerHTML = originalHTML;
                        sendBtn.disabled = false;
                    }, 500);
                });
        }

        function deleteMessage(messageId) {
            if (!isAdmin) return;
            
            Swal.fire({
                title: '–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '–£–¥–∞–ª–∏—Ç—å',
                cancelButtonText: '–û—Ç–º–µ–Ω–∞'
            }).then((result) => {
                if (result.isConfirmed) {
                    database.ref('messages/' + messageId).remove();
                    showAlert('–°–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ!', 'success');
                }
            });
        }

        function deleteAllMessages() {
            if (!isAdmin) return;
            
            Swal.fire({
                title: '–£–¥–∞–ª–∏—Ç—å –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è?',
                text: '–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!',
                icon: 'error',
                showCancelButton: true,
                confirmButtonText: '–£–¥–∞–ª–∏—Ç—å –≤—Å—ë',
                cancelButtonText: '–û—Ç–º–µ–Ω–∞'
            }).then((result) => {
                if (result.isConfirmed) {
                    database.ref('messages').remove();
                    showAlert('–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã!', 'success');
                }
            });
        }

        function clearDatabase() {
            if (!isAdmin) return;
            
            Swal.fire({
                title: '–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö?',
                text: '–£–¥–∞–ª—è—Ç—Å—è –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏!',
                icon: 'error',
                showCancelButton: true,
                confirmButtonText: '–û—á–∏—Å—Ç–∏—Ç—å',
                cancelButtonText: '–û—Ç–º–µ–Ω–∞'
            }).then((result) => {
                if (result.isConfirmed) {
                    database.ref().remove();
                    showAlert('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—á–∏—â–µ–Ω–∞!', 'success');
                }
            });
        }

        // ========== –ó–ê–î–ê–ù–ò–Ø ==========
        function initTasks() {
            loadTasksData();
            setupTaskFileUpload();
        }

        function loadTasksData() {
            database.ref('tasks').on('value', snapshot => {
                tasks = snapshot.val() || {};
                displayTasks();
            });
        }

        function initEvents() {
            loadEvents();
        }

        function displayTasks() {
            const tasksList = document.getElementById('tasks-list');
            if (!tasksList) return;
            
            tasksList.innerHTML = '';
            
            const tasksArray = Object.entries(tasks).map(([id, task]) => ({ id, ...task }));
            tasksArray.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
            
            tasksArray.forEach(task => {
                const taskCard = createTaskCard(task);
                tasksList.appendChild(taskCard);
            });
        }

        function createTaskCard(task) {
            const isCompleted = currentUser.completedTasks?.includes(task.id);
            const card = document.createElement('div');
            card.className = `task-card ${isCompleted ? 'completed' : 'active'}`;
            
            let attachmentsHtml = '';
            if (task.attachments && task.attachments.length > 0) {
                attachmentsHtml = `
                    <div class="mb-10">
                        <small style="color: rgba(255,255,255,0.5);">
                            <i class="fas fa-paperclip"></i> ${task.attachments.length} —Ñ–∞–π–ª–æ–≤
                        </small>
                    </div>
                `;
            }
            
            card.innerHTML = `
                <div class="task-header">
                    <h3 class="task-title">${task.title}</h3>
                    <span class="task-reward">${task.reward}</span>
                </div>
                
                <div class="task-description">
                    ${task.description.substring(0, 150)}${task.description.length > 150 ? '...' : ''}
                </div>
                
                ${attachmentsHtml}
                
                <div class="task-actions">
                    <button class="btn btn-primary" onclick="viewTask('${task.id}')">
                        <i class="fas fa-eye"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                    </button>
                    
                    ${!isCompleted ? `
                        <button class="btn btn-success" onclick="completeTask('${task.id}')">
                            <i class="fas fa-check"></i> –í—ã–ø–æ–ª–Ω–∏—Ç—å
                        </button>
                    ` : ''}
                    
                    ${isAdmin ? `
                        <button class="btn btn-danger" onclick="deleteTask('${task.id}')">
                            <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                        </button>
                    ` : ''}
                </div>
            `;
            
            return card;
        }

        function toggleCreateTaskForm() {
            const form = document.getElementById('create-task-form');
            if (form.style.display === 'none') {
                form.style.display = 'block';
                document.getElementById('show-create-form-btn').innerHTML = '<i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞';
                document.getElementById('show-create-form-btn').onclick = toggleCreateTaskForm;
            } else {
                form.style.display = 'none';
                document.getElementById('show-create-form-btn').innerHTML = '<i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ';
                document.getElementById('show-create-form-btn').onclick = toggleCreateTaskForm;
                clearTaskForm();
            }
        }

        function setupTaskFileUpload() {
            document.getElementById('task-files').addEventListener('change', function(e) {
                const files = Array.from(e.target.files);
                taskFiles = [];
                const preview = document.getElementById('task-file-preview');
                preview.innerHTML = '';
                
                files.slice(0, 3).forEach((file, index) => {
                    if (file.size > 5 * 1024 * 1024) {
                        showAlert('–û—à–∏–±–∫–∞', 'error', `–§–∞–π–ª "${file.name}" —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π!`);
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        taskFiles.push({
                            name: file.name,
                            type: getFileType(file),
                            data: e.target.result,
                            size: file.size
                        });
                        
                        const previewItem = document.createElement('div');
                        previewItem.className = 'preview-item';
                        
                        if (file.type.startsWith('image/')) {
                            previewItem.innerHTML = `
                                <img src="${e.target.result}" alt="${file.name}">
                                <button class="remove-preview" onclick="removeTaskFile(${index})">√ó</button>
                            `;
                        } else {
                            previewItem.innerHTML = `
                                <div style="width: 100%; height: 100%; background: rgba(67, 97, 238, 0.3); display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-file fa-2x"></i>
                                </div>
                                <button class="remove-preview" onclick="removeTaskFile(${index})">√ó</button>
                            `;
                        }
                        
                        preview.appendChild(previewItem);
                    };
                    reader.readAsDataURL(file);
                });
            });
        }

        function getFileType(file) {
            if (file.type.startsWith('image/')) {
                return file.type === 'image/gif' ? 'gif' : 'image';
            } else if (file.type.startsWith('video/')) {
                return 'video';
            } else {
                return 'file';
            }
        }

        function removeTaskFile(index) {
            taskFiles.splice(index, 1);
            updateTaskFilePreview();
        }

        function updateTaskFilePreview() {
            const preview = document.getElementById('task-file-preview');
            preview.innerHTML = '';
            
            taskFiles.forEach((file, index) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                
                if (file.type === 'image' || file.type === 'gif') {
                    previewItem.innerHTML = `
                        <img src="${file.data}" alt="${file.name}">
                        <button class="remove-preview" onclick="removeTaskFile(${index})">√ó</button>
                    `;
                } else {
                    previewItem.innerHTML = `
                        <div style="width: 100%; height: 100%; background: rgba(67, 97, 238, 0.3); display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-file fa-2x"></i>
                        </div>
                        <button class="remove-preview" onclick="removeTaskFile(${index})">√ó</button>
                    `;
                }
                
                preview.appendChild(previewItem);
            });
        }

        function createTask() {
            if (!isAdmin) {
                showAlert('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞', 'error', '–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è!');
                return;
            }
            
            const title = document.getElementById('task-title').value.trim();
            const description = document.getElementById('task-description').value.trim();
            const reward = document.getElementById('task-reward').value.trim();
            
            if (!title || !description || !reward) {
                showAlert('–û—à–∏–±–∫–∞', 'warning', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }
            
            const taskId = generateId();
            const taskData = {
                id: taskId,
                title: title,
                description: description,
                reward: reward,
                attachments: taskFiles,
                createdBy: currentUser.username,
                createdAt: Date.now(),
                participants: []
            };
            
            database.ref('tasks/' + taskId).set(taskData)
                .then(() => {
                    showAlert('–£—Å–ø–µ—Ö!', 'success', '–ó–∞–¥–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ!');
                    clearTaskForm();
                    toggleCreateTaskForm();
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞:', error);
                    showAlert('–û—à–∏–±–∫–∞', 'error', '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ');
                });
        }

        function clearTaskForm() {
            document.getElementById('task-title').value = '';
            document.getElementById('task-description').value = '';
            document.getElementById('task-reward').value = '';
            document.getElementById('task-files').value = '';
            document.getElementById('task-file-preview').innerHTML = '';
            taskFiles = [];
        }

        function viewTask(taskId) {
            const task = tasks[taskId];
            if (!task) return;
            
            const modal = document.getElementById('task-modal');
            const isCompleted = currentUser.completedTasks?.includes(taskId);
            
            document.getElementById('task-modal-title').textContent = task.title;
            document.getElementById('task-modal-reward').textContent = task.reward;
            document.getElementById('task-modal-description').textContent = task.description;
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤–ª–æ–∂–µ–Ω–∏—è
            const attachmentsDiv = document.getElementById('task-modal-attachments');
            attachmentsDiv.innerHTML = '';
            
            if (task.attachments && task.attachments.length > 0) {
                attachmentsDiv.innerHTML = `
                    <h4><i class="fas fa-paperclip"></i> –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
                        ${task.attachments.map(att => `
                            <div style="text-align: center;">
                                <a href="#" onclick="downloadAttachment('${att.data}', '${att.name}')" style="text-decoration: none; color: white;">
                                    ${att.type === 'image' || att.type === 'gif' ? 
                                        `<img src="${att.data}" alt="${att.name}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 5px;">` : 
                                        `<div style="width: 100px; height: 100px; background: rgba(67, 97, 238, 0.3); border-radius: 5px; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-file fa-2x"></i>
                                        </div>`
                                    }
                                    <div style="margin-top: 5px; font-size: 12px;">${att.name}</div>
                                </a>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            const actionsDiv = document.getElementById('task-modal-actions');
            actionsDiv.innerHTML = '';
            
            if (!isCompleted) {
                actionsDiv.innerHTML += `
                    <button class="btn btn-success" onclick="completeTask('${taskId}'); closeTaskModal();">
                        <i class="fas fa-check"></i> –û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º
                    </button>
                `;
            }
            
            if (isAdmin) {
                actionsDiv.innerHTML += `
                    <button class="btn btn-danger" onclick="deleteTask('${taskId}'); closeTaskModal();">
                        <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                    </button>
                `;
            }
            
            modal.classList.add('active');
        }

        function completeTask(taskId) {
            if (!currentUser.completedTasks) currentUser.completedTasks = [];
            
            if (currentUser.completedTasks.includes(taskId)) {
                showAlert('–í—ã —É–∂–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ!', 'info');
                return;
            }
            
            Swal.fire({
                title: '–í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ?',
                text: '–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: '–î–∞, –≤—ã–ø–æ–ª–Ω–∏–ª',
                cancelButtonText: '–û—Ç–º–µ–Ω–∞'
            }).then((result) => {
                if (result.isConfirmed) {
                    currentUser.completedTasks.push(taskId);
                    
                    // –ù–∞—á–∏—Å–ª—è–µ–º –æ—á–∫–∏
                    const task = tasks[taskId];
                    const pointsMatch = task.reward.match(/\d+/);
                    if (pointsMatch) {
                        currentUser.points += parseInt(pointsMatch[0]);
                    }
                    
                    saveUserProfile();
                    showAlert('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!', 'success', '–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!');
                }
            });
        }

        function deleteTask(taskId) {
            if (!isAdmin) return;
            
            Swal.fire({
                title: '–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '–£–¥–∞–ª–∏—Ç—å',
                cancelButtonText: '–û—Ç–º–µ–Ω–∞'
            }).then((result) => {
                if (result.isConfirmed) {
                    database.ref('tasks/' + taskId).remove();
                    showAlert('–ó–∞–¥–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ!', 'success');
                }
            });
        }

        // ========== –ú–ï–†–û–ü–†–ò–Ø–¢–ò–Ø ==========
        function loadEvents() {
             if (DEBUG) console.log('loadEvents() –≤—ã–∑–≤–∞–Ω–∞');
    
            // –°–Ω–∞—á–∞–ª–∞ –æ—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–ª—É—à–∞—Ç–µ–ª–µ–π
            if (database.ref('events').off) {
                database.ref('events').off();
            }
            
            // –ó–∞—Ç–µ–º –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –∑–∞–Ω–æ–≤–æ
            database.ref('events').on('value', snapshot => {
                events = snapshot.val() || {};
                
                if (DEBUG) {
                    console.log('–î–∞–Ω–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –ø–æ–ª—É—á–µ–Ω—ã:', events);
                    console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π:', Object.keys(events).length);
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ –≤–∏–¥–∏–º–∞
                const eventsTab = document.getElementById('events-tab');
                if (eventsTab && eventsTab.classList.contains('active')) {
                    displayEvents();
                }
                console.log('eventsTab display:', window.getComputedStyle(eventsTab).display);
                console.log('eventsTab visibility:', window.getComputedStyle(eventsTab).visibility);
                console.log('eventsTab opacity:', window.getComputedStyle(eventsTab).opacity);
                
                // –í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–ª—è —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è
                if (document.getElementById('create-event-form') && 
                    document.getElementById('create-event-form').style.display !== 'none') {
                    loadEventParticipants();
                }
            }, error => {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π:', error);
            });
        }

        function initEventsSystem() {
            loadEvents();
        }

        function displayEvents() {
            console.log('displayEvents –≤—ã–∑–≤–∞–Ω–∞, events:', events);
    
            const eventsList = document.getElementById('events-list');
            
            if (!eventsList) {
                console.error('–≠–ª–µ–º–µ–Ω—Ç events-list –Ω–µ –Ω–∞–π–¥–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—É.');
                return;
            }
            console.log('eventsList display:', window.getComputedStyle(eventsList).display);
            console.log('eventsList visibility:', window.getComputedStyle(eventsList).visibility);
            
            console.log('eventsList –Ω–∞–π–¥–µ–Ω:', eventsList);
            
            eventsList.innerHTML = '';
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ–±—ä–µ–∫—Ç –≤ –º–∞—Å—Å–∏–≤
            const eventsArray = [];
            for (const id in events) {
                if (events.hasOwnProperty(id)) {
                    eventsArray.push({
                        id: id,
                        ...events[id]
                    });
                }
            }
            
            console.log('eventsArray:', eventsArray);
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–±–ª–∏–∂–∞–π—à–∏–µ —Å–≤–µ—Ä—Ö—É)
            eventsArray.sort((a, b) => (a.datetime || 0) - (b.datetime || 0));
            
            if (eventsArray.length === 0) {
                console.log('–ù–µ—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è');
                eventsList.innerHTML = `
                    <div class="event-card" style="text-align: center; padding: 40px; grid-column: 1 / -1;">
                        <div style="font-size: 48px; color: rgba(255,255,255,0.2); margin-bottom: 20px;">
                            <i class="fas fa-calendar-plus"></i>
                        </div>
                        <div style="font-size: 20px; font-weight: 600; margin-bottom: 10px;">–ù–µ—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</div>
                        <div style="color: rgba(255,255,255,0.7); margin-bottom: 20px;">
                            –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
                        </div>
                    </div>
                `;
                return;
            }
            
            console.log('–°–æ–∑–¥–∞—é –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è', eventsArray.length, '–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π');
            
            eventsArray.forEach((event, index) => {
                console.log('–°–æ–∑–¥–∞—é –∫–∞—Ä—Ç–æ—á–∫—É –¥–ª—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è', index + 1, ':', event.title);
                const eventCard = createEventCard(event);
                eventsList.appendChild(eventCard);
            });
            
            console.log('–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
        }

        function createEventCard(event) {
            console.log('createEventCard –¥–ª—è:', event.title);
            
            const now = Date.now();
            const eventTime = event.datetime || 0;
            
            let status = 'upcoming';
            let statusText = '–ü—Ä–µ–¥—Å—Ç–æ—è—â–µ–µ';
            
            if (eventTime < now) {
                status = 'completed';
                statusText = '–ó–∞–≤–µ—Ä—à–µ–Ω–æ';
            } else if (eventTime <= now + 3600000) {
                status = 'ongoing';
                statusText = '–°–µ–π—á–∞—Å';
            }
            
            const eventDate = new Date(eventTime);
            const formattedDate = eventDate.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'short'
            }) + ' ' + eventDate.toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'});
            
            const participantsCount = event.participants ? Object.keys(event.participants).length : 0;
            
            // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—É—é –∫–∞—Ä—Ç–æ—á–∫—É –ë–ï–ó —Å–ª–æ–∂–Ω—ã—Ö —Å—Ç–∏–ª–µ–π
            const card = document.createElement('div');
            card.className = 'event-card-simple'; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å
            card.setAttribute('data-event-id', event.id);
            card.style.cssText = `
                background: rgba(255, 255, 255, 0.05);
                border-radius: 15px;
                padding: 0;
                cursor: pointer;
                transition: all 0.3s;
                border: 1px solid rgba(255, 255, 255, 0.1);
                overflow: hidden;
                margin-bottom: 20px;
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
            `;
            
            card.onclick = function() {
                viewEvent(event.id);
            };
            
            card.innerHTML = `
                <div style="width: 100%; height: 150px; background: linear-gradient(135deg, #4361ee, #3a0ca3); 
                            display: flex; align-items: center; justify-content: center; position: relative;">
                    <i class="fas fa-calendar-alt fa-3x" style="color: rgba(255,255,255,0.3);"></i>
                    <div style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); 
                                color: white; padding: 5px 10px; border-radius: 10px; font-size: 12px; display: flex; align-items: center; gap: 5px;">
                        <i class="fas fa-users"></i> ${participantsCount}
                    </div>
                </div>
                <div style="padding: 20px;">
                    <h3 style="margin: 0 0 10px 0; font-size: 18px; color: white; font-weight: 600;">${event.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h3>
                    <p style="margin: 0 0 15px 0; color: rgba(255,255,255,0.7); font-size: 14px; line-height: 1.5;">
                        ${(event.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è').substring(0, 100)}${(event.description || '').length > 100 ? '...' : ''}
                    </p>
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                        <div style="color: #4cc9f0; font-size: 14px; display: flex; align-items: center; gap: 5px;">
                            <i class="far fa-calendar"></i>
                            <span>${formattedDate}</span>
                        </div>
                        <div style="color: rgba(255,255,255,0.7); font-size: 14px; display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${event.location || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</span>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <span style="background: ${status === 'upcoming' ? '#4361ee' : status === 'ongoing' ? '#4cc9f0' : '#6c757d'}; 
                               color: white; padding: 5px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; display: inline-block;">
                            ${statusText}
                        </span>
                    </div>
                </div>
            `;

            // –î–æ–±–∞–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            database.ref('eventMessages/' + event.id).once('value').then(snapshot => {
                const messages = snapshot.val() || {};
                const count = Object.keys(messages).length;
                
                if (count > 0) {
                    const badge = document.createElement('span');
                    badge.className = 'event-chat-badge';
                    badge.style.cssText = `
                        position: absolute;
                        top: 10px;
                        left: 10px;
                        background: var(--accent);
                        color: white;
                        padding: 2px 6px;
                        border-radius: 10px;
                        font-size: 11px;
                        z-index: 10;
                    `;
                    badge.textContent = count;
                    card.querySelector('div:first-child').appendChild(badge);
                }
            });
                            
            console.log('–ö–∞—Ä—Ç–æ—á–∫–∞ —Å–æ–∑–¥–∞–Ω–∞:', card);
            return card;
        }

        function loadEventParticipants() {
            const participantsDiv = document.getElementById('event-participants');
            if (!participantsDiv) return;
            
            participantsDiv.innerHTML = '';
            
            Object.values(users).forEach(user => {
                if (user.id === currentUser.id) return; // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–±—è
                
                const participantDiv = document.createElement('div');
                participantDiv.className = 'participant-checkbox';
                
                const roleBadge = user.role === 'mentor' ? 
                    '<span class="role-mentor" style="font-size: 10px; padding: 1px 4px;">–ù–∞—Å—Ç–∞–≤–Ω–∏–∫</span>' : 
                    '<span class="role-specialist" style="font-size: 10px; padding: 1px 4px;">–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç</span>';
                
                participantDiv.innerHTML = `
                    <input type="checkbox" id="participant-${user.id}" value="${user.id}">
                    <img src="${user.avatar || getDefaultAvatar(user.username)}" 
                         alt="${user.username}" 
                         style="width: 24px; height: 24px; border-radius: 50%;">
                    <div style="display: flex; flex-direction: column;">
                        <span style="font-size: 14px;">${user.username}</span>
                        ${roleBadge}
                    </div>
                    <small style="color: rgba(255,255,255,0.5); margin-left: auto;">${user.position || ''}</small>
                `;
                
                participantsDiv.appendChild(participantDiv);
            });
        }
        
        function toggleCreateEventForm() {
            const form = document.getElementById('create-event-form');
            const btn = document.getElementById('show-create-event-btn');
            
            if (form.style.display === 'none') {
                form.style.display = 'block';
                btn.innerHTML = '<i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞';
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ —Ñ–æ—Ä–º–∞ –≤–∏–¥–∏–º–∞
                loadEventParticipants();
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–∞—Ç—É (—Å–µ–≥–æ–¥–Ω—è)
                const now = new Date();
                const minDate = now.toISOString().slice(0, 16);
                const datetimeInput = document.getElementById('event-datetime');
                if (datetimeInput) {
                    datetimeInput.min = minDate;
                    
                    // –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—É (—á–µ—Ä–µ–∑ 2 —á–∞—Å–∞)
                    const futureDate = new Date(now.getTime() + 2 * 60 * 60 * 1000);
                    datetimeInput.value = futureDate.toISOString().slice(0, 16);
                }
                
            } else {
                form.style.display = 'none';
                btn.innerHTML = '<i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ';
                clearEventForm();
            }
        }
        
        function clearEventForm() {
            document.getElementById('event-title').value = '';
            document.getElementById('event-description').value = '';
            document.getElementById('event-datetime').value = '';
            document.getElementById('event-location').value = '';
            document.getElementById('event-image').value = '';
            document.getElementById('event-image-preview-img').style.display = 'none';
            eventImage = null;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —á–µ–∫–±–æ–∫—Å—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            document.querySelectorAll('#event-participants input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
        document.getElementById('event-image')?.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (file.size > 5 * 1024 * 1024) {
                showAlert('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ! –ú–∞–∫—Å–∏–º—É–º 5MB', 'error');
                this.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                eventImage = e.target.result;
                const preview = document.getElementById('event-image-preview-img');
                preview.src = eventImage;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        });
        
        function createNewEvent() {
            if (!isAdmin) {
                showAlert('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞', 'error', '–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è!');
                return;
            }
            
            const title = document.getElementById('event-title').value.trim();
            const description = document.getElementById('event-description').value.trim();
            const datetimeInput = document.getElementById('event-datetime').value;
            const location = document.getElementById('event-location').value.trim();
            
            if (!title || !description || !datetimeInput) {
                showAlert('–û—à–∏–±–∫–∞', 'warning', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }
            
            const datetime = new Date(datetimeInput).getTime();
            if (isNaN(datetime)) {
                showAlert('–û—à–∏–±–∫–∞', 'warning', '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è!');
                return;
            }
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            const selectedParticipants = [];
            document.querySelectorAll('#event-participants input[type="checkbox"]:checked').forEach(cb => {
                selectedParticipants.push(cb.value);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–∑–¥–∞—Ç–µ–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            if (!selectedParticipants.includes(currentUser.id)) {
                selectedParticipants.push(currentUser.id);
            }
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –æ–±—ä–µ–∫—Ç –¥–ª—è Firebase
            const participantsObj = {};
            selectedParticipants.forEach(id => {
                participantsObj[id] = true;
            });
            
            const eventId = generateId();
            const eventData = {
                id: eventId,
                title: title,
                description: description,
                datetime: datetime,
                location: location || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
                image: eventImage,
                createdBy: currentUser.id,
                createdByName: currentUser.username,
                createdAt: Date.now(),
                participants: participantsObj,
                status: 'upcoming'
            };
            
            database.ref('events/' + eventId).set(eventData)
                .then(() => {
                    showAlert('–£—Å–ø–µ—Ö!', 'success', '–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–æ!');
                    clearEventForm();
                    toggleCreateEventForm();
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞:', error);
                    showAlert('–û—à–∏–±–∫–∞', 'error', '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ');
                });
        }
        
        function viewEvent(eventId) {
            const event = events[eventId];
            if (!event) return;
            
            currentEventId = eventId;
            
            const modal = document.getElementById('event-modal');
            const now = Date.now();
            const isParticipant = event.participants && event.participants[currentUser.id];
            
            // –û–±–ª–æ–∂–∫–∞
            const image = document.getElementById('event-modal-image');
            if (event.image) {
                image.src = event.image;
                image.style.display = 'block';
            } else {
                image.style.display = 'none';
            }
            
            // –°—Ç–∞—Ç—É—Å
            const status = document.getElementById('event-modal-status');
            let statusText = '–ü—Ä–µ–¥—Å—Ç–æ—è—â–µ–µ';
            let statusClass = 'status-upcoming';
            
            if (event.datetime < now) {
                statusText = '–ó–∞–≤–µ—Ä—à–µ–Ω–æ';
                statusClass = 'status-completed';
            } else if (event.datetime <= now + 3600000) {
                statusText = '–°–µ–π—á–∞—Å';
                statusClass = 'status-ongoing';
            }
            
            status.textContent = statusText;
            status.className = statusClass;
            
            // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            document.getElementById('event-modal-title').textContent = event.title;
            
            const eventDate = new Date(event.datetime);
            document.getElementById('event-modal-date').textContent = 
                eventDate.toLocaleString('ru-RU', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            
            document.getElementById('event-modal-location').textContent = event.location || '–ú–µ—Å—Ç–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ';
            document.getElementById('event-modal-description').textContent = event.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è';
            
            // –£—á–∞—Å—Ç–Ω–∏–∫–∏
            const participantsDiv = document.getElementById('event-modal-participants');
            participantsDiv.innerHTML = '';
            
            const participantsCount = event.participants ? Object.keys(event.participants).length : 0;
            document.getElementById('event-modal-participants-count').textContent = `${participantsCount} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤`;
            document.getElementById('event-modal-participants-count-2').textContent = participantsCount;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–≤–∞—Ç–∞—Ä—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            if (event.participants) {
                Object.keys(event.participants).forEach(userId => {
                    const user = users[userId];
                    if (user) {
                        const participant = document.createElement('div');
                        participant.className = 'participant-item';
                        
                        const roleBadge = user.role === 'mentor' ? 
                            '<span class="role-mentor" style="font-size: 9px; margin-top: 2px;">–ù–∞—Å—Ç–∞–≤–Ω–∏–∫</span>' : 
                            '<span class="role-specialist" style="font-size: 9px; margin-top: 2px;">–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç</span>';
                        
                        participant.innerHTML = `
                            <img src="${user.avatar || getDefaultAvatar(user.username)}" 
                                 alt="${user.username}" 
                                 class="participant-avatar"
                                 title="${user.username}">
                            <div class="participant-name">${user.username}</div>
                            ${roleBadge}
                        `;
                        participantsDiv.appendChild(participant);
                    }
                });
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
            database.ref('eventMessages/' + eventId).once('value').then(snapshot => {
                const messages = snapshot.val() || {};
                updateEventChatCounter(eventId, Object.keys(messages).length);
            });
            
            // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            const actionsDiv = document.getElementById('event-modal-actions');
            actionsDiv.innerHTML = '';
            
            if (isAdmin) {
                actionsDiv.innerHTML += `
                    <button class="btn btn-danger" onclick="deleteEvent('${eventId}')">
                        <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                    </button>
                `;
            }
            
            if (!isParticipant && event.datetime > now) {
                actionsDiv.innerHTML += `
                    <button class="btn btn-primary" onclick="joinEvent('${eventId}')">
                        <i class="fas fa-user-plus"></i> –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
                    </button>
                `;
            } else if (isParticipant && event.datetime > now) {
                actionsDiv.innerHTML += `
                    <button class="btn btn-warning" onclick="leaveEvent('${eventId}')">
                        <i class="fas fa-user-minus"></i> –ü–æ–∫–∏–Ω—É—Ç—å
                    </button>
                `;
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫–∏ –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            switchEventTab('info');
            
            modal.classList.add('active');
        }
        
        function closeEventModal() {
            if (eventMessagesListener) {
                database.ref('eventMessages/' + currentEventId).off();
                eventMessagesListener = null;
            }
            currentEventId = null;
            document.getElementById('event-modal').classList.remove('active');
        }
        
        function joinEvent(eventId) {
            if (!currentUser) return;
            
            database.ref(`events/${eventId}/participants/${currentUser.id}`).set(true)
                .then(() => {
                    showAlert('–£—Å–ø–µ—Ö!', 'success', '–í—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—é');
                    closeEventModal();
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞:', error);
                    showAlert('–û—à–∏–±–∫–∞', 'error', '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è');
                });
        }
        
        function leaveEvent(eventId) {
            if (!currentUser) return;
            
            database.ref(`events/${eventId}/participants/${currentUser.id}`).remove()
                .then(() => {
                    showAlert('–£—Å–ø–µ—Ö!', 'success', '–í—ã –ø–æ–∫–∏–Ω—É–ª–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ');
                    closeEventModal();
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞:', error);
                    showAlert('–û—à–∏–±–∫–∞', 'error', '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–∫–∏–Ω—É—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ');
                });
        }
        
        function deleteEvent(eventId) {
            if (!isAdmin) return;
            
            Swal.fire({
                title: '–£–¥–∞–ª–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ?',
                text: '–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '–£–¥–∞–ª–∏—Ç—å',
                cancelButtonText: '–û—Ç–º–µ–Ω–∞'
            }).then((result) => {
                if (result.isConfirmed) {
                    database.ref('events/' + eventId).remove()
                        .then(() => {
                            showAlert('–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ —É–¥–∞–ª–µ–Ω–æ!', 'success');
                            closeEventModal();
                        })
                        .catch(error => {
                            console.error('–û—à–∏–±–∫–∞:', error);
                            showAlert('–û—à–∏–±–∫–∞', 'error', '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ');
                        });
                }
            });
        }

        function switchEventTab(tabName) {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫ –∏ –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.event-tab-content').forEach(tab => {
                tab.style.display = 'none';
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.event-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É –∏ –∫–Ω–æ–ø–∫—É
            const tabContent = document.getElementById('event-tab-' + tabName);
            const tabBtn = document.querySelector(`.event-tab-btn[data-tab="${tabName}"]`);
            
            if (tabContent) {
                tabContent.style.display = tabName === 'chat' ? 'flex' : 'block';
                tabContent.classList.add('active');
            }
            
            if (tabBtn) {
                tabBtn.classList.add('active');
            }
            
            // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–ª–∏ –≤–∫–ª–∞–¥–∫—É —á–∞—Ç–∞, –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            if (tabName === 'chat' && currentEventId) {
                loadEventMessages(currentEventId);
            }
        }
        
        function loadEventMessages(eventId) {
            if (eventMessagesListener) {
                // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–ª—É—à–∞—Ç–µ–ª—è
                database.ref('eventMessages/' + eventId).off();
            }
            
            const messagesContainer = document.getElementById('event-chat-messages');
            if (!messagesContainer) return;
            
            messagesContainer.innerHTML = '<div class="loading-status"><i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π...</div>';
            
            // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
            eventMessagesListener = database.ref('eventMessages/' + eventId)
                .limitToLast(50)
                .on('value', snapshot => {
                    const messages = snapshot.val() || {};
                    displayEventMessages(messages);
                    updateEventChatCounter(eventId, Object.keys(messages).length);
                });
        }
        
        function displayEventMessages(messages) {
            const messagesContainer = document.getElementById('event-chat-messages');
            if (!messagesContainer) return;
            
            messagesContainer.innerHTML = '';
            
            const messagesArray = Object.values(messages).sort((a, b) => a.timestamp - b.timestamp);
            
            if (messagesArray.length === 0) {
                messagesContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
                        <i class="fas fa-comments fa-2x" style="margin-bottom: 10px;"></i>
                        <div>–û–±—Å—É–∂–¥–µ–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª–æ—Å—å</div>
                        <div style="font-size: 12px; margin-top: 5px;">–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –æ—Å—Ç–∞–≤–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ!</div>
                    </div>
                `;
                return;
            }
            
            messagesArray.forEach(message => {
                const messageElement = createEventMessageElement(message);
                messagesContainer.appendChild(messageElement);
            });
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function createEventMessageElement(message) {
            const div = document.createElement('div');
            div.className = 'event-chat-message';
            
            const isCurrentUser = message.userId === currentUser?.id;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º timestamp
            const timestamp = message.firebaseTimestamp || message.timestamp || message.localTimestamp || Date.now();
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–°–∞–º–∞—Ä–∞ UTC+4)
            const displayTime = formatSamaraDateTime(timestamp);
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–æ–ª—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            let roleBadge = '';
            const user = users[message.userId];
            if (user) {
                if (user.role === 'mentor') {
                    roleBadge = '<span class="role-mentor" style="font-size: 10px; padding: 1px 4px;">–ù–∞—Å—Ç–∞–≤–Ω–∏–∫</span>';
                } else if (user.role === 'specialist') {
                    roleBadge = '<span class="role-specialist" style="font-size: 10px; padding: 1px 4px;">–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç</span>';
                }
            }
            
            div.innerHTML = `
                <div class="event-chat-message-header">
                    <img src="${message.userAvatar || getDefaultAvatar(message.username)}" 
                         alt="${message.username}" 
                         class="event-chat-avatar">
                    <div class="event-chat-sender">
                        ${message.username}
                        ${roleBadge}
                        ${isCurrentUser ? ' <span style="font-size: 11px; color: var(--primary);">(–í—ã)</span>' : ''}
                    </div>
                    <div class="event-chat-time">
                        ${displayTime}
                    </div>
                </div>
                <div class="event-chat-text">${message.text}</div>
                ${message.attachment ? `
                    <div style="margin-top: 8px;">
                        <small style="color: rgba(255,255,255,0.7);">
                            <i class="fas fa-paperclip"></i> –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω —Ñ–∞–π–ª: ${message.attachment.name}
                        </small>
                    </div>
                ` : ''}
            `;
            
            return div;
        }
        
        function sendEventMessage() {
            if (!currentEventId) {
                showAlert('–û—à–∏–±–∫–∞', 'error', '–ù–µ –≤—ã–±—Ä–∞–Ω–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ');
                return;
            }
            
            const input = document.getElementById('event-chat-input');
            const text = input.value.trim();
            
            if (!text) {
                showAlert('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!', 'warning');
                return;
            }
            
            const serverTimestamp = firebase.database.ServerValue.TIMESTAMP;
            
            const message = {
                id: generateId(),
                text: text,
                userId: currentUser.id,
                username: currentUser.username,
                userAvatar: currentUser.avatar || getDefaultAvatar(currentUser.username),
                timestamp: serverTimestamp,
                firebaseTimestamp: serverTimestamp,
                localTimestamp: Date.now(),
                eventId: currentEventId,
                timezone: 'UTC+4'
            };
            
            // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            input.value = '';
            input.style.height = 'auto';
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            const sendBtn = document.querySelector('#event-tab-chat .btn-primary');
            if (sendBtn) {
                const originalHTML = sendBtn.innerHTML;
                sendBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                sendBtn.disabled = true;
                
                setTimeout(() => {
                    sendBtn.innerHTML = originalHTML;
                    sendBtn.disabled = false;
                }, 500);
            }
            
            database.ref(`eventMessages/${currentEventId}/${message.id}`).set(message)
                .then(() => {
                    input.focus();
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
                    input.value = text;
                    showAlert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏', 'error', '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑');
                });
        }
        
        function updateEventChatCounter(eventId, count) {
            const counter = document.getElementById('event-chat-counter');
            if (counter) {
                counter.textContent = count;
            }
            
            // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
            const eventCard = document.querySelector(`.event-card-simple[data-event-id="${eventId}"]`);
            if (eventCard) {
                const existingBadge = eventCard.querySelector('.event-chat-badge');
                if (existingBadge) {
                    existingBadge.textContent = count;
                } else if (count > 0) {
                    const badge = document.createElement('span');
                    badge.className = 'event-chat-badge';
                    badge.style.cssText = `
                        position: absolute;
                        top: 10px;
                        left: 10px;
                        background: var(--accent);
                        color: white;
                        padding: 2px 6px;
                        border-radius: 10px;
                        font-size: 11px;
                    `;
                    badge.textContent = count;
                    eventCard.querySelector('div:first-child').appendChild(badge);
                }
            }
        }
        
        // ========== –ê–î–ê–ü–¢–ê–¶–ò–Ø ==========
        function loadMaterials() {
            // –ó–∞–≥–ª—É—à–∫–∞ - –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
            const materialsList = document.getElementById('materials-list');
            materialsList.innerHTML = `
                <div class="material-item">
                    <div class="material-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="material-content">
                        <div class="material-title">–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏</div>
                        <div class="material-description">–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>
                    </div>
                </div>
                <div class="material-item">
                    <div class="material-icon">
                        <i class="fas fa-video"></i>
                    </div>
                    <div class="material-content">
                        <div class="material-title">–û–±—É—á–∞—é—â–∏–µ –≤–∏–¥–µ–æ</div>
                        <div class="material-description">–í–∏–¥–µ–æ—É—Ä–æ–∫–∏ –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Å–∏—Å—Ç–µ–º–æ–π</div>
                    </div>
                </div>
                <div class="material-item">
                    <div class="material-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="material-content">
                        <div class="material-title">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏</div>
                        <div class="material-description">–î–æ–∫—É–º–µ–Ω—Ç—ã –∏ –ø–æ–ª–∏—Ç–∏–∫–∏ –∫–æ–º–ø–∞–Ω–∏–∏</div>
                    </div>
                </div>
            `;
        }

        // ========== –í–õ–û–ñ–ï–ù–ò–Ø ==========
        function openAttachmentModal() {
            document.getElementById('attachment-modal').classList.add('active');
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–∏–ø –≤–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
            attachmentType = 'image';
            document.getElementById('file-input').accept = 'image/*';
        }

        function closeAttachmentModal() {
            document.getElementById('attachment-modal').classList.remove('active');
            document.getElementById('attachment-preview').style.display = 'none';
            document.getElementById('preview-container').innerHTML = '';
            document.getElementById('file-input').value = '';
            // –ù–ï —Å–±—Ä–∞—Å—ã–≤–∞–µ–º currentAttachment –∑–¥–µ—Å—å, —Ç–æ–ª—å–∫–æ –≤ –º–æ–¥–∞–ª–∫–µ
        }

        function selectAttachmentType(type) {
            attachmentType = type;
            const input = document.getElementById('file-input');
            input.accept = type === 'image' ? 'image/*' : 
                          type === 'gif' ? '.gif,image/gif' : 
                          type === 'video' ? 'video/*' : '*/*';
        }

        function previewAttachment(file) {
            if (!file) return;
                
                if (file.size > 5 * 1024 * 1024) {
                    showAlert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º 5MB', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentAttachment = {
                        type: attachmentType,
                        data: e.target.result,
                        name: file.name,
                        size: file.size
                    };
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
                    const previewContainer = document.getElementById('preview-container');
                    if (previewContainer) {
                        previewContainer.innerHTML = '';
                        if (attachmentType === 'image' || attachmentType === 'gif') {
                            previewContainer.innerHTML = `<img src="${e.target.result}" style="max-width: 200px; border-radius: 10px;">`;
                        } else if (attachmentType === 'video') {
                            previewContainer.innerHTML = `
                                <video controls style="max-width: 200px; border-radius: 10px;">
                                    <source src="${e.target.result}" type="${file.type}">
                                </video>
                            `;
                        } else {
                            previewContainer.innerHTML = `
                                <div style="padding: 20px; text-align: center; background: rgba(67, 97, 238, 0.1); border-radius: 10px;">
                                    <i class="fas fa-file fa-2x"></i>
                                    <div style="margin-top: 10px;">${file.name}</div>
                                </div>
                            `;
                        }
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                        document.getElementById('attachment-preview').style.display = 'block';
                    }
                };
                reader.readAsDataURL(file);
        }

        function attachFile() {
            if (!currentAttachment) {
                showAlert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª!', 'warning');
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞–¥ –ø–æ–ª–µ–º –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            updateAttachmentPreview();
            
            closeAttachmentModal();
            showAlert('–§–∞–π–ª –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω!', 'success');
            
            // –§–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            document.getElementById('message-input').focus();
        }

        // ========== –ü–†–û–§–ò–õ–¨ ==========
        function openProfileModal() {
            document.getElementById('profile-modal').classList.add('active');
            document.getElementById('profile-username').value = currentUser.username;
            document.getElementById('profile-role').value = currentUser.roleText || 
                (currentUser.role === 'mentor' ? '–ù–∞—Å—Ç–∞–≤–Ω–∏–∫' : '–ú–æ–ª–æ–¥–æ–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç');
            document.getElementById('profile-position').value = currentUser.position || '';
            document.getElementById('profile-organization').value = currentUser.organization || '';
        }

        function closeProfileModal() {
            document.getElementById('profile-modal').classList.remove('active');
        }

        function uploadAvatar(file) {
            if (!file) return;
            
            if (file.size > 2 * 1024 * 1024) {
                showAlert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º 2MB', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('avatar-preview').src = e.target.result;
                currentUser.avatar = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function saveProfile() {
            const username = document.getElementById('profile-username').value.trim();
            const position = document.getElementById('profile-position').value.trim();
            const organization = document.getElementById('profile-organization').value.trim();
            const avatar = document.getElementById('avatar-preview').src;
            
            if (!username) {
                showAlert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!', 'warning');
                return;
            }
            
            currentUser.username = username;
            currentUser.position = position;
            currentUser.organization = organization;
            currentUser.avatar = avatar;
            
            saveUserProfile();
            updateProfileUI();
            closeProfileModal();
            
            showAlert('–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
        }

        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function generateId() {
            return Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function showAlert(title, icon = 'success', text = '') {
            Swal.fire({
                title: title,
                text: text,
                icon: icon,
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true
            });
        }

        function viewImage(url) {
            const newWindow = window.open();
            newWindow.document.write(`
                <html>
                    <head>
                        <style>
                            body { margin: 0; padding: 20px; background: #1a1a2e; text-align: center; }
                            img { max-width: 90vw; max-height: 90vh; border-radius: 10px; }
                        </style>
                    </head>
                    <body>
                        <img src="${url}">
                    </body>
                </html>
            `);
        }

        function downloadAttachment(data, name) {
            const link = document.createElement('a');
            link.href = data;
            link.download = name;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function closeTaskModal() {
            document.getElementById('task-modal').classList.remove('active');
        }

        function setupEventListeners() {

            // –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
            const menuToggle = document.getElementById('menu-toggle');
            const navLinks = document.querySelector('.nav-links');
            
            if (menuToggle && navLinks) {
                menuToggle.addEventListener('click', function(e) {
                    e.stopPropagation();
                    navLinks.classList.toggle('active');
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –º–µ–Ω—é
                    const usersSidebar = document.querySelector('.users-sidebar');
                    if (usersSidebar && usersSidebar.classList.contains('active')) {
                        usersSidebar.classList.remove('active');
                    }
                    
                    const emojiPicker = document.getElementById('emoji-picker');
                    if (emojiPicker && emojiPicker.style.display === 'block') {
                        emojiPicker.style.display = 'none';
                        emojiPickerVisible = false;
                    }
                });
                
                // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å—Å—ã–ª–∫—É
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', () => {
                        navLinks.classList.remove('active');
                    });
                });
                
                // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
                document.addEventListener('click', function(event) {
                    if (!event.target.closest('.nav-links') && !event.target.closest('#menu-toggle')) {
                        navLinks.classList.remove('active');
                    }
                });
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
            const toggleUsersBtn = document.getElementById('toggle-users-btn');
            if (toggleUsersBtn) {
                toggleUsersBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const usersSidebar = document.querySelector('.users-sidebar');
                    if (usersSidebar) {
                        usersSidebar.classList.toggle('active');
                        usersSidebar.classList.toggle('hidden-mobile');
                    }
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ
                    if (navLinks && navLinks.classList.contains('active')) {
                        navLinks.classList.remove('active');
                    }
                });
            }
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ Enter (—Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π)
            document.getElementById('message-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // –ê–≤—Ç–æ—Ä–∞–∑–º–µ—Ä textarea —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
            document.getElementById('message-input').addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 150) + 'px';
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏ —ç–º–æ–¥–∑–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ—ë
            document.addEventListener('click', function(event) {
                const picker = document.getElementById('emoji-picker');
                const emojiBtn = document.querySelector('.chat-btn .fa-smile')?.closest('.chat-btn');
                
                if (picker && emojiPickerVisible && 
                    !picker.contains(event.target) && 
                    !emojiBtn?.contains(event.target)) {
                    picker.style.display = 'none';
                    emojiPickerVisible = false;
                }
            });

            // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
            const messageInput = document.getElementById('message-input');
            let lastSendTime = 0;
            const SEND_COOLDOWN = 500; // 500ms cooldown

            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    const now = Date.now();
                    if (now - lastSendTime < SEND_COOLDOWN) {
                        e.preventDefault();
                        return;
                    }
                    lastSendTime = now;
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ –≤ –º–æ–¥–∞–ª–∫–µ
            document.getElementById('file-input').addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    previewAttachment(e.target.files[0]);
                }
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
            document.addEventListener('click', function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.classList.remove('active');
                }
            });

            // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            window.addEventListener('unload', function() {
                if (currentUser && currentUser.id) {
                    setUserStatus('offline');
                }
            });

            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –ø–æ Enter
            document.getElementById('event-chat-input')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendEventMessage();
                }
            });
            
            // –ê–≤—Ç–æ—Ä–∞–∑–º–µ—Ä textarea –≤ —á–∞—Ç–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
            document.getElementById('event-chat-input')?.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 100) + 'px';
            });

            // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ "–û—Ç–≤–µ—Ç–∏—Ç—å" (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
            document.addEventListener('click', function(event) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∞ –ª–∏ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–û—Ç–≤–µ—Ç–∏—Ç—å"
                const replyBtn = event.target.closest('.reply-btn');
                if (replyBtn) {
                    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ, —á—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –¥—Ä—É–≥–∏–º–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏
                    event.preventDefault();
                    event.stopPropagation();
                    
                    // –ù–∞—Ö–æ–¥–∏–º –±–ª–∏–∂–∞–π—à–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    const messageElement = replyBtn.closest('.message');
                    if (messageElement) {
                        const messageId = messageElement.dataset.messageId;
                        const messageText = messageElement.querySelector('.message-text')?.textContent || '';
                        const senderName = messageElement.querySelector('.message-sender')?.textContent || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                        
                        // –£–±–∏—Ä–∞–µ–º —Ä–æ–ª—å –∏–∑ –∏–º–µ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
                        const cleanSenderName = senderName.replace(/<span[^>]*>.*?<\/span>/g, '').trim();
                        
                        setReplyTo(messageId, cleanSenderName, messageText);
                    }
                }
            });

            // –û—Ç–º–µ–Ω–∞ –æ—Ç–≤–µ—Ç–∞ –ø–æ Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && currentReply) {
                    cancelReply();
                }
            });
        }

        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –í–†–ï–ú–ï–ù–ò ==========
        function getSamaraTime(timestamp) {
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º timestamp –≤ –æ–±—ä–µ–∫—Ç Date
            const date = new Date(timestamp);
            
            // –ü–æ–ª—É—á–∞–µ–º –≤—Ä–µ–º—è –≤ UTC
            const utcHours = date.getUTCHours();
            const utcMinutes = date.getUTCMinutes();
            const utcSeconds = date.getUTCSeconds();
            
            // –î–æ–±–∞–≤–ª—è–µ–º 4 —á–∞—Å–∞ –¥–ª—è –°–∞–º–∞—Ä—ã (UTC+4)
            const samaraHours = (utcHours + 4) % 24;
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const hours = samaraHours.toString().padStart(2, '0');
            const minutes = utcMinutes.toString().padStart(2, '0');
            
            return `${hours}:${minutes}`;
        }
        
        function formatSamaraDateTime(timestamp) {
            const date = new Date(timestamp);
            
            // –î–æ–±–∞–≤–ª—è–µ–º 4 —á–∞—Å–∞ –¥–ª—è –°–∞–º–∞—Ä—ã
            const samaraTime = new Date(date.getTime() + (4 * 60 * 60 * 1000));
            
            const today = new Date();
            const isToday = samaraTime.toDateString() === today.toDateString();
            
            const hours = samaraTime.getUTCHours().toString().padStart(2, '0');
            const minutes = samaraTime.getUTCMinutes().toString().padStart(2, '0');
            
            if (isToday) {
                return `${hours}:${minutes}`;
            } else {
                const day = samaraTime.getUTCDate();
                const month = samaraTime.toLocaleDateString('ru-RU', { month: 'short' });
                return `${hours}:${minutes} ‚Ä¢ ${day} ${month}`;
            }
        }

        // ========== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –≠–ú–û–î–ó–ò ==========
        function toggleEmojiPicker() {
            const picker = document.getElementById('emoji-picker');
            if (picker.style.display === 'none') {
                picker.style.display = 'block';
                emojiPickerVisible = true;
                showEmojiCategory('smileys');
            } else {
                picker.style.display = 'none';
                emojiPickerVisible = false;
            }
        }
        
        function showEmojiCategory(category, eventParam = null) {
            const grid = document.getElementById('emoji-grid');
            const emojis = emojiCategories[category] || [];
            
            grid.innerHTML = '';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            document.querySelectorAll('.emoji-category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º eventParam –µ—Å–ª–∏ –æ–Ω –ø–µ—Ä–µ–¥–∞–Ω, –∏–Ω–∞—á–µ –∏—â–µ–º –∫–Ω–æ–ø–∫—É –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            let targetButton = eventParam ? eventParam.currentTarget || eventParam.target : 
                document.querySelector(`.emoji-category-btn[onclick*="${category}"]`);
            
            if (targetButton) {
                targetButton.classList.add('active');
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —ç–º–æ–¥–∑–∏ –≤ —Å–µ—Ç–∫—É
            emojis.forEach(emoji => {
                const btn = document.createElement('button');
                btn.className = 'emoji-btn';
                btn.textContent = emoji;
                btn.onclick = () => insertEmoji(emoji);
                grid.appendChild(btn);
            });
        }
        
        function insertEmoji(emoji) {
            const input = document.getElementById('message-input');
            const cursorPos = input.selectionStart;
            const textBefore = input.value.substring(0, cursorPos);
            const textAfter = input.value.substring(cursorPos);
            
            input.value = textBefore + emoji + textAfter;
            input.focus();
            input.selectionStart = input.selectionEnd = cursorPos + emoji.length;
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —ç–º–æ–¥–∑–∏ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞
            document.getElementById('emoji-picker').style.display = 'none';
            emojiPickerVisible = false;
        }
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏:
        function toggleUsersSidebar() {
            const usersSidebar = document.querySelector('.users-sidebar');
            if (usersSidebar) {
                usersSidebar.classList.toggle('active');
                usersSidebar.classList.toggle('hidden-mobile');
            }
        }
        
        // –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ —ç–∫—Ä–∞–Ω–∞:
        window.addEventListener('orientationchange', function() {
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ—Å—á–µ—Ç layout
            setTimeout(function() {
                window.dispatchEvent(new Event('resize'));
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –º–µ–Ω—é
                document.querySelector('.nav-links')?.classList.remove('active');
                document.querySelector('.users-sidebar')?.classList.remove('active');
                document.getElementById('emoji-picker').style.display = 'none';
                emojiPickerVisible = false;
            }, 300);
        });
        
        // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å–∫—Ä–æ–ª–ª —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ
        let viewport = document.querySelector("meta[name=viewport]");
        if (viewport) {
            viewport.setAttribute("content", viewport.content + ", height=" + window.innerHeight);
        }
        
        // –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
        window.addEventListener('resize', function() {
            if (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA') {
                window.setTimeout(function() {
                    document.activeElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
            }
        });
    </script>
</body>
</html>
