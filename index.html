<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî• Advanced Chat - –í—Å–µ –≤ –æ–¥–Ω–æ–º</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ */
        .attachment-preview {
            background: rgba(67, 97, 238, 0.1);
            border: 2px solid var(--primary);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
            display: none;
        }
        
        .attachment-preview.visible {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .attachment-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        
        .attachment-icon {
            width: 40px;
            height: 40px;
            background: rgba(67, 97, 238, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .attachment-details {
            flex: 1;
        }
        
        .attachment-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .attachment-size {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .remove-attachment {
            background: rgba(230, 57, 70, 0.2);
            color: var(--danger);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .chat-input-wrapper {
            display: flex;
            flex-direction: column;
        }
        
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #e63946;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --gray: #6c757d;
            --online: #4CAF50;
            --offline: #757575;
            --away: #FF9800;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .navbar {
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #4361ee, #f72585);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-links {
            display: flex;
            gap: 25px;
            list-style: none;
        }

        .nav-link {
            color: var(--light);
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 25px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(67, 97, 238, 0.2);
            color: #fff;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 3px solid var(--primary);
            cursor: pointer;
            object-fit: cover;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .user-name {
            font-weight: 600;
            font-size: 16px;
        }

        .user-status {
            font-size: 12px;
            margin-top: 2px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ */
        .user-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        
        .status-online { background: #4CAF50; box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.3); }
        .status-offline { background: #757575; box-shadow: 0 0 0 2px rgba(117, 117, 117, 0.3); }
        .status-away { background: #FF9800; box-shadow: 0 0 0 2px rgba(255, 152, 0, 0.3); }
        .status-busy { background: #F44336; box-shadow: 0 0 0 2px rgba(244, 67, 54, 0.3); }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .container {
            margin-top: 80px;
            padding: 20px;
            min-height: calc(100vh - 80px);
        }

        /* –í–∫–ª–∞–¥–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* –ß–∞—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .chat-container {
            display: flex;
            gap: 20px;
            height: 75vh;
        }

        /* ========== –°–¢–ò–õ–ò –î–õ–Ø –í–ö–õ–ê–î–ö–ò –ß–ê–¢–ê ========== */
        .users-sidebar {
            width: 300px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .users-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .users-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .users-count {
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ —Å—Ç–∞—Ç—É—Å–æ–≤ */
        .users-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            padding: 8px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
            min-width: 70px;
        }
        
        .tab-btn.active {
            background: rgba(67, 97, 238, 0.3);
            color: white;
            border-color: var(--primary);
        }

        .users-list {
            flex: 1;
            overflow-y: auto;
        }

        .user-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .user-card:hover {
            background: rgba(67, 97, 238, 0.1);
        }

        .user-avatar-sm {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            position: relative;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–∞—Ä—Ç–æ—á–∫–µ */
        .status-badge {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid var(--dark);
        }

        .status-badge.online { background: var(--online); }
        .status-badge.offline { background: var(--offline); }
        .status-badge.away { background: var(--away); }
        .status-badge.busy { background: var(--danger); }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ */
        .loading-status {
            text-align: center;
            padding: 20px;
            color: rgba(255, 255, 255, 0.5);
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ */
        .last-seen {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 2px;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .status-pulse {
            animation: pulse 2s infinite;
        }

        .user-details {
            flex: 1;
        }

        .user-details-name {
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-details-role {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ */
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
        }

        .chat-header {
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            display: flex;
            gap: 12px;
            max-width: 70%;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.sent {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
        }

        .message-content {
            background: rgba(67, 97, 238, 0.2);
            padding: 12px 16px;
            border-radius: 18px;
            border-top-left-radius: 4px;
        }

        .message.sent .message-content {
            background: rgba(76, 201, 240, 0.3);
            border-top-left-radius: 18px;
            border-top-right-radius: 4px;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .message-sender {
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .message-role {
            font-size: 11px;
            color: var(--success);
            background: rgba(76, 201, 240, 0.2);
            padding: 2px 6px;
            border-radius: 8px;
        }

        .message-time {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
        }

        .message-text {
            font-size: 14px;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .message-attachment {
            margin-top: 8px;
            max-width: 300px;
        }

        .attachment-image {
            max-width: 100%;
            border-radius: 10px;
            cursor: pointer;
        }

        .chat-input {
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 10px;
        }

        .message-input {
            flex: 1;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: var(--light);
            font-size: 15px;
            resize: none;
            min-height: 50px;
        }

        .chat-btn {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        /* ========== –°–¢–ò–õ–ò –î–õ–Ø –í–ö–õ–ê–î–ö–ò –ó–ê–î–ê–ù–ò–ô ========== */
        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .task-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .task-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .task-card.completed {
            border-left: 4px solid var(--success);
        }

        .task-card.active {
            border-left: 4px solid var(--primary);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .task-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .task-reward {
            background: linear-gradient(135deg, var(--warning), #f8961e);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .task-description {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .task-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        /* –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è */
        .create-task-form {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid rgba(67, 97, 238, 0.3);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
        }

        /* –°—Ç–∏–ª—å –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ –ø—Ä–æ—Ñ–∏–ª–µ */
        .form-control {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        .file-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .preview-item {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
        }

        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .remove-preview {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* ========== –°–¢–ò–õ–ò –î–õ–Ø –í–ö–õ–ê–î–ö–ò –ú–ï–†–û–ü–†–ò–Ø–¢–ò–ô ========== */
        .event-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 0;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
            overflow: hidden;
            position: relative;
        }
        
        .event-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .event-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .event-content {
            padding: 20px;
        }
        
        .event-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .event-description {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 15px;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .event-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--gray);
            margin-top: 15px;
        }
        
        .event-date {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--success);
        }
        
        .event-location {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .event-participants {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .participant-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid var(--dark);
            object-fit: cover;
        }
        
        .participant-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 60px;
        }
        
        .participant-name {
            font-size: 11px;
            margin-top: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }
        
        .participant-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
            margin-bottom: 5px;
            cursor: pointer;
        }
        
        .participant-checkbox:hover {
            background: rgba(67, 97, 238, 0.1);
        }
        
        .participant-checkbox input[type="checkbox"] {
            cursor: pointer;
        }
        
        .status-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .status-upcoming { background: var(--primary); color: white; }
        .status-ongoing { background: var(--success); color: white; }
        .status-completed { background: var(--gray); color: white; }
        .status-cancelled { background: var(--danger); color: white; }

        /* ========== –°–¢–ò–õ–ò –î–õ–Ø –í–ö–õ–ê–î–ö–ò –ê–î–ê–ü–¢–ê–¶–ò–ò ========== */
        .materials-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .material-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .material-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--success), #2a9d8f);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .material-content {
            flex: 1;
        }

        .material-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .material-description {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--dark);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å */
        .admin-panel {
            background: rgba(229, 57, 70, 0.1);
            border: 1px solid var(--danger);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .navbar {
                padding: 10px 15px;
            }
            
            .nav-links {
                display: none;
            }
            
            .chat-container {
                flex-direction: column;
                height: auto;
            }
            
            .users-sidebar {
                width: 100%;
                height: 250px;
            }
            
            .tasks-grid,
            .events-grid {
                grid-template-columns: 1fr;
            }
        }

        /* –£—Ç–∏–ª–∏—Ç—ã */
        .mb-10 { margin-bottom: 10px; }
        .mb-15 { margin-bottom: 15px; }
        .mb-20 { margin-bottom: 20px; }
        .mt-10 { margin-top: 10px; }
        .mt-15 { margin-top: 15px; }
        .mt-20 { margin-top: 20px; }
        .d-flex { display: flex; }
        .align-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-10 { gap: 10px; }
        .w-100 { width: 100%; }
    </style>
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
    <nav class="navbar">
        <div class="logo">
            <i class="fas fa-fire"></i>
            <span>Advanced Chat</span>
        </div>
        
        <ul class="nav-links">
            <li><a href="#" class="nav-link active" onclick="showTab('chat')">
                <i class="fas fa-comments"></i> –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä
            </a></li>
            <li><a href="#" class="nav-link" onclick="showTab('events')">
                <i class="fas fa-calendar-alt"></i> –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
            </a></li>
            <li><a href="#" class="nav-link" onclick="showTab('tasks')">
                <i class="fas fa-tasks"></i> –ó–∞–¥–∞–Ω–∏—è
            </a></li>
            <li><a href="#" class="nav-link" onclick="showTab('adaptation')">
                <i class="fas fa-graduation-cap"></i> –ê–¥–∞–ø—Ç–∞—Ü–∏—è
            </a></li>
        </ul>
        
        <div class="user-menu">
            <div class="user-info">
                <div class="user-name" id="current-username">–ì–æ—Å—Ç—å</div>
                <div class="user-status">
                    <span class="user-status-dot" id="current-status-indicator"></span>
                    <span id="status-text">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
            </div>
            <img src="https://ui-avatars.com/api/?name=–ì–æ—Å—Ç—å&background=4361ee&color=fff" 
                 alt="–ê–≤–∞—Ç–∞—Ä" 
                 class="user-avatar"
                 id="current-avatar"
                 onclick="openProfileModal()">
        </div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="container">
        <!-- ========== –í–ö–õ–ê–î–ö–ê –ß–ê–¢–ê ========== -->
        <div class="tab-content active" id="chat-tab">
            <div class="chat-container">
                <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ -->
                <div class="users-sidebar">
                    <div class="users-header">
                        <div class="users-title">
                            <i class="fas fa-users"></i>
                            –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                            <span class="users-count" id="online-count">0</span>
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="changeStatus('online')" title="–û–Ω–ª–∞–π–Ω">
                                <i class="fas fa-circle status-online"></i>
                            </button>
                            <button class="btn" onclick="changeStatus('away')" title="–û—Ç–æ—à–µ–ª" style="background: rgba(255, 152, 0, 0.2); color: var(--away);">
                                <i class="fas fa-clock"></i>
                            </button>
                            <button class="btn" onclick="changeStatus('busy')" title="–ó–∞–Ω—è—Ç" style="background: rgba(244, 67, 54, 0.2); color: var(--danger);">
                                <i class="fas fa-minus-circle"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="users-tabs">
                        <button class="tab-btn active" onclick="showUsersTab('online')">
                            <i class="fas fa-circle status-online"></i>
                            –û–Ω–ª–∞–π–Ω (<span id="online-tab-count">0</span>)
                        </button>
                        <button class="tab-btn" onclick="showUsersTab('all')">
                            <i class="fas fa-users"></i>
                            –í—Å–µ (<span id="all-tab-count">0</span>)
                        </button>
                        <button class="tab-btn" onclick="showUsersTab('away')">
                            <i class="fas fa-clock status-away"></i>
                            –û—Ç–æ—à–ª–∏
                        </button>
                        <button class="tab-btn" onclick="showUsersTab('busy')">
                            <i class="fas fa-minus-circle status-busy"></i>
                            –ó–∞–Ω—è—Ç—ã
                        </button>
                    </div>
                    
                    <div class="users-list" id="users-list">
                       <div class="loading-status">
                            <i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...
                        </div>
                    </div>
                </div>
                
                <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ -->
                <div class="chat-main">
                    <div class="chat-header">
                        <div class="chat-title">–û–±—â–∏–π —á–∞—Ç</div>
                        <div class="chat-subtitle" id="chat-subtitle">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                    
                    <div class="chat-messages" id="chat-messages">
                        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
                    </div>
                    <div class="chat-input-wrapper">
                        <div class="attachment-preview" id="attachment-preview">
                            <div class="attachment-info">
                                <div class="attachment-icon" id="attachment-icon">
                                    <i class="fas fa-file"></i>
                                </div>
                                <div class="attachment-details">
                                    <div class="attachment-name" id="attachment-filename">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</div>
                                    <div class="attachment-size" id="attachment-filesize">0 KB</div>
                                </div>
                            </div>
                            <button class="remove-attachment" onclick="removeAttachment()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="chat-input">
                            <textarea class="message-input" 
                                      id="message-input" 
                                      placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." 
                                      rows="1"></textarea>
                            
                            <div class="chat-buttons">
                                <button class="chat-btn" onclick="openAttachmentModal()">
                                    <i class="fas fa-paperclip"></i>
                                </button>
                                <button class="chat-btn" onclick="sendMessage()">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                </div>
            </div>
            
            <!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –≤ —á–∞—Ç–µ -->
            <div class="admin-panel" id="admin-panel" style="display: none;">
                <h3><i class="fas fa-shield-alt"></i> –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å —á–∞—Ç–∞</h3>
                <div class="d-flex gap-10 mt-15">
                    <button class="btn btn-danger" onclick="deleteAllMessages()">
                        <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                    </button>
                    <button class="btn btn-danger" onclick="clearDatabase()">
                        <i class="fas fa-database"></i> –û—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É
                    </button>
                </div>
            </div>
        </div>

        <!-- ========== –í–ö–õ–ê–î–ö–ê –ó–ê–î–ê–ù–ò–ô ========== -->
        <div class="tab-content" id="tasks-tab">
            <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞) -->
            <div class="create-task-form" id="create-task-form" style="display: none;">
                <h2 class="mb-20"><i class="fas fa-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ</h2>
                
                <div class="form-group">
                    <label class="form-label">–¢–µ–º–∞ –∑–∞–¥–∞–Ω–∏—è *</label>
                    <input type="text" class="form-control" id="task-title" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –∑–∞–¥–∞–Ω–∏—è">
                </div>

                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è *</label>
                    <textarea class="form-control" id="task-description" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è..." rows="4"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">–ù–∞–≥—Ä–∞–¥–∞ *</label>
                    <input type="text" class="form-control" id="task-reward" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 100 –æ—á–∫–æ–≤, –ë–æ–Ω—É—Å, –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç">
                </div>

                <div class="form-group">
                    <label class="form-label">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª—ã (–º–∞–∫—Å–∏–º—É–º 3 —Ñ–∞–π–ª–∞, –¥–æ 5MB –∫–∞–∂–¥—ã–π)</label>
                    <input type="file" class="form-control" id="task-files" multiple accept="image/*,video/*,.gif,.pdf,.doc,.docx,.txt">
                </div>

                <div class="form-group">
                    <label class="form-label">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–æ–≤:</label>
                    <div class="file-preview" id="task-file-preview"></div>
                </div>

                <div class="d-flex gap-10">
                    <button class="btn btn-primary" onclick="createTask()">
                        <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
                    </button>
                    <button class="btn" onclick="clearTaskForm()" style="background: rgba(255,255,255,0.1); color: white;">
                        <i class="fas fa-times"></i> –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞) -->
            <div class="d-flex justify-between align-center mb-20">
                <h2><i class="fas fa-tasks"></i> –ó–∞–¥–∞–Ω–∏—è</h2>
                <button class="btn btn-primary" id="show-create-form-btn" onclick="toggleCreateTaskForm()">
                    <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
                </button>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π -->
            <div class="tasks-grid" id="tasks-list">
                <!-- –ó–∞–¥–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>

        <!-- ========== –í–ö–õ–ê–î–ö–ê –ú–ï–†–û–ü–†–ò–Ø–¢–ò–ô ========== -->
        <div class="tab-content" id="events-tab">
        <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞) -->
            <div class="create-task-form" id="create-event-form" style="display: none;">
                <h2 class="mb-20"><i class="fas fa-calendar-plus"></i> –°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</h2>
                
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è *</label>
                    <input type="text" class="form-control" id="event-title" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è">
                </div>
        
                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ *</label>
                    <textarea class="form-control" id="event-description" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è..." rows="4"></textarea>
                </div>
        
                <div class="form-group">
                    <label class="form-label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è *</label>
                    <input type="datetime-local" class="form-control" id="event-datetime">
                </div>
        
                <div class="form-group">
                    <label class="form-label">–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è</label>
                    <input type="text" class="form-control" id="event-location" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û–Ω–ª–∞–π–Ω, –æ—Ñ–∏—Å, –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü-–∑–∞–ª">
                </div>
        
                <div class="form-group">
                    <label class="form-label">–û–±–ª–æ–∂–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</label>
                    <input type="file" class="form-control" id="event-image" accept="image/*">
                    <small style="color: rgba(255,255,255,0.5);">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä: 1200x600px</small>
                </div>
        
                <div class="form-group">
                    <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</label>
                    <div class="participants-select" id="event-participants" style="max-height: 200px; overflow-y: auto; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
        
                <div class="form-group">
                    <label class="form-label">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ–±–ª–æ–∂–∫–∏:</label>
                    <div id="event-image-preview" style="margin-top: 10px;">
                        <img id="event-image-preview-img" style="max-width: 300px; border-radius: 10px; display: none;">
                    </div>
                </div>
        
                <div class="d-flex gap-10">
                    <button class="btn btn-primary" onclick="createEvent()">
                        <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
                    </button>
                    <button class="btn" onclick="clearEventForm()" style="background: rgba(255,255,255,0.1); color: white;">
                        <i class="fas fa-times"></i> –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                </div>
            </div>
    
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è -->
        <div class="d-flex justify-between align-center mb-20">
            <h2><i class="fas fa-calendar-alt"></i> –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h2>
            <button class="btn btn-primary" id="show-create-event-btn" onclick="toggleCreateEventForm()">
                <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
            </button>
        </div>
    
        <!-- –°–ø–∏—Å–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π -->
        <div class="events-grid" id="events-list">
            <!-- –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        </div>

        <!-- ========== –í–ö–õ–ê–î–ö–ê –ê–î–ê–ü–¢–ê–¶–ò–ò ========== -->
        <div class="tab-content" id="adaptation-tab">
            <h2 class="mb-20"><i class="fas fa-graduation-cap"></i> –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏</h2>
            
            <div class="materials-list" id="materials-list">
                <!-- –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                <div class="material-item">
                    <div class="material-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="material-content">
                        <div class="material-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</div>
                        <div class="material-description">–ó–¥–µ—Å—å –±—É–¥—É—Ç —Ä–∞–∑–º–µ—â–µ–Ω—ã –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ========== -->
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div class="modal" id="profile-modal">
        <div class="modal-content">
            <h2 class="mb-20"><i class="fas fa-user-edit"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h2>
            
            <div class="mb-20">
                <div class="d-flex align-center gap-15">
                    <img src="https://ui-avatars.com/api/?name=–ì–æ—Å—Ç—å&background=4361ee&color=fff" 
                         alt="–ê–≤–∞—Ç–∞—Ä" 
                         class="user-avatar"
                         id="avatar-preview">
                    <button class="btn" onclick="document.getElementById('avatar-input').click()" style="background: rgba(255,255,255,0.1); color: white;">
                        <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å
                    </button>
                    <input type="file" 
                           id="avatar-input" 
                           accept="image/*" 
                           style="display: none;"
                           onchange="uploadAvatar(this.files[0])">
                </div>
            </div>
            
            <div class="mb-15">
                <label class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *</label>
                <input type="text" 
                       class="form-control" 
                       id="profile-username" 
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è"
                       required>
            </div>
            
            <div class="mb-15">
                <label class="form-label">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                <input type="text" 
                       class="form-control" 
                       id="profile-position" 
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Frontend Developer">
            </div>
            
            <div class="mb-20">
                <label class="form-label">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è / –ö–æ–º–ø–∞–Ω–∏—è</label>
                <input type="text" 
                       class="form-control" 
                       id="profile-organization" 
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: IT Company Inc.">
            </div>
            
            <div class="mb-20">
                <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                <select class="form-control" id="profile-status" onchange="changeStatus(this.value)">
                    <option value="online">üü¢ –û–Ω–ª–∞–π–Ω</option>
                    <option value="away">üü† –û—Ç–æ—à–µ–ª</option>
                    <option value="busy">üî¥ –ó–∞–Ω—è—Ç</option>
                    <option value="offline">‚ö´ –ù–µ –≤ —Å–µ—Ç–∏</option>
                </select>
            </div>
            
            <div class="d-flex justify-between">
                <button class="btn" onclick="closeProfileModal()" style="background: rgba(255,255,255,0.1); color: white;">
                    <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
                </button>
                <button class="btn btn-primary" onclick="saveProfile()">
                    <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–ª–æ–∂–µ–Ω–∏–π -->
    <div class="modal" id="attachment-modal">
        <div class="modal-content">
            <h2 class="mb-20"><i class="fas fa-paperclip"></i> –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª</h2>
            
            <div class="mb-15">
                <div class="d-flex gap-10 mb-15">
                    <button class="btn" onclick="selectAttachmentType('image')" style="background: rgba(255,255,255,0.1); color: white;">
                        <i class="fas fa-image"></i> –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    </button>
                    <button class="btn" onclick="selectAttachmentType('gif')" style="background: rgba(255,255,255,0.1); color: white;">
                        <i class="fas fa-photo-video"></i> GIF
                    </button>
                    <button class="btn" onclick="selectAttachmentType('video')" style="background: rgba(255,255,255,0.1); color: white;">
                        <i class="fas fa-video"></i> –í–∏–¥–µ–æ
                    </button>
                    <button class="btn" onclick="selectAttachmentType('file')" style="background: rgba(255,255,255,0.1); color: white;">
                        <i class="fas fa-file"></i> –§–∞–π–ª
                    </button>
                </div>
            </div>
            
            <div class="mb-15" id="attachment-preview" style="display: none;">
                <label class="form-label">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</label>
                <div id="preview-container" class="mb-10"></div>
            </div>
            
            <div class="mb-20">
                <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</label>
                <input type="file" 
                       class="form-control" 
                       id="file-input"
                       onchange="previewAttachment(this.files[0])">
            </div>
            
            <div class="d-flex justify-between">
                <button class="btn" onclick="closeAttachmentModal()" style="background: rgba(255,255,255,0.1); color: white;">
                    <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
                </button>
                <button class="btn btn-primary" onclick="attachFile()">
                    <i class="fas fa-check"></i> –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–¥–∞–Ω–∏—è -->
    <div class="modal" id="task-modal">
        <div class="modal-content">
            <h2 id="task-modal-title" class="mb-10"></h2>
            <div class="mb-15">
                <span id="task-modal-reward" style="background: var(--warning); color: white; padding: 5px 10px; border-radius: 5px;"></span>
            </div>
            <p id="task-modal-description" style="line-height: 1.6; margin-bottom: 20px;"></p>
            
            <div id="task-modal-attachments" style="margin: 20px 0;"></div>
            
            <div id="task-modal-actions" class="d-flex gap-10"></div>
            
            <button class="btn w-100 mt-20" onclick="closeTaskModal()" style="background: rgba(255,255,255,0.1); color: white;">
                <i class="fas fa-times"></i> –ó–∞–∫—Ä—ã—Ç—å
            </button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
    <div class="modal" id="event-modal">
        <div class="modal-content" style="max-width: 600px;">
            <div style="position: relative;">
                <img id="event-modal-image" src="" alt="–û–±–ª–æ–∂–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è" 
                     style="width: 100%; height: 200px; object-fit: cover; border-radius: 10px; margin-bottom: 15px;">
                <div style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 5px 10px; border-radius: 5px;"
                     id="event-modal-status"></div>
            </div>
            
            <h2 id="event-modal-title" class="mb-10"></h2>
            
            <div class="mb-15" style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                <div style="display: flex; align-items: center; gap: 5px;">
                    <i class="fas fa-calendar" style="color: var(--primary);"></i>
                    <span id="event-modal-date"></span>
                </div>
                <div style="display: flex; align-items: center; gap: 5px;">
                    <i class="fas fa-map-marker-alt" style="color: var(--warning);"></i>
                    <span id="event-modal-location"></span>
                </div>
                <div style="display: flex; align-items: center; gap: 5px;">
                    <i class="fas fa-users" style="color: var(--success);"></i>
                    <span id="event-modal-participants-count"></span>
                </div>
            </div>
            
            <div class="mb-20">
                <h4><i class="fas fa-align-left"></i> –û–ø–∏—Å–∞–Ω–∏–µ</h4>
                <p id="event-modal-description" style="line-height: 1.6; margin-top: 10px;"></p>
            </div>
            
            <div class="mb-20">
                <h4><i class="fas fa-user-friends"></i> –£—á–∞—Å—Ç–Ω–∏–∫–∏</h4>
                <div id="event-modal-participants" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;"></div>
            </div>
            
            <div id="event-modal-actions" class="d-flex gap-10"></div>
            
            <button class="btn w-100 mt-20" onclick="closeEventModal()" style="background: rgba(255,255,255,0.1); color: white;">
                <i class="fas fa-times"></i> –ó–∞–∫—Ä—ã—Ç—å
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE ==========
        const firebaseConfig = {
            apiKey: "AIzaSyB5eIngl-CnWkSuKcNtywID7kdOKKCatXY",
            authDomain: "ms-adaptive-chat.firebaseapp.com",
            databaseURL: "https://ms-adaptive-chat-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "ms-adaptive-chat",
            storageBucket: "ms-adaptive-chat.firebasestorage.app",
            messagingSenderId: "571640671300",
            appId: "1:571640671300:web:e1e0f4369b93a3ef8f2011"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        let currentUser = null;
        let users = {};
        let tasks = {};
        let isAdmin = false;
        let currentAttachment = null;
        let attachmentType = 'image';
        let taskFiles = [];
        let currentUsersTab = 'online';
        let statusUpdateInterval = null;
        let userStatusListeners = [];
        let events = {};
        let eventImage = null;

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Firebase
            if (firebaseConfig.apiKey.includes("–í–ê–®")) {
                showAlert('–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Firebase!', 'warning', '–ó–∞–º–µ–Ω–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Firebase –≤ –∫–æ–¥–µ.');
                return;
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
            loadUserProfile();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            setupNavigation();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞
            initChat();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏–π
            initTasks();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π (–î–û–ë–ê–í–¨–¢–ï –≠–¢–£ –°–¢–†–û–ö–£)
            initEventsSystem();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
            setupEventListeners();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            checkAdminStatus();
        });

        

         // ========== –°–ò–°–¢–ï–ú–ê –°–¢–ê–¢–£–°–û–í (WebSocket-–ø–æ–¥–æ–±–Ω–∞—è) ==========
        function initLightweightStatusSystem() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            updateUserStatusInFirebase();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥ (–≤–º–µ—Å—Ç–æ 15)
            statusUpdateInterval = setInterval(() => {
                updateUserStatusInFirebase();
            }, 60000);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'hidden') {
                    setUserStatus('away');
                } else {
                    setUserStatus('online');
                }
            });
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å offline –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            window.addEventListener('beforeunload', () => {
                setUserStatus('offline');
            });
        }

        function setUserStatus(status) {
            if (!currentUser) return;
            
            currentUser.status = status;
            currentUser.lastSeen = Date.now();
            
            updateCurrentUserStatus();
            
            // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –≤ Firebase —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
            if (currentUser.id) {
                database.ref('users/' + currentUser.id).update({
                    status: status,
                    lastSeen: Date.now()
                }).catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', error);
                });
            }
            
            if (status !== 'offline') {
                saveUserProfile();
            }
        }

        function updateUserStatusInFirebase() {
            if (!currentUser || !currentUser.id) return;
            
            const userData = {
                username: currentUser.username,
                position: currentUser.position || '',
                organization: currentUser.organization || '',
                role: currentUser.role || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                avatar: currentUser.avatar || getDefaultAvatar(currentUser.username),
                status: currentUser.status || 'online',
                lastSeen: Date.now()
            };
            
            database.ref('users/' + currentUser.id).update(userData)
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', error);
                });
        }

        function trackUserStatus() {
            if (!currentUser || !currentUser.id) return;

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
            const statusInterval = setInterval(() => {
                if (currentUser && currentUser.id) {
                    const userRef = database.ref('users/' + currentUser.id);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                    const isActive = document.visibilityState === 'visible';
                    const status = isActive ? (currentUser.status || 'online') : 'away';
                    
                    userRef.update({
                        status: status,
                        lastSeen: Date.now()
                    }).catch(error => {
                        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', error);
                    });
                }
            }, 15000);

            // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.addEventListener('visibilitychange', () => {
                if (currentUser && currentUser.id) {
                    const userRef = database.ref('users/' + currentUser.id);
                    const status = document.visibilityState === 'visible' ? currentUser.status : 'away';
                    
                    userRef.update({
                        status: status,
                        lastSeen: Date.now()
                    }).catch(error => {
                        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', error);
                    });
                }
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            window.addEventListener('beforeunload', () => {
                if (currentUser && currentUser.id) {
                    database.ref('users/' + currentUser.id).update({
                        status: 'offline',
                        lastSeen: Date.now()
                    }).catch(error => {
                        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏:', error);
                    });
                }
            });

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
            userStatusListeners.push(statusInterval);
        }

        function cleanupStatusListeners() {
            if (statusUpdateInterval) {
                clearInterval(statusUpdateInterval);
                statusUpdateInterval = null;
            }
            
            // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç —Å–ª—É—à–∞—Ç–µ–ª–µ–π Firebase
            if (database.ref('users').off) {
                database.ref('users').off();
            }
        }

        function changeStatus(newStatus) {
            setUserStatus(newStatus);
            showAlert(`–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: ${getStatusText(newStatus)}`, 'success');
        }

        function updateCurrentUserStatus() {
            const statusIndicator = document.getElementById('current-status-indicator');
            const statusText = document.getElementById('status-text');
            const profileStatus = document.getElementById('profile-status');
            
            if (statusIndicator) {
                statusIndicator.className = `user-status-dot status-${currentUser.status}`;
                if (currentUser.status === 'online') {
                    statusIndicator.classList.add('status-pulse');
                } else {
                    statusIndicator.classList.remove('status-pulse');
                }
            }
            
            if (statusText) {
                statusText.textContent = getStatusText(currentUser.status);
            }
            
            if (profileStatus) {
                profileStatus.value = currentUser.status;
            }
        }

        function getStatusText(status) {
            const statusMap = {
                'online': '–û–Ω–ª–∞–π–Ω',
                'offline': '–ù–µ –≤ —Å–µ—Ç–∏',
                'away': '–û—Ç–æ—à–µ–ª',
                'busy': '–ó–∞–Ω—è—Ç'
            };
            return statusMap[status] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        }

        function getStatusClass(status) {
            return `status-${status}`;
        }

        function formatLastSeen(timestamp) {
            if (!timestamp) return '';
            
            const now = Date.now();
            const diff = now - timestamp;
            
            if (diff < 60000) { // –ú–µ–Ω–µ–µ –º–∏–Ω—É—Ç—ã
                return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
            } else if (diff < 3600000) { // –ú–µ–Ω–µ–µ —á–∞—Å–∞
                const minutes = Math.floor(diff / 60000);
                return `${minutes} ${pluralize(minutes, ['–º–∏–Ω—É—Ç—É', '–º–∏–Ω—É—Ç—ã', '–º–∏–Ω—É—Ç'])} –Ω–∞–∑–∞–¥`;
            } else if (diff < 86400000) { // –ú–µ–Ω–µ–µ —Å—É—Ç–æ–∫
                const hours = Math.floor(diff / 3600000);
                return `${hours} ${pluralize(hours, ['—á–∞—Å', '—á–∞—Å–∞', '—á–∞—Å–æ–≤'])} –Ω–∞–∑–∞–¥`;
            } else {
                const date = new Date(timestamp);
                return date.toLocaleDateString('ru-RU');
            }
        }

        function pluralize(number, words) {
            const cases = [2, 0, 1, 1, 1, 2];
            return words[(number % 100 > 4 && number % 100 < 20) ? 2 : cases[Math.min(number % 10, 5)]];
        }

        // ========== –ü–†–û–§–ò–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ==========
        function loadUserProfile() {
            const savedProfile = localStorage.getItem('user_profile');
            if (savedProfile) {
                currentUser = JSON.parse(savedProfile);
                updateProfileUI();
            } else {
                currentUser = {
                    id: generateId(),
                    username: '–ì–æ—Å—Ç—å_' + Math.floor(Math.random() * 1000),
                    position: '',
                    organization: '',
                    role: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    avatar: null,
                    points: 0,
                    completedTasks: [],
                    status: 'online',
                    lastSeen: Date.now(),
                    createdAt: Date.now()
                };
                saveUserProfile();
            }
            initLightweightStatusSystem();
        }

        function saveUserProfile() {
            localStorage.setItem('user_profile', JSON.stringify(currentUser));
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase
            saveUserToFirebase();
        }

        function saveUserToFirebase() {
            if (!currentUser || !currentUser.id) return;
            
            const userData = {
                ...currentUser,
                lastSeen: Date.now(),
                status: currentUser.status || 'online'
            };
            
            database.ref('users/' + currentUser.id).set(userData)
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
            });
        }

        function updateProfileUI() {
            document.getElementById('current-username').textContent = currentUser.username;
            const avatar = document.getElementById('current-avatar');
            const preview = document.getElementById('avatar-preview');
            
            const avatarUrl = currentUser.avatar || getDefaultAvatar(currentUser.username);
            avatar.src = avatarUrl;
            preview.src = avatarUrl;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
            document.getElementById('profile-username').value = currentUser.username;
            document.getElementById('profile-position').value = currentUser.position || '';
            document.getElementById('profile-organization').value = currentUser.organization || '';
            document.getElementById('profile-status').value = currentUser.status || 'online';
            
            updateCurrentUserStatus();
            checkAdminStatus();
        }

        function getDefaultAvatar(username) {
            const colors = ['4361ee', '3a0ca3', 'f72585', '4cc9f0', 'f8961e'];
            const color = colors[username.length % colors.length];
            return `https://ui-avatars.com/api/?name=${encodeURIComponent(username)}&background=${color}&color=fff`;
        }

        // ========== –ù–ê–í–ò–ì–ê–¶–ò–Ø ==========
        function setupNavigation() {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tab = this.getAttribute('onclick').match(/'([^']+)'/)[1];
                    showTab(tab);
                });
            });
        }

        function showTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            event.target.classList.add('active');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏
            switch(tabName) {
                case 'chat':
                    loadUsers();
                    loadMessages();
                    break;
                case 'tasks':
                    loadTasksData();
                    break;
                case 'events':
                    loadEvents();
                    break;
                case 'adaptation':
                    loadMaterials();
                    break;
            }
        }

        // ========== –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ ==========
        function checkAdminStatus() {
            isAdmin = currentUser.username === 'admin' || currentUser.role === '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
            
            const adminPanel = document.getElementById('admin-panel');
            const createFormBtn = document.getElementById('show-create-form-btn');
            
            if (isAdmin) {
                adminPanel.style.display = 'block';
                createFormBtn.style.display = 'block';
            } else {
                adminPanel.style.display = 'none';
                createFormBtn.style.display = 'none';
            }
        }

        // ========== –ß–ê–¢ ==========
        function initChat() {
            loadUsers();
            loadMessages();
        }

        function loadUsers() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            database.ref('users').once('value').then(snapshot => {
                users = snapshot.val() || {};
                updateUsersList();
                updateOnlineCount();
                
                // –ó–∞—Ç–µ–º –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —á–∞—Å—Ç–æ—Ç—ã
                setupUsersListener();
            }).catch(error => {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
            });
        }

        function setupUsersListener() {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º throttle –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
            let lastUpdate = 0;
            const UPDATE_DELAY = 2000; // 2 —Å–µ–∫—É–Ω–¥—ã
            
            database.ref('users').on('value', (snapshot) => {
                const now = Date.now();
                if (now - lastUpdate > UPDATE_DELAY) {
                    users = snapshot.val() || {};
                    updateUsersList();
                    updateOnlineCount();
                    lastUpdate = now;
                }
            });
        }

        function updateUsersList() {
            const usersList = document.getElementById('users-list');
                if (!usersList) return;
                
                usersList.innerHTML = '';
                
                let filteredUsers = Object.values(users);
                
                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
                if (currentUsersTab === 'online') {
                    filteredUsers = filteredUsers.filter(user => user.status === 'online');
                } else if (currentUsersTab === 'away') {
                    filteredUsers = filteredUsers.filter(user => user.status === 'away');
                } else if (currentUsersTab === 'busy') {
                    filteredUsers = filteredUsers.filter(user => user.status === 'busy');
                }
                
                if (filteredUsers.length === 0) {
                    usersList.innerHTML = `
                        <div class="loading-status">
                            <i class="fas fa-user-slash"></i> –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                        </div>
                    `;
                    return;
                }
                
                // –°–æ–∑–¥–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (virtual DOM —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)
                const fragment = document.createDocumentFragment();
                const maxUsers = 50; // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                
                filteredUsers.slice(0, maxUsers).forEach(user => {
                    const userCard = createUserCardElement(user);
                    fragment.appendChild(userCard);
                });
                
                usersList.appendChild(fragment);
                
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–æ–ª—å—à–µ –º–∞–∫—Å–∏–º—É–º–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                if (filteredUsers.length > maxUsers) {
                    const moreCard = document.createElement('div');
                    moreCard.className = 'user-card';
                    moreCard.style.textAlign = 'center';
                    moreCard.style.color = 'rgba(255,255,255,0.5)';
                    moreCard.innerHTML = `<i class="fas fa-ellipsis-h"></i> –ï—â–µ ${filteredUsers.length - maxUsers} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`;
                    usersList.appendChild(moreCard);
                }
        }

        function createUserCardElement(user) {
            const userCard = document.createElement('div');
            userCard.className = 'user-card';
            
            const position = user.position || user.role || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            const organization = user.organization ? ` ‚Ä¢ ${user.organization}` : '';
            const lastSeen = user.status !== 'online' ? formatLastSeen(user.lastSeen) : '';
            
            userCard.innerHTML = `
                <div style="position: relative;">
                    <img src="${user.avatar || getDefaultAvatar(user.username)}" 
                         alt="${user.username}" 
                         class="user-avatar-sm">
                    <span class="status-badge ${user.status || 'offline'}"></span>
                </div>
                <div class="user-details">
                    <div class="user-details-name">
                        ${user.username}
                        ${user.id === currentUser?.id ? ' (–í—ã)' : ''}
                    </div>
                    <div class="user-details-role">${position}${organization}</div>
                    ${lastSeen ? `<div class="last-seen">–ë—ã–ª(–∞) ${lastSeen}</div>` : ''}
                </div>
            `;
            
            return userCard;
        }

        function updateOnlineCount() {
            if (!users || Object.keys(users).length === 0) return;
            
            const onlineUsers = Object.values(users).filter(user => user.status === 'online');
            const allUsers = Object.keys(users).length;
            
            const onlineCountElement = document.getElementById('online-count');
            const onlineTabCountElement = document.getElementById('online-tab-count');
            const allTabCountElement = document.getElementById('all-tab-count');
            const chatSubtitleElement = document.getElementById('chat-subtitle');
            
            if (onlineCountElement) onlineCountElement.textContent = onlineUsers.length;
            if (onlineTabCountElement) onlineTabCountElement.textContent = onlineUsers.length;
            if (allTabCountElement) allTabCountElement.textContent = allUsers;
            if (chatSubtitleElement) {
                chatSubtitleElement.textContent = `${onlineUsers.length} –∏–∑ ${allUsers} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –æ–Ω–ª–∞–π–Ω`;
            }
        }

        function showUsersTab(tab) {
            currentUsersTab = tab;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.users-tabs .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            updateUsersList();
        }

        function startPrivateChat(userId) {
            const user = users[userId];
            if (!user) return;
            
            showAlert(`–ù–∞—á–∞–ª–æ —á–∞—Ç–∞ —Å ${user.username}`, 'info', '–§—É–Ω–∫—Ü–∏—è –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }

        // ========== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –ü–†–ò–ö–†–ï–ü–õ–ï–ù–ù–û–ì–û –§–ê–ô–õ–ê ==========
        function updateAttachmentPreview() {
            const preview = document.getElementById('attachment-preview');
            const icon = document.getElementById('attachment-icon');
            const filename = document.getElementById('attachment-filename');
            const filesize = document.getElementById('attachment-filesize');
            
            if (currentAttachment) {
                preview.classList.add('visible');
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
                let iconClass = 'fas fa-file';
                if (currentAttachment.type === 'image') {
                    iconClass = 'fas fa-image';
                } else if (currentAttachment.type === 'gif') {
                    iconClass = 'fas fa-photo-video';
                } else if (currentAttachment.type === 'video') {
                    iconClass = 'fas fa-video';
                } else if (currentAttachment.name && currentAttachment.name.toLowerCase().includes('.pdf')) {
                    iconClass = 'fas fa-file-pdf';
                } else if (currentAttachment.name && (
                    currentAttachment.name.toLowerCase().includes('.doc') || 
                    currentAttachment.name.toLowerCase().includes('.docx')
                )) {
                    iconClass = 'fas fa-file-word';
                }
                
                icon.innerHTML = `<i class="${iconClass}"></i>`;
                filename.textContent = currentAttachment.name;
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
                const size = currentAttachment.size;
                if (size < 1024) {
                    filesize.textContent = size + ' B';
                } else if (size < 1024 * 1024) {
                    filesize.textContent = (size / 1024).toFixed(1) + ' KB';
                } else {
                    filesize.textContent = (size / (1024 * 1024)).toFixed(1) + ' MB';
                }
            } else {
                preview.classList.remove('visible');
            }
        }

        function removeAttachment() {
            currentAttachment = null;
            updateAttachmentPreview();
            showAlert('–í–ª–æ–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'info');
        }

        function loadMessages() {
            database.ref('messages').limitToLast(50).on('value', snapshot => {
                const messages = snapshot.val() || {};
                displayMessages(messages);
            });
        }

        function displayMessages(messages) {
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.innerHTML = '';
            
            const messagesArray = Object.values(messages).sort((a, b) => a.timestamp - b.timestamp);
            
            messagesArray.forEach(message => {
                const isCurrentUser = message.userId === currentUser.id;
                const messageElement = createMessageElement(message, isCurrentUser);
                messagesContainer.appendChild(messageElement);
            });
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function createMessageElement(message, isCurrentUser) {
            const div = document.createElement('div');
            div.className = `message ${isCurrentUser ? 'sent' : ''}`;
            
            let attachmentHtml = '';
            if (message.attachment) {
                if (message.attachment.type === 'image' || message.attachment.type === 'gif') {
                    attachmentHtml = `
                        <div class="message-attachment">
                            <img src="${message.attachment.data}" 
                                 alt="${message.attachment.name}" 
                                 class="attachment-image"
                                 onclick="viewImage('${message.attachment.data}')">
                        </div>
                    `;
                }
            }
            
            div.innerHTML = `
                <img src="${message.userAvatar || getDefaultAvatar(message.username)}" 
                     alt="${message.username}" 
                     class="message-avatar">
                <div class="message-content">
                    <div class="message-header">
                        <div class="message-sender">
                            ${message.username}
                            <span class="message-role">${message.userRole}</span>
                        </div>
                        <div class="message-time">${new Date(message.timestamp).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})}</div>
                    </div>
                    <div class="message-text">${message.text}</div>
                    ${attachmentHtml}
                    ${isAdmin ? `
                        <button class="btn btn-danger btn-sm mt-10" onclick="deleteMessage('${message.id}')">
                            <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                        </button>
                    ` : ''}
                </div>
            `;

            return div;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        function sendMessage() {
            const input = document.getElementById('message-input');
            const text = input.value.trim();
            
            if (!text && !currentAttachment) {
                showAlert('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–∞–π–ª!', 'warning');
                return;
            }
            
            const message = {
                id: generateId(),
                text: text,
                userId: currentUser.id,
                username: currentUser.username,
                userRole: currentUser.position || currentUser.role || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                userOrganization: currentUser.organization || '',
                userAvatar: currentUser.avatar || getDefaultAvatar(currentUser.username),
                timestamp: Date.now(),
                attachment: currentAttachment
            };
            
            database.ref('messages/' + message.id).set(message)
                .then(() => {
                    input.value = '';
                    currentAttachment = null;
                    updateAttachmentPreview();
                    input.focus();
                    showAlert('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!', 'success');
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
                    showAlert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏', 'error');
                });
        }

        function deleteMessage(messageId) {
            if (!isAdmin) return;
            
            Swal.fire({
                title: '–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '–£–¥–∞–ª–∏—Ç—å',
                cancelButtonText: '–û—Ç–º–µ–Ω–∞'
            }).then((result) => {
                if (result.isConfirmed) {
                    database.ref('messages/' + messageId).remove();
                    showAlert('–°–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ!', 'success');
                }
            });
        }

        function deleteAllMessages() {
            if (!isAdmin) return;
            
            Swal.fire({
                title: '–£–¥–∞–ª–∏—Ç—å –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è?',
                text: '–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!',
                icon: 'error',
                showCancelButton: true,
                confirmButtonText: '–£–¥–∞–ª–∏—Ç—å –≤—Å—ë',
                cancelButtonText: '–û—Ç–º–µ–Ω–∞'
            }).then((result) => {
                if (result.isConfirmed) {
                    database.ref('messages').remove();
                    showAlert('–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã!', 'success');
                }
            });
        }

        function clearDatabase() {
            if (!isAdmin) return;
            
            Swal.fire({
                title: '–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö?',
                text: '–£–¥–∞–ª—è—Ç—Å—è –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏!',
                icon: 'error',
                showCancelButton: true,
                confirmButtonText: '–û—á–∏—Å—Ç–∏—Ç—å',
                cancelButtonText: '–û—Ç–º–µ–Ω–∞'
            }).then((result) => {
                if (result.isConfirmed) {
                    database.ref().remove();
                    showAlert('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—á–∏—â–µ–Ω–∞!', 'success');
                }
            });
        }

        // ========== –ó–ê–î–ê–ù–ò–Ø ==========
        function initTasks() {
            loadTasksData();
            setupTaskFileUpload();
        }

        function loadTasksData() {
            database.ref('tasks').on('value', snapshot => {
                tasks = snapshot.val() || {};
                displayTasks();
            });
        }

        function initEvents() {
            loadEvents();
        }

        function displayTasks() {
            const tasksList = document.getElementById('tasks-list');
            if (!tasksList) return;
            
            tasksList.innerHTML = '';
            
            const tasksArray = Object.entries(tasks).map(([id, task]) => ({ id, ...task }));
            tasksArray.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
            
            tasksArray.forEach(task => {
                const taskCard = createTaskCard(task);
                tasksList.appendChild(taskCard);
            });
        }

        function createTaskCard(task) {
            const isCompleted = currentUser.completedTasks?.includes(task.id);
            const card = document.createElement('div');
            card.className = `task-card ${isCompleted ? 'completed' : 'active'}`;
            
            let attachmentsHtml = '';
            if (task.attachments && task.attachments.length > 0) {
                attachmentsHtml = `
                    <div class="mb-10">
                        <small style="color: rgba(255,255,255,0.5);">
                            <i class="fas fa-paperclip"></i> ${task.attachments.length} —Ñ–∞–π–ª–æ–≤
                        </small>
                    </div>
                `;
            }
            
            card.innerHTML = `
                <div class="task-header">
                    <h3 class="task-title">${task.title}</h3>
                    <span class="task-reward">${task.reward}</span>
                </div>
                
                <div class="task-description">
                    ${task.description.substring(0, 150)}${task.description.length > 150 ? '...' : ''}
                </div>
                
                ${attachmentsHtml}
                
                <div class="task-actions">
                    <button class="btn btn-primary" onclick="viewTask('${task.id}')">
                        <i class="fas fa-eye"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                    </button>
                    
                    ${!isCompleted ? `
                        <button class="btn btn-success" onclick="completeTask('${task.id}')">
                            <i class="fas fa-check"></i> –í—ã–ø–æ–ª–Ω–∏—Ç—å
                        </button>
                    ` : ''}
                    
                    ${isAdmin ? `
                        <button class="btn btn-danger" onclick="deleteTask('${task.id}')">
                            <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                        </button>
                    ` : ''}
                </div>
            `;
            
            return card;
        }

        function toggleCreateTaskForm() {
            const form = document.getElementById('create-task-form');
            if (form.style.display === 'none') {
                form.style.display = 'block';
                document.getElementById('show-create-form-btn').innerHTML = '<i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞';
                document.getElementById('show-create-form-btn').onclick = toggleCreateTaskForm;
            } else {
                form.style.display = 'none';
                document.getElementById('show-create-form-btn').innerHTML = '<i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ';
                document.getElementById('show-create-form-btn').onclick = toggleCreateTaskForm;
                clearTaskForm();
            }
        }

        function setupTaskFileUpload() {
            document.getElementById('task-files').addEventListener('change', function(e) {
                const files = Array.from(e.target.files);
                taskFiles = [];
                const preview = document.getElementById('task-file-preview');
                preview.innerHTML = '';
                
                files.slice(0, 3).forEach((file, index) => {
                    if (file.size > 5 * 1024 * 1024) {
                        showAlert('–û—à–∏–±–∫–∞', 'error', `–§–∞–π–ª "${file.name}" —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π!`);
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        taskFiles.push({
                            name: file.name,
                            type: getFileType(file),
                            data: e.target.result,
                            size: file.size
                        });
                        
                        const previewItem = document.createElement('div');
                        previewItem.className = 'preview-item';
                        
                        if (file.type.startsWith('image/')) {
                            previewItem.innerHTML = `
                                <img src="${e.target.result}" alt="${file.name}">
                                <button class="remove-preview" onclick="removeTaskFile(${index})">√ó</button>
                            `;
                        } else {
                            previewItem.innerHTML = `
                                <div style="width: 100%; height: 100%; background: rgba(67, 97, 238, 0.3); display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-file fa-2x"></i>
                                </div>
                                <button class="remove-preview" onclick="removeTaskFile(${index})">√ó</button>
                            `;
                        }
                        
                        preview.appendChild(previewItem);
                    };
                    reader.readAsDataURL(file);
                });
            });
        }

        function getFileType(file) {
            if (file.type.startsWith('image/')) {
                return file.type === 'image/gif' ? 'gif' : 'image';
            } else if (file.type.startsWith('video/')) {
                return 'video';
            } else {
                return 'file';
            }
        }

        function removeTaskFile(index) {
            taskFiles.splice(index, 1);
            updateTaskFilePreview();
        }

        function updateTaskFilePreview() {
            const preview = document.getElementById('task-file-preview');
            preview.innerHTML = '';
            
            taskFiles.forEach((file, index) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                
                if (file.type === 'image' || file.type === 'gif') {
                    previewItem.innerHTML = `
                        <img src="${file.data}" alt="${file.name}">
                        <button class="remove-preview" onclick="removeTaskFile(${index})">√ó</button>
                    `;
                } else {
                    previewItem.innerHTML = `
                        <div style="width: 100%; height: 100%; background: rgba(67, 97, 238, 0.3); display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-file fa-2x"></i>
                        </div>
                        <button class="remove-preview" onclick="removeTaskFile(${index})">√ó</button>
                    `;
                }
                
                preview.appendChild(previewItem);
            });
        }

        function createTask() {
            if (!isAdmin) {
                showAlert('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞', 'error', '–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è!');
                return;
            }
            
            const title = document.getElementById('task-title').value.trim();
            const description = document.getElementById('task-description').value.trim();
            const reward = document.getElementById('task-reward').value.trim();
            
            if (!title || !description || !reward) {
                showAlert('–û—à–∏–±–∫–∞', 'warning', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }
            
            const taskId = generateId();
            const taskData = {
                id: taskId,
                title: title,
                description: description,
                reward: reward,
                attachments: taskFiles,
                createdBy: currentUser.username,
                createdAt: Date.now(),
                participants: []
            };
            
            database.ref('tasks/' + taskId).set(taskData)
                .then(() => {
                    showAlert('–£—Å–ø–µ—Ö!', 'success', '–ó–∞–¥–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ!');
                    clearTaskForm();
                    toggleCreateTaskForm();
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞:', error);
                    showAlert('–û—à–∏–±–∫–∞', 'error', '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ');
                });
        }

        function clearTaskForm() {
            document.getElementById('task-title').value = '';
            document.getElementById('task-description').value = '';
            document.getElementById('task-reward').value = '';
            document.getElementById('task-files').value = '';
            document.getElementById('task-file-preview').innerHTML = '';
            taskFiles = [];
        }

        function viewTask(taskId) {
            const task = tasks[taskId];
            if (!task) return;
            
            const modal = document.getElementById('task-modal');
            const isCompleted = currentUser.completedTasks?.includes(taskId);
            
            document.getElementById('task-modal-title').textContent = task.title;
            document.getElementById('task-modal-reward').textContent = task.reward;
            document.getElementById('task-modal-description').textContent = task.description;
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤–ª–æ–∂–µ–Ω–∏—è
            const attachmentsDiv = document.getElementById('task-modal-attachments');
            attachmentsDiv.innerHTML = '';
            
            if (task.attachments && task.attachments.length > 0) {
                attachmentsDiv.innerHTML = `
                    <h4><i class="fas fa-paperclip"></i> –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
                        ${task.attachments.map(att => `
                            <div style="text-align: center;">
                                <a href="#" onclick="downloadAttachment('${att.data}', '${att.name}')" style="text-decoration: none; color: white;">
                                    ${att.type === 'image' || att.type === 'gif' ? 
                                        `<img src="${att.data}" alt="${att.name}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 5px;">` : 
                                        `<div style="width: 100px; height: 100px; background: rgba(67, 97, 238, 0.3); border-radius: 5px; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-file fa-2x"></i>
                                        </div>`
                                    }
                                    <div style="margin-top: 5px; font-size: 12px;">${att.name}</div>
                                </a>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            const actionsDiv = document.getElementById('task-modal-actions');
            actionsDiv.innerHTML = '';
            
            if (!isCompleted) {
                actionsDiv.innerHTML += `
                    <button class="btn btn-success" onclick="completeTask('${taskId}'); closeTaskModal();">
                        <i class="fas fa-check"></i> –û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º
                    </button>
                `;
            }
            
            if (isAdmin) {
                actionsDiv.innerHTML += `
                    <button class="btn btn-danger" onclick="deleteTask('${taskId}'); closeTaskModal();">
                        <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                    </button>
                `;
            }
            
            modal.classList.add('active');
        }

        function completeTask(taskId) {
            if (!currentUser.completedTasks) currentUser.completedTasks = [];
            
            if (currentUser.completedTasks.includes(taskId)) {
                showAlert('–í—ã —É–∂–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ!', 'info');
                return;
            }
            
            Swal.fire({
                title: '–í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ?',
                text: '–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: '–î–∞, –≤—ã–ø–æ–ª–Ω–∏–ª',
                cancelButtonText: '–û—Ç–º–µ–Ω–∞'
            }).then((result) => {
                if (result.isConfirmed) {
                    currentUser.completedTasks.push(taskId);
                    
                    // –ù–∞—á–∏—Å–ª—è–µ–º –æ—á–∫–∏
                    const task = tasks[taskId];
                    const pointsMatch = task.reward.match(/\d+/);
                    if (pointsMatch) {
                        currentUser.points += parseInt(pointsMatch[0]);
                    }
                    
                    saveUserProfile();
                    showAlert('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!', 'success', '–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!');
                }
            });
        }

        function deleteTask(taskId) {
            if (!isAdmin) return;
            
            Swal.fire({
                title: '–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '–£–¥–∞–ª–∏—Ç—å',
                cancelButtonText: '–û—Ç–º–µ–Ω–∞'
            }).then((result) => {
                if (result.isConfirmed) {
                    database.ref('tasks/' + taskId).remove();
                    showAlert('–ó–∞–¥–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ!', 'success');
                }
            });
        }

        // ========== –ú–ï–†–û–ü–†–ò–Ø–¢–ò–Ø ==========
        function loadEvents() {
            database.ref('events').on('value', snapshot => {
                events = snapshot.val() || {};
                displayEvents();
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–ª—è —Ñ–æ—Ä–º—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ñ–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –≤–∏–¥–∏–º–∞
                if (document.getElementById('create-event-form').style.display !== 'none') {
                    loadEventParticipants();
                }
            });
        }

        function initEventsSystem() {
            loadEvents();
        }

        function displayEvents() {
            const eventsList = document.getElementById('events-list');
            if (!eventsList) return;
            
            eventsList.innerHTML = '';
            
            const eventsArray = Object.entries(events).map(([id, event]) => ({ id, ...event }));
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–±–ª–∏–∂–∞–π—à–∏–µ —Å–≤–µ—Ä—Ö—É)
            eventsArray.sort((a, b) => (a.datetime || 0) - (b.datetime || 0));
            
            if (eventsArray.length === 0) {
                eventsList.innerHTML = `
                    <div class="event-card" style="text-align: center; padding: 40px;">
                        <div class="event-icon">
                            <i class="fas fa-calendar-plus"></i>
                        </div>
                        <div class="event-title">–ù–µ—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</div>
                        <div class="event-description">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –∏–ª–∏ –ø–æ–¥–æ–∂–¥–∏—Ç–µ, –ø–æ–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–∏—Ç –Ω–æ–≤—ã–µ</div>
                    </div>
                `;
                return;
            }
            
            eventsArray.forEach(event => {
                const eventCard = createEventCard(event);
                eventsList.appendChild(eventCard);
            });
        }

        function createEventCard(event) {
            const now = Date.now();
            const eventTime = event.datetime || 0;
            const isPast = eventTime < now;
            const isUpcoming = eventTime > now + 3600000; // –ë–æ–ª–µ–µ —á–µ–º —á–µ—Ä–µ–∑ —á–∞—Å
            const isOngoing = !isPast && !isUpcoming;
            
            let status = 'upcoming';
            let statusText = '–ü—Ä–µ–¥—Å—Ç–æ—è—â–µ–µ';
            
            if (isPast) {
                status = 'completed';
                statusText = '–ó–∞–≤–µ—Ä—à–µ–Ω–æ';
            } else if (isOngoing) {
                status = 'ongoing';
                statusText = '–°–µ–π—á–∞—Å';
            }
            
            const eventDate = new Date(eventTime);
            const formattedDate = eventDate.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'short',
                year: eventDate.getFullYear() !== new Date().getFullYear() ? 'numeric' : undefined
            }) + ' ' + eventDate.toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'});
            
            const card = document.createElement('div');
            card.className = 'event-card';
            card.onclick = () => viewEvent(event.id);
            
            const participantsCount = event.participants ? Object.keys(event.participants).length : 0;
            
            card.innerHTML = `
                ${event.image ? `<img src="${event.image}" alt="${event.title}" class="event-image">` : 
                  `<div class="event-image" style="background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-calendar-alt fa-2x"></i>
                   </div>`}
                
                <div class="event-content">
                    <div class="event-participants">
                        <i class="fas fa-users"></i> ${participantsCount}
                    </div>
                    
                    <h3 class="event-title">${event.title}</h3>
                    <div class="event-description">${event.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</div>
                    
                    <div class="event-meta">
                        <div class="event-date">
                            <i class="far fa-calendar"></i>
                            ${formattedDate}
                        </div>
                        ${event.location ? `<div class="event-location">
                            <i class="fas fa-map-marker-alt"></i>
                            ${event.location}
                        </div>` : ''}
                    </div>
                    
                    <div class="status-badge status-${status}" style="margin-top: 10px;">
                        ${statusText}
                    </div>
                </div>
            `;
            
            return card;
        }

        function loadEventParticipants() {
            const participantsDiv = document.getElementById('event-participants');
            if (!participantsDiv) return;
            
            participantsDiv.innerHTML = '';
            
            Object.values(users).forEach(user => {
                if (user.id === currentUser.id) return; // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–±—è
                
                const participantDiv = document.createElement('div');
                participantDiv.className = 'participant-checkbox';
                
                participantDiv.innerHTML = `
                    <input type="checkbox" id="participant-${user.id}" value="${user.id}">
                    <img src="${user.avatar || getDefaultAvatar(user.username)}" 
                         alt="${user.username}" 
                         style="width: 24px; height: 24px; border-radius: 50%;">
                    <span style="font-size: 14px;">${user.username}</span>
                    <small style="color: rgba(255,255,255,0.5); margin-left: auto;">${user.position || ''}</small>
                `;
                
                participantsDiv.appendChild(participantDiv);
            });
        }
        
        function toggleCreateEventForm() {
            const form = document.getElementById('create-event-form');
            const btn = document.getElementById('show-create-event-btn');
            
            if (form.style.display === 'none') {
                form.style.display = 'block';
                btn.innerHTML = '<i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞';
                loadEventParticipants();
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–∞—Ç—É (—Å–µ–≥–æ–¥–Ω—è)
                const now = new Date();
                const minDate = now.toISOString().slice(0, 16);
                document.getElementById('event-datetime').min = minDate;
                
                // –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—É (—á–µ—Ä–µ–∑ 2 —á–∞—Å–∞)
                const futureDate = new Date(now.getTime() + 2 * 60 * 60 * 1000);
                document.getElementById('event-datetime').value = futureDate.toISOString().slice(0, 16);
                
            } else {
                form.style.display = 'none';
                btn.innerHTML = '<i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ';
                clearEventForm();
            }
        }
        
        function clearEventForm() {
            document.getElementById('event-title').value = '';
            document.getElementById('event-description').value = '';
            document.getElementById('event-datetime').value = '';
            document.getElementById('event-location').value = '';
            document.getElementById('event-image').value = '';
            document.getElementById('event-image-preview-img').style.display = 'none';
            eventImage = null;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —á–µ–∫–±–æ–∫—Å—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            document.querySelectorAll('#event-participants input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
        document.getElementById('event-image')?.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (file.size > 5 * 1024 * 1024) {
                showAlert('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ! –ú–∞–∫—Å–∏–º—É–º 5MB', 'error');
                this.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                eventImage = e.target.result;
                const preview = document.getElementById('event-image-preview-img');
                preview.src = eventImage;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        });
        
        function createEvent() {
            if (!isAdmin) {
                showAlert('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞', 'error', '–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è!');
                return;
            }
            
            const title = document.getElementById('event-title').value.trim();
            const description = document.getElementById('event-description').value.trim();
            const datetimeInput = document.getElementById('event-datetime').value;
            const location = document.getElementById('event-location').value.trim();
            
            if (!title || !description || !datetimeInput) {
                showAlert('–û—à–∏–±–∫–∞', 'warning', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }
            
            const datetime = new Date(datetimeInput).getTime();
            if (isNaN(datetime)) {
                showAlert('–û—à–∏–±–∫–∞', 'warning', '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è!');
                return;
            }
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            const selectedParticipants = [];
            document.querySelectorAll('#event-participants input[type="checkbox"]:checked').forEach(cb => {
                selectedParticipants.push(cb.value);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–∑–¥–∞—Ç–µ–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            if (!selectedParticipants.includes(currentUser.id)) {
                selectedParticipants.push(currentUser.id);
            }
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –æ–±—ä–µ–∫—Ç –¥–ª—è Firebase
            const participantsObj = {};
            selectedParticipants.forEach(id => {
                participantsObj[id] = true;
            });
            
            const eventId = generateId();
            const eventData = {
                id: eventId,
                title: title,
                description: description,
                datetime: datetime,
                location: location || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
                image: eventImage,
                createdBy: currentUser.id,
                createdByName: currentUser.username,
                createdAt: Date.now(),
                participants: participantsObj,
                status: 'upcoming'
            };
            
            database.ref('events/' + eventId).set(eventData)
                .then(() => {
                    showAlert('–£—Å–ø–µ—Ö!', 'success', '–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–æ!');
                    clearEventForm();
                    toggleCreateEventForm();
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞:', error);
                    showAlert('–û—à–∏–±–∫–∞', 'error', '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ');
                });
        }
        
        function viewEvent(eventId) {
            const event = events[eventId];
            if (!event) return;
            
            const modal = document.getElementById('event-modal');
            const now = Date.now();
            const isParticipant = event.participants && event.participants[currentUser.id];
            
            // –û–±–ª–æ–∂–∫–∞
            const image = document.getElementById('event-modal-image');
            if (event.image) {
                image.src = event.image;
            } else {
                image.style.display = 'none';
            }
            
            // –°—Ç–∞—Ç—É—Å
            const status = document.getElementById('event-modal-status');
            let statusText = '–ü—Ä–µ–¥—Å—Ç–æ—è—â–µ–µ';
            let statusClass = 'status-upcoming';
            
            if (event.datetime < now) {
                statusText = '–ó–∞–≤–µ—Ä—à–µ–Ω–æ';
                statusClass = 'status-completed';
            } else if (event.datetime <= now + 3600000) {
                statusText = '–°–µ–π—á–∞—Å';
                statusClass = 'status-ongoing';
            }
            
            status.textContent = statusText;
            status.className = statusClass;
            
            // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            document.getElementById('event-modal-title').textContent = event.title;
            
            const eventDate = new Date(event.datetime);
            document.getElementById('event-modal-date').textContent = 
                eventDate.toLocaleString('ru-RU', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            
            document.getElementById('event-modal-location').textContent = event.location || '–ú–µ—Å—Ç–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ';
            document.getElementById('event-modal-description').textContent = event.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è';
            
            // –£—á–∞—Å—Ç–Ω–∏–∫–∏
            const participantsDiv = document.getElementById('event-modal-participants');
            participantsDiv.innerHTML = '';
            
            const participantsCount = event.participants ? Object.keys(event.participants).length : 0;
            document.getElementById('event-modal-participants-count').textContent = `${participantsCount} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–≤–∞—Ç–∞—Ä—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            if (event.participants) {
                Object.keys(event.participants).forEach(userId => {
                    const user = users[userId];
                    if (user) {
                        const participant = document.createElement('div');
                        participant.className = 'participant-item';
                        participant.innerHTML = `
                            <img src="${user.avatar || getDefaultAvatar(user.username)}" 
                                 alt="${user.username}" 
                                 class="participant-avatar"
                                 title="${user.username}">
                            <div class="participant-name">${user.username}</div>
                        `;
                        participantsDiv.appendChild(participant);
                    }
                });
            }
            
            // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            const actionsDiv = document.getElementById('event-modal-actions');
            actionsDiv.innerHTML = '';
            
            if (isAdmin) {
                actionsDiv.innerHTML += `
                    <button class="btn btn-danger" onclick="deleteEvent('${eventId}')">
                        <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                    </button>
                `;
            }
            
            if (!isParticipant && event.datetime > now) {
                actionsDiv.innerHTML += `
                    <button class="btn btn-primary" onclick="joinEvent('${eventId}')">
                        <i class="fas fa-user-plus"></i> –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
                    </button>
                `;
            } else if (isParticipant && event.datetime > now) {
                actionsDiv.innerHTML += `
                    <button class="btn btn-warning" onclick="leaveEvent('${eventId}')">
                        <i class="fas fa-user-minus"></i> –ü–æ–∫–∏–Ω—É—Ç—å
                    </button>
                `;
            }
            
            modal.classList.add('active');
        }
        
        function closeEventModal() {
            document.getElementById('event-modal').classList.remove('active');
        }
        
        function joinEvent(eventId) {
            if (!currentUser) return;
            
            database.ref(`events/${eventId}/participants/${currentUser.id}`).set(true)
                .then(() => {
                    showAlert('–£—Å–ø–µ—Ö!', 'success', '–í—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—é');
                    closeEventModal();
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞:', error);
                    showAlert('–û—à–∏–±–∫–∞', 'error', '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è');
                });
        }
        
        function leaveEvent(eventId) {
            if (!currentUser) return;
            
            database.ref(`events/${eventId}/participants/${currentUser.id}`).remove()
                .then(() => {
                    showAlert('–£—Å–ø–µ—Ö!', 'success', '–í—ã –ø–æ–∫–∏–Ω—É–ª–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ');
                    closeEventModal();
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞:', error);
                    showAlert('–û—à–∏–±–∫–∞', 'error', '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–∫–∏–Ω—É—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ');
                });
        }
        
        function deleteEvent(eventId) {
            if (!isAdmin) return;
            
            Swal.fire({
                title: '–£–¥–∞–ª–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ?',
                text: '–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: '–£–¥–∞–ª–∏—Ç—å',
                cancelButtonText: '–û—Ç–º–µ–Ω–∞'
            }).then((result) => {
                if (result.isConfirmed) {
                    database.ref('events/' + eventId).remove()
                        .then(() => {
                            showAlert('–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ —É–¥–∞–ª–µ–Ω–æ!', 'success');
                            closeEventModal();
                        })
                        .catch(error => {
                            console.error('–û—à–∏–±–∫–∞:', error);
                            showAlert('–û—à–∏–±–∫–∞', 'error', '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ');
                        });
                }
            });
        }
        
        // ========== –ê–î–ê–ü–¢–ê–¶–ò–Ø ==========
        function loadMaterials() {
            // –ó–∞–≥–ª—É—à–∫–∞ - –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
            const materialsList = document.getElementById('materials-list');
            materialsList.innerHTML = `
                <div class="material-item">
                    <div class="material-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="material-content">
                        <div class="material-title">–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏</div>
                        <div class="material-description">–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>
                    </div>
                </div>
                <div class="material-item">
                    <div class="material-icon">
                        <i class="fas fa-video"></i>
                    </div>
                    <div class="material-content">
                        <div class="material-title">–û–±—É—á–∞—é—â–∏–µ –≤–∏–¥–µ–æ</div>
                        <div class="material-description">–í–∏–¥–µ–æ—É—Ä–æ–∫–∏ –ø–æ —Ä–∞–±–æ—Ç–µ —Å —Å–∏—Å—Ç–µ–º–æ–π</div>
                    </div>
                </div>
                <div class="material-item">
                    <div class="material-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="material-content">
                        <div class="material-title">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏</div>
                        <div class="material-description">–î–æ–∫—É–º–µ–Ω—Ç—ã –∏ –ø–æ–ª–∏—Ç–∏–∫–∏ –∫–æ–º–ø–∞–Ω–∏–∏</div>
                    </div>
                </div>
            `;
        }

        // ========== –í–õ–û–ñ–ï–ù–ò–Ø ==========
        function openAttachmentModal() {
            document.getElementById('attachment-modal').classList.add('active');
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–∏–ø –≤–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
            attachmentType = 'image';
            document.getElementById('file-input').accept = 'image/*';
        }

        function closeAttachmentModal() {
            document.getElementById('attachment-modal').classList.remove('active');
            document.getElementById('attachment-preview').style.display = 'none';
            document.getElementById('preview-container').innerHTML = '';
            document.getElementById('file-input').value = '';
            // –ù–ï —Å–±—Ä–∞—Å—ã–≤–∞–µ–º currentAttachment –∑–¥–µ—Å—å, —Ç–æ–ª—å–∫–æ –≤ –º–æ–¥–∞–ª–∫–µ
        }

        function selectAttachmentType(type) {
            attachmentType = type;
            const input = document.getElementById('file-input');
            input.accept = type === 'image' ? 'image/*' : 
                          type === 'gif' ? '.gif,image/gif' : 
                          type === 'video' ? 'video/*' : '*/*';
        }

        function previewAttachment(file) {
            if (!file) return;
                
                if (file.size > 5 * 1024 * 1024) {
                    showAlert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º 5MB', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentAttachment = {
                        type: attachmentType,
                        data: e.target.result,
                        name: file.name,
                        size: file.size
                    };
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
                    const previewContainer = document.getElementById('preview-container');
                    if (previewContainer) {
                        previewContainer.innerHTML = '';
                        if (attachmentType === 'image' || attachmentType === 'gif') {
                            previewContainer.innerHTML = `<img src="${e.target.result}" style="max-width: 200px; border-radius: 10px;">`;
                        } else if (attachmentType === 'video') {
                            previewContainer.innerHTML = `
                                <video controls style="max-width: 200px; border-radius: 10px;">
                                    <source src="${e.target.result}" type="${file.type}">
                                </video>
                            `;
                        } else {
                            previewContainer.innerHTML = `
                                <div style="padding: 20px; text-align: center; background: rgba(67, 97, 238, 0.1); border-radius: 10px;">
                                    <i class="fas fa-file fa-2x"></i>
                                    <div style="margin-top: 10px;">${file.name}</div>
                                </div>
                            `;
                        }
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                        document.getElementById('attachment-preview').style.display = 'block';
                    }
                };
                reader.readAsDataURL(file);
        }

        function attachFile() {
            if (!currentAttachment) {
                showAlert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª!', 'warning');
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞–¥ –ø–æ–ª–µ–º –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            updateAttachmentPreview();
            
            closeAttachmentModal();
            showAlert('–§–∞–π–ª –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω!', 'success');
            
            // –§–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            document.getElementById('message-input').focus();
        }

        // ========== –ü–†–û–§–ò–õ–¨ ==========
        function openProfileModal() {
            document.getElementById('profile-modal').classList.add('active');
            document.getElementById('profile-username').value = currentUser.username;
            document.getElementById('profile-position').value = currentUser.position || '';
            document.getElementById('profile-organization').value = currentUser.organization || '';
            document.getElementById('profile-status').value = currentUser.status || 'online';
        }

        function closeProfileModal() {
            document.getElementById('profile-modal').classList.remove('active');
        }

        function uploadAvatar(file) {
            if (!file) return;
            
            if (file.size > 2 * 1024 * 1024) {
                showAlert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º 2MB', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('avatar-preview').src = e.target.result;
                currentUser.avatar = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function saveProfile() {
            const username = document.getElementById('profile-username').value.trim();
            const position = document.getElementById('profile-position').value.trim();
            const organization = document.getElementById('profile-organization').value.trim();
            const status = document.getElementById('profile-status').value;
            const avatar = document.getElementById('avatar-preview').src;
            
            if (!username) {
                showAlert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!', 'warning');
                return;
            }
            
            currentUser.username = username;
            currentUser.position = position;
            currentUser.organization = organization;
            currentUser.status = status;
            currentUser.avatar = avatar;
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –¥–æ–ª–∂–Ω–æ—Å—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë –∫–∞–∫ —Ä–æ–ª—å
            if (position) {
                currentUser.role = position;
            }
            
            saveUserProfile();
            updateProfileUI();
            closeProfileModal();
            
            showAlert('–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
        }

        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function generateId() {
            return Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function showAlert(title, icon = 'success', text = '') {
            Swal.fire({
                title: title,
                text: text,
                icon: icon,
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true
            });
        }

        function viewImage(url) {
            const newWindow = window.open();
            newWindow.document.write(`
                <html>
                    <head>
                        <style>
                            body { margin: 0; padding: 20px; background: #1a1a2e; text-align: center; }
                            img { max-width: 90vw; max-height: 90vh; border-radius: 10px; }
                        </style>
                    </head>
                    <body>
                        <img src="${url}">
                    </body>
                </html>
            `);
        }

        function downloadAttachment(data, name) {
            const link = document.createElement('a');
            link.href = data;
            link.download = name;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function closeTaskModal() {
            document.getElementById('task-modal').classList.remove('active');
        }

        function setupEventListeners() {
            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ Enter
    document.getElementById('message-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // –ê–≤—Ç–æ—Ä–∞–∑–º–µ—Ä textarea
            document.getElementById('message-input').addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ –≤ –º–æ–¥–∞–ª–∫–µ
            document.getElementById('file-input').addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    previewAttachment(e.target.files[0]);
                }
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
            document.addEventListener('click', function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.classList.remove('active');
                }
            });

            // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            window.addEventListener('unload', cleanupStatusListeners);
        }


    </script>
</body>
</html>
